2025-08-27 01:53:10,754 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 01:53:10,758 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 01:53:10,759 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 01:53:10,759 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 01:53:10,759 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 01:53:10,759 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 01:53:10,760 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 01:53:10,760 - __main__ - INFO - База данных инициализирована
2025-08-27 01:53:10,776 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 01:53:10,776 - __main__ - INFO - Запуск polling...
2025-08-27 01:53:10,776 - aiogram.dispatcher - INFO - Start polling
2025-08-27 01:53:11,491 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 01:53:32,100 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 01:53:32,116 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 01:53:32,121 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 01:53:32,121 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (37996964,)
2025-08-27 01:53:32,869 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 01:53:32,870 - aiogram.event - INFO - Update id=954948377 is handled. Duration 933 ms by bot id=8413666974
2025-08-27 01:53:34,803 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 01:53:34,812 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 01:53:34,812 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 01:53:34,813 - sqlalchemy.engine.Engine - INFO - [cached since 2.692s ago] (37996964,)
2025-08-27 01:53:34,816 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 01:53:34,816 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1, 0)
2025-08-27 01:53:34,929 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 01:53:34,930 - aiogram.event - INFO - Update id=954948378 is handled. Duration 127 ms by bot id=8413666974
2025-08-27 01:53:41,767 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 01:53:41,885 - aiogram.event - INFO - Update id=954948379 is handled. Duration 121 ms by bot id=8413666974
2025-08-27 01:53:45,447 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 01:53:45,449 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 01:53:45,561 - root - INFO - Состояние установлено: waiting_media
2025-08-27 01:53:45,561 - aiogram.event - INFO - Update id=954948380 is handled. Duration 115 ms by bot id=8413666974
2025-08-27 01:54:08,616 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 01:54:08,619 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 01:54:08,620 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 01:54:08,625 - root - INFO - Начало обработки фото. Сообщение: message_id=48 date=datetime.datetime(2025, 8, 26, 22, 54, 8, tzinfo=TzInfo(UTC)) chat=Chat(id=37996964, type='private', title=None, username='biryukow', first_name='Alexander', last_name='Biryukov', is_forum=None, is_direct_messages=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None) message_thread_id=None direct_messages_topic=None from_user=User(id=37996964, is_bot=False, first_name='Alexander', last_name='Biryukov', username='biryukow', language_code='ru', is_premium=True, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None) sender_chat=None sender_boost_count=None sender_business_bot=None business_connection_id=None forward_origin=None is_topic_message=None is_automatic_forward=None reply_to_message=None external_reply=None quote=None reply_to_story=None reply_to_checklist_task_id=None via_bot=None edit_date=None has_protected_content=None is_from_offline=None is_paid_post=None media_group_id='14049990789188698' author_signature=None paid_star_count=None text=None entities=None link_preview_options=None suggested_post_info=None effect_id=None animation=None audio=None document=None paid_media=None photo=[PhotoSize(file_id='AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAANzAAM2BA', file_unique_id='AQADPfYxGwkXeUl4', width=90, height=90, file_size=1918), PhotoSize(file_id='AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAANtAAM2BA', file_unique_id='AQADPfYxGwkXeUly', width=320, height=320, file_size=25464), PhotoSize(file_id='AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN4AAM2BA', file_unique_id='AQADPfYxGwkXeUl9', width=800, height=800, file_size=101230), PhotoSize(file_id='AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA', file_unique_id='AQADPfYxGwkXeUl-', width=1280, height=1280, file_size=138763)] sticker=None story=None video=None video_note=None voice=None caption=None caption_entities=None show_caption_above_media=None has_media_spoiler=None checklist=None contact=None dice=None game=None poll=None venue=None location=None new_chat_members=None left_chat_member=None new_chat_title=None new_chat_photo=None delete_chat_photo=None group_chat_created=None supergroup_chat_created=None channel_chat_created=None message_auto_delete_timer_changed=None migrate_to_chat_id=None migrate_from_chat_id=None pinned_message=None invoice=None successful_payment=None refunded_payment=None users_shared=None chat_shared=None gift=None unique_gift=None connected_website=None write_access_allowed=None passport_data=None proximity_alert_triggered=None boost_added=None chat_background_set=None checklist_tasks_done=None checklist_tasks_added=None direct_message_price_changed=None forum_topic_created=None forum_topic_edited=None forum_topic_closed=None forum_topic_reopened=None general_forum_topic_hidden=None general_forum_topic_unhidden=None giveaway_created=None giveaway=None giveaway_winners=None giveaway_completed=None paid_message_price_changed=None suggested_post_approved=None suggested_post_approval_failed=None suggested_post_declined=None suggested_post_paid=None suggested_post_refunded=None video_chat_scheduled=None video_chat_started=None video_chat_ended=None video_chat_participants_invited=None web_app_data=None reply_markup=None forward_date=None forward_from=None forward_from_chat=None forward_from_message_id=None forward_sender_name=None forward_signature=None user_shared=None
2025-08-27 01:54:08,627 - root - INFO - Начало обработки фото. Сообщение: message_id=49 date=datetime.datetime(2025, 8, 26, 22, 54, 8, tzinfo=TzInfo(UTC)) chat=Chat(id=37996964, type='private', title=None, username='biryukow', first_name='Alexander', last_name='Biryukov', is_forum=None, is_direct_messages=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None) message_thread_id=None direct_messages_topic=None from_user=User(id=37996964, is_bot=False, first_name='Alexander', last_name='Biryukov', username='biryukow', language_code='ru', is_premium=True, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None) sender_chat=None sender_boost_count=None sender_business_bot=None business_connection_id=None forward_origin=None is_topic_message=None is_automatic_forward=None reply_to_message=None external_reply=None quote=None reply_to_story=None reply_to_checklist_task_id=None via_bot=None edit_date=None has_protected_content=None is_from_offline=None is_paid_post=None media_group_id='14049990789188698' author_signature=None paid_star_count=None text=None entities=None link_preview_options=None suggested_post_info=None effect_id=None animation=None audio=None document=None paid_media=None photo=[PhotoSize(file_id='AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAANzAAM2BA', file_unique_id='AQADPvYxGwkXeUl4', width=90, height=90, file_size=2250), PhotoSize(file_id='AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAANtAAM2BA', file_unique_id='AQADPvYxGwkXeUly', width=320, height=320, file_size=37536), PhotoSize(file_id='AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN4AAM2BA', file_unique_id='AQADPvYxGwkXeUl9', width=800, height=800, file_size=160777), PhotoSize(file_id='AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN5AAM2BA', file_unique_id='AQADPvYxGwkXeUl-', width=1280, height=1280, file_size=228065)] sticker=None story=None video=None video_note=None voice=None caption=None caption_entities=None show_caption_above_media=None has_media_spoiler=None checklist=None contact=None dice=None game=None poll=None venue=None location=None new_chat_members=None left_chat_member=None new_chat_title=None new_chat_photo=None delete_chat_photo=None group_chat_created=None supergroup_chat_created=None channel_chat_created=None message_auto_delete_timer_changed=None migrate_to_chat_id=None migrate_from_chat_id=None pinned_message=None invoice=None successful_payment=None refunded_payment=None users_shared=None chat_shared=None gift=None unique_gift=None connected_website=None write_access_allowed=None passport_data=None proximity_alert_triggered=None boost_added=None chat_background_set=None checklist_tasks_done=None checklist_tasks_added=None direct_message_price_changed=None forum_topic_created=None forum_topic_edited=None forum_topic_closed=None forum_topic_reopened=None general_forum_topic_hidden=None general_forum_topic_unhidden=None giveaway_created=None giveaway=None giveaway_winners=None giveaway_completed=None paid_message_price_changed=None suggested_post_approved=None suggested_post_approval_failed=None suggested_post_declined=None suggested_post_paid=None suggested_post_refunded=None video_chat_scheduled=None video_chat_started=None video_chat_ended=None video_chat_participants_invited=None web_app_data=None reply_markup=None forward_date=None forward_from=None forward_from_chat=None forward_from_message_id=None forward_sender_name=None forward_signature=None user_shared=None
2025-08-27 01:54:08,628 - root - INFO - Начало обработки фото. Сообщение: message_id=50 date=datetime.datetime(2025, 8, 26, 22, 54, 8, tzinfo=TzInfo(UTC)) chat=Chat(id=37996964, type='private', title=None, username='biryukow', first_name='Alexander', last_name='Biryukov', is_forum=None, is_direct_messages=None, accent_color_id=None, active_usernames=None, available_reactions=None, background_custom_emoji_id=None, bio=None, birthdate=None, business_intro=None, business_location=None, business_opening_hours=None, can_set_sticker_set=None, custom_emoji_sticker_set_name=None, description=None, emoji_status_custom_emoji_id=None, emoji_status_expiration_date=None, has_aggressive_anti_spam_enabled=None, has_hidden_members=None, has_private_forwards=None, has_protected_content=None, has_restricted_voice_and_video_messages=None, has_visible_history=None, invite_link=None, join_by_request=None, join_to_send_messages=None, linked_chat_id=None, location=None, message_auto_delete_time=None, permissions=None, personal_chat=None, photo=None, pinned_message=None, profile_accent_color_id=None, profile_background_custom_emoji_id=None, slow_mode_delay=None, sticker_set_name=None, unrestrict_boost_count=None) message_thread_id=None direct_messages_topic=None from_user=User(id=37996964, is_bot=False, first_name='Alexander', last_name='Biryukov', username='biryukow', language_code='ru', is_premium=True, added_to_attachment_menu=None, can_join_groups=None, can_read_all_group_messages=None, supports_inline_queries=None, can_connect_to_business=None, has_main_web_app=None) sender_chat=None sender_boost_count=None sender_business_bot=None business_connection_id=None forward_origin=None is_topic_message=None is_automatic_forward=None reply_to_message=None external_reply=None quote=None reply_to_story=None reply_to_checklist_task_id=None via_bot=None edit_date=None has_protected_content=None is_from_offline=None is_paid_post=None media_group_id='14049990789188698' author_signature=None paid_star_count=None text=None entities=None link_preview_options=None suggested_post_info=None effect_id=None animation=None audio=None document=None paid_media=None photo=[PhotoSize(file_id='AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAANzAAM2BA', file_unique_id='AQADP_YxGwkXeUl4', width=90, height=90, file_size=1325), PhotoSize(file_id='AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAANtAAM2BA', file_unique_id='AQADP_YxGwkXeUly', width=320, height=320, file_size=17058), PhotoSize(file_id='AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN4AAM2BA', file_unique_id='AQADP_YxGwkXeUl9', width=800, height=800, file_size=70120), PhotoSize(file_id='AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN5AAM2BA', file_unique_id='AQADP_YxGwkXeUl-', width=1280, height=1280, file_size=94029)] sticker=None story=None video=None video_note=None voice=None caption=None caption_entities=None show_caption_above_media=None has_media_spoiler=None checklist=None contact=None dice=None game=None poll=None venue=None location=None new_chat_members=None left_chat_member=None new_chat_title=None new_chat_photo=None delete_chat_photo=None group_chat_created=None supergroup_chat_created=None channel_chat_created=None message_auto_delete_timer_changed=None migrate_to_chat_id=None migrate_from_chat_id=None pinned_message=None invoice=None successful_payment=None refunded_payment=None users_shared=None chat_shared=None gift=None unique_gift=None connected_website=None write_access_allowed=None passport_data=None proximity_alert_triggered=None boost_added=None chat_background_set=None checklist_tasks_done=None checklist_tasks_added=None direct_message_price_changed=None forum_topic_created=None forum_topic_edited=None forum_topic_closed=None forum_topic_reopened=None general_forum_topic_hidden=None general_forum_topic_unhidden=None giveaway_created=None giveaway=None giveaway_winners=None giveaway_completed=None paid_message_price_changed=None suggested_post_approved=None suggested_post_approval_failed=None suggested_post_declined=None suggested_post_paid=None suggested_post_refunded=None video_chat_scheduled=None video_chat_started=None video_chat_ended=None video_chat_participants_invited=None web_app_data=None reply_markup=None forward_date=None forward_from=None forward_from_chat=None forward_from_message_id=None forward_sender_name=None forward_signature=None user_shared=None
2025-08-27 01:54:08,629 - root - INFO - Текущее количество фото: 0, лимит: 6
2025-08-27 01:54:08,629 - root - INFO - Текущее количество фото: 0, лимит: 6
2025-08-27 01:54:08,630 - root - INFO - Текущее количество фото: 0, лимит: 6
2025-08-27 01:54:08,631 - root - INFO - Фото добавлено. Всего фото: 1
2025-08-27 01:54:08,638 - root - INFO - Фото добавлено. Всего фото: 1
2025-08-27 01:54:08,640 - root - INFO - Фото добавлено. Всего фото: 1
2025-08-27 01:54:08,768 - aiogram.event - INFO - Update id=954948381 is handled. Duration 177 ms by bot id=8413666974
2025-08-27 01:54:09,397 - aiogram.event - INFO - Update id=954948382 is handled. Duration 804 ms by bot id=8413666974
2025-08-27 01:54:09,419 - aiogram.event - INFO - Update id=954948383 is handled. Duration 825 ms by bot id=8413666974
2025-08-27 02:15:04,965 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 02:15:04,967 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:15:04,967 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 02:15:05,233 - __main__ - INFO - Работа бота завершена
2025-08-27 02:15:18,739 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 02:15:18,743 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:15:18,743 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 02:15:18,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:15:18,744 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 02:15:18,744 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:15:18,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 02:15:18,744 - __main__ - INFO - База данных инициализирована
2025-08-27 02:15:18,760 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 02:15:18,760 - __main__ - INFO - Запуск polling...
2025-08-27 02:15:18,761 - aiogram.dispatcher - INFO - Start polling
2025-08-27 02:15:19,720 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:15:30,261 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:15:30,276 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:15:30,284 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:15:30,285 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (37996964,)
2025-08-27 02:15:30,998 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:15:31,000 - aiogram.event - INFO - Update id=954948384 is handled. Duration 785 ms by bot id=8413666974
2025-08-27 02:15:32,774 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:15:32,776 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:15:32,776 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:15:32,776 - sqlalchemy.engine.Engine - INFO - [cached since 2.492s ago] (37996964,)
2025-08-27 02:15:32,798 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 02:15:32,799 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1, 0)
2025-08-27 02:15:32,916 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:15:32,917 - aiogram.event - INFO - Update id=954948385 is handled. Duration 143 ms by bot id=8413666974
2025-08-27 02:15:43,214 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:15:43,219 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:15:43,236 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:15:43,236 - sqlalchemy.engine.Engine - INFO - [cached since 12.95s ago] (37996964,)
2025-08-27 02:15:43,250 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 02:15:43,250 - sqlalchemy.engine.Engine - INFO - [cached since 10.45s ago] (1, 0)
2025-08-27 02:15:43,528 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:15:43,530 - aiogram.event - INFO - Update id=954948386 is handled. Duration 318 ms by bot id=8413666974
2025-08-27 02:15:49,331 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:15:49,442 - aiogram.event - INFO - Update id=954948387 is handled. Duration 110 ms by bot id=8413666974
2025-08-27 02:15:52,985 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:15:52,988 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 02:15:53,165 - root - INFO - Состояние установлено: waiting_media
2025-08-27 02:15:53,166 - aiogram.event - INFO - Update id=954948388 is handled. Duration 181 ms by bot id=8413666974
2025-08-27 02:16:15,539 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:16:15,541 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:16:15,541 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:16:15,543 - aiogram.event - INFO - Update id=954948389 is handled. Duration 11 ms by bot id=8413666974
2025-08-27 02:16:15,544 - aiogram.event - INFO - Update id=954948391 is handled. Duration 9 ms by bot id=8413666974
2025-08-27 02:16:15,544 - aiogram.event - INFO - Update id=954948390 is handled. Duration 10 ms by bot id=8413666974
2025-08-27 02:32:15,027 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 02:32:15,029 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:32:15,029 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 02:32:15,291 - __main__ - INFO - Работа бота завершена
2025-08-27 02:38:37,254 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 02:38:37,258 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:38:37,259 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 02:38:37,259 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:38:37,259 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 02:38:37,259 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:38:37,260 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 02:38:37,260 - __main__ - INFO - База данных инициализирована
2025-08-27 02:38:37,277 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 02:38:37,277 - __main__ - INFO - Запуск polling...
2025-08-27 02:38:37,277 - aiogram.dispatcher - INFO - Start polling
2025-08-27 02:38:38,011 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:38:38,120 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:38:38,123 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:38:38,130 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:38:38,130 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (37996964,)
2025-08-27 02:38:38,787 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:38:38,787 - aiogram.event - INFO - Update id=954948392 is handled. Duration 674 ms by bot id=8413666974
2025-08-27 02:38:43,398 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:38:43,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:38:43,400 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:38:43,401 - sqlalchemy.engine.Engine - INFO - [cached since 5.271s ago] (37996964,)
2025-08-27 02:38:43,429 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 02:38:43,429 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (1, 0)
2025-08-27 02:38:43,540 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:38:43,541 - aiogram.event - INFO - Update id=954948393 is handled. Duration 144 ms by bot id=8413666974
2025-08-27 02:38:56,713 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:38:56,834 - aiogram.event - INFO - Update id=954948394 is handled. Duration 123 ms by bot id=8413666974
2025-08-27 02:39:00,139 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:39:00,150 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 02:39:00,351 - root - INFO - Состояние установлено: waiting_media
2025-08-27 02:39:00,352 - aiogram.event - INFO - Update id=954948395 is handled. Duration 214 ms by bot id=8413666974
2025-08-27 02:39:21,602 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:21,618 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:21,618 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:21,619 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:21,620 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:21,620 - aiogram.event - INFO - Update id=954948396 is handled. Duration 43 ms by bot id=8413666974
2025-08-27 02:39:21,622 - aiogram.event - INFO - Update id=954948398 is handled. Duration 42 ms by bot id=8413666974
2025-08-27 02:39:21,622 - aiogram.event - INFO - Update id=954948399 is handled. Duration 43 ms by bot id=8413666974
2025-08-27 02:39:21,622 - aiogram.event - INFO - Update id=954948397 is handled. Duration 44 ms by bot id=8413666974
2025-08-27 02:39:21,623 - aiogram.event - INFO - Update id=954948400 is handled. Duration 43 ms by bot id=8413666974
2025-08-27 02:39:23,124 - root - ERROR - Ошибка при обработке медиа-группы: 'FSMContext' object has no attribute 'bot'
2025-08-27 02:39:57,753 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:39:57,867 - aiogram.event - INFO - Update id=954948401 is handled. Duration 116 ms by bot id=8413666974
2025-08-27 02:40:10,334 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 02:40:10,578 - aiogram.event - INFO - Update id=954948402 is handled. Duration 245 ms by bot id=8413666974
2025-08-27 02:40:13,597 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 02:40:13,736 - aiogram.event - INFO - Update id=954948403 is handled. Duration 140 ms by bot id=8413666974
2025-08-27 02:40:18,695 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 02:40:18,817 - aiogram.event - INFO - Update id=954948404 is handled. Duration 122 ms by bot id=8413666974
2025-08-27 02:40:21,889 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 02:40:21,895 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:40:21,903 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 02:40:21,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('0201', 1, 'букет из хризантем', 'букет из хризантем №0201', '["AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_ ... (132 characters truncated) ... 8_iumuwTNKqoPLxDt_1Em4AAlL2MRsJF3lJ9etWy46PJHIBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMVaK426XkCiTYhq6miSCsZnZOoWAMAAkD2MRsJF3lJ_LmJc6SmTFABAAMCAAN5AAM2BA"]', None, 'риоиоиоиоиоиоио', 'null', 200000, 'RUB')
2025-08-27 02:40:21,914 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 02:40:21,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:40:21,917 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 02:40:21,917 - sqlalchemy.engine.Engine - INFO - [generated in 0.00010s] (1,)
2025-08-27 02:40:22,126 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:40:22,126 - aiogram.event - INFO - Update id=954948405 is handled. Duration 238 ms by bot id=8413666974
2025-08-27 02:40:25,099 - __main__ - INFO - FSM State Change: None
2025-08-27 02:40:25,106 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:40:25,107 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:40:25,107 - sqlalchemy.engine.Engine - INFO - [cached since 107s ago] (37996964,)
2025-08-27 02:40:25,113 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 02:40:25,114 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (1, 10, 0)
2025-08-27 02:40:25,229 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 02:40:25,230 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (1,)
2025-08-27 02:40:25,231 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:40:25,232 - aiogram.event - INFO - Update id=954948406 is handled. Duration 133 ms by bot id=8413666974
2025-08-27 02:40:36,212 - __main__ - INFO - FSM State Change: None
2025-08-27 02:40:36,215 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:40:36,215 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:40:36,215 - sqlalchemy.engine.Engine - INFO - [cached since 118.1s ago] (37996964,)
2025-08-27 02:40:36,324 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:40:36,325 - aiogram.event - INFO - Update id=954948407 is handled. Duration 113 ms by bot id=8413666974
2025-08-27 02:40:39,867 - __main__ - INFO - FSM State Change: None
2025-08-27 02:40:40,054 - aiogram.event - INFO - Update id=954948408 is handled. Duration 198 ms by bot id=8413666974
2025-08-27 02:40:46,200 - __main__ - INFO - FSM State Change: None
2025-08-27 02:40:46,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:40:46,206 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:40:46,206 - sqlalchemy.engine.Engine - INFO - [cached since 128.1s ago] (37996964,)
2025-08-27 02:40:46,226 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 02:40:46,231 - sqlalchemy.engine.Engine - INFO - [cached since 21.12s ago] (1, 10, 0)
2025-08-27 02:40:46,342 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 02:40:46,342 - sqlalchemy.engine.Engine - INFO - [cached since 21.11s ago] (1,)
2025-08-27 02:40:46,343 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:40:46,344 - aiogram.event - INFO - Update id=954948409 is handled. Duration 144 ms by bot id=8413666974
2025-08-27 02:41:24,245 - __main__ - INFO - FSM State Change: None
2025-08-27 02:41:24,247 - aiogram.event - INFO - Update id=954948410 is handled. Duration 5 ms by bot id=8413666974
2025-08-27 02:41:33,388 - __main__ - INFO - FSM State Change: None
2025-08-27 02:41:33,390 - root - ERROR - Ошибка при сохранении букета: 'current_id'
2025-08-27 02:41:33,511 - aiogram.event - INFO - Update id=954948411 is handled. Duration 124 ms by bot id=8413666974
2025-08-27 02:42:19,887 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 02:42:19,889 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:42:19,889 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 02:42:20,164 - __main__ - INFO - Работа бота завершена
2025-08-27 02:42:30,959 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 02:42:30,962 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:42:30,962 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 02:42:30,962 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:42:30,963 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 02:42:30,963 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 02:42:30,963 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 02:42:30,963 - __main__ - INFO - База данных инициализирована
2025-08-27 02:42:30,980 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 02:42:30,980 - __main__ - INFO - Запуск polling...
2025-08-27 02:42:30,980 - aiogram.dispatcher - INFO - Start polling
2025-08-27 02:42:31,584 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 02:42:39,672 - __main__ - INFO - FSM State Change: None
2025-08-27 02:42:39,676 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:42:39,704 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:42:39,704 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] (37996964,)
2025-08-27 02:42:40,439 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:42:40,440 - aiogram.event - INFO - Update id=954948412 is handled. Duration 780 ms by bot id=8413666974
2025-08-27 02:42:42,045 - __main__ - INFO - FSM State Change: None
2025-08-27 02:42:42,052 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:42:42,053 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:42:42,053 - sqlalchemy.engine.Engine - INFO - [cached since 2.349s ago] (37996964,)
2025-08-27 02:42:42,069 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 02:42:42,069 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1, 0)
2025-08-27 02:42:42,186 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:42:42,187 - aiogram.event - INFO - Update id=954948413 is handled. Duration 142 ms by bot id=8413666974
2025-08-27 02:42:48,088 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:42:48,203 - aiogram.event - INFO - Update id=954948414 is handled. Duration 116 ms by bot id=8413666974
2025-08-27 02:42:52,969 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 02:42:52,971 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 02:42:53,086 - root - INFO - Состояние установлено: waiting_media
2025-08-27 02:42:53,087 - aiogram.event - INFO - Update id=954948415 is handled. Duration 119 ms by bot id=8413666974
2025-08-27 02:43:09,965 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:43:09,966 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:43:09,968 - aiogram.event - INFO - Update id=954948417 is handled. Duration 13 ms by bot id=8413666974
2025-08-27 02:43:09,968 - aiogram.event - INFO - Update id=954948416 is handled. Duration 14 ms by bot id=8413666974
2025-08-27 02:43:11,472 - root - ERROR - Ошибка при обработке медиа-группы: 'FSMContext' object has no attribute 'bot'
2025-08-27 02:43:12,814 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 02:43:12,932 - aiogram.event - INFO - Update id=954948418 is handled. Duration 119 ms by bot id=8413666974
2025-08-27 02:43:17,673 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 02:43:17,798 - aiogram.event - INFO - Update id=954948419 is handled. Duration 125 ms by bot id=8413666974
2025-08-27 02:43:20,483 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 02:43:20,644 - aiogram.event - INFO - Update id=954948420 is handled. Duration 162 ms by bot id=8413666974
2025-08-27 02:43:24,892 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 02:43:25,006 - aiogram.event - INFO - Update id=954948421 is handled. Duration 114 ms by bot id=8413666974
2025-08-27 02:43:30,446 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 02:43:30,454 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:43:30,461 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 02:43:30,462 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] ('0202', 1, 'букет вавава', 'букет вавава №0202', '["AgACAgIAAxkBAANAaK5AP8_iumuwTNKqoPLxDt_1Em4AAlL2MRsJF3lJ9etWy46PJHIBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA"]', None, 'ываваывавав', 'null', 200000, 'RUB')
2025-08-27 02:43:30,468 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 02:43:30,473 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:43:30,475 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 02:43:30,475 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (2,)
2025-08-27 02:43:30,592 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:43:30,593 - aiogram.event - INFO - Update id=954948422 is handled. Duration 148 ms by bot id=8413666974
2025-08-27 02:43:32,558 - __main__ - INFO - FSM State Change: None
2025-08-27 02:43:32,561 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:43:32,561 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:43:32,561 - sqlalchemy.engine.Engine - INFO - [cached since 52.86s ago] (37996964,)
2025-08-27 02:43:32,563 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 02:43:32,563 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1, 10, 0)
2025-08-27 02:43:32,691 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 02:43:32,691 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1,)
2025-08-27 02:43:32,692 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:43:32,692 - aiogram.event - INFO - Update id=954948423 is handled. Duration 134 ms by bot id=8413666974
2025-08-27 02:43:39,635 - __main__ - INFO - FSM State Change: None
2025-08-27 02:43:39,636 - aiogram.event - INFO - Update id=954948424 is handled. Duration 1 ms by bot id=8413666974
2025-08-27 02:45:50,300 - __main__ - INFO - FSM State Change: None
2025-08-27 02:45:50,333 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 02:45:50,335 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 02:45:50,335 - sqlalchemy.engine.Engine - INFO - [cached since 190.6s ago] (37996964,)
2025-08-27 02:45:50,341 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 02:45:50,341 - sqlalchemy.engine.Engine - INFO - [cached since 137.8s ago] (1, 10, 0)
2025-08-27 02:45:50,472 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 02:45:50,472 - sqlalchemy.engine.Engine - INFO - [cached since 137.8s ago] (1,)
2025-08-27 02:45:50,473 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 02:45:50,474 - aiogram.event - INFO - Update id=954948425 is handled. Duration 175 ms by bot id=8413666974
2025-08-27 03:07:06,932 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 03:07:06,933 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 03:23:16,820 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 03:23:16,824 - aiogram.dispatcher - WARNING - Sleep for 1.470635 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 03:38:24,782 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 03:38:24,866 - aiogram.dispatcher - WARNING - Sleep for 1.956016 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-27 03:53:45,751 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 03:53:45,752 - aiogram.dispatcher - WARNING - Sleep for 2.662225 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-27 04:11:09,726 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 04:11:09,807 - aiogram.dispatcher - WARNING - Sleep for 3.545480 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-27 04:28:21,719 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 04:28:21,805 - aiogram.dispatcher - WARNING - Sleep for 4.583279 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-27 04:46:07,703 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 04:46:07,703 - aiogram.dispatcher - WARNING - Sleep for 5.171063 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-27 05:02:42,683 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 05:02:42,762 - aiogram.dispatcher - WARNING - Sleep for 5.032508 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-27 05:19:45,667 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 05:19:45,750 - aiogram.dispatcher - WARNING - Sleep for 4.995234 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-27 05:36:50,645 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 05:36:50,645 - aiogram.dispatcher - WARNING - Sleep for 4.857862 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-27 05:37:06,163 - aiogram.dispatcher - INFO - Connection established (tryings = 10, bot id = 8413666974)
2025-08-27 05:54:29,626 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 05:54:29,697 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 06:11:43,595 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 06:11:43,669 - aiogram.dispatcher - WARNING - Sleep for 1.369759 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 06:28:38,549 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 06:28:38,581 - aiogram.dispatcher - WARNING - Sleep for 1.879839 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-27 06:43:41,468 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 06:43:41,550 - aiogram.dispatcher - WARNING - Sleep for 2.627425 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-27 06:59:24,430 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 06:59:24,430 - aiogram.dispatcher - WARNING - Sleep for 3.306351 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-27 07:16:22,399 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 07:16:22,483 - aiogram.dispatcher - WARNING - Sleep for 4.467423 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-27 07:33:12,358 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 07:33:12,358 - aiogram.dispatcher - WARNING - Sleep for 4.882020 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-27 07:49:40,349 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 07:49:40,402 - aiogram.dispatcher - WARNING - Sleep for 4.858280 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-27 08:05:14,281 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 08:05:14,281 - aiogram.dispatcher - WARNING - Sleep for 4.975077 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-27 08:21:15,304 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 08:21:15,390 - aiogram.dispatcher - WARNING - Sleep for 5.087690 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-27 08:37:06,280 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 08:37:06,281 - aiogram.dispatcher - WARNING - Sleep for 5.153923 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-27 09:10:01,226 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 09:10:01,310 - aiogram.dispatcher - WARNING - Sleep for 5.101338 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-27 09:44:41,000 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 09:44:41,081 - aiogram.dispatcher - WARNING - Sleep for 4.967169 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-27 10:00:24,953 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 10:00:25,041 - aiogram.dispatcher - WARNING - Sleep for 4.892374 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-27 10:17:53,906 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 10:17:53,906 - aiogram.dispatcher - WARNING - Sleep for 5.000324 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-08-27 10:20:04,117 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 10:20:04,202 - aiogram.dispatcher - WARNING - Sleep for 5.007872 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-08-27 10:20:21,151 - aiogram.dispatcher - INFO - Connection established (tryings = 16, bot id = 8413666974)
2025-08-27 10:21:33,400 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 10:21:33,403 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 10:21:33,403 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 10:21:33,660 - __main__ - INFO - Работа бота завершена
2025-08-27 11:58:14,960 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 11:58:14,964 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:58:14,964 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 11:58:14,964 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 11:58:14,965 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 11:58:14,965 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 11:58:14,965 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 11:58:14,965 - __main__ - INFO - База данных инициализирована
2025-08-27 11:58:14,982 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 11:58:14,982 - __main__ - INFO - Запуск polling...
2025-08-27 11:58:14,982 - aiogram.dispatcher - INFO - Start polling
2025-08-27 11:58:15,797 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 11:58:15,918 - __main__ - INFO - FSM State Change: None
2025-08-27 11:58:15,919 - __main__ - INFO - FSM State Change: None
2025-08-27 11:58:15,922 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:58:15,930 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 11:58:15,930 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (37996964,)
2025-08-27 11:58:15,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:58:15,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 11:58:15,932 - sqlalchemy.engine.Engine - INFO - [cached since 0.001918s ago] (37996964,)
2025-08-27 11:58:16,577 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 11:58:16,577 - aiogram.event - INFO - Update id=954948427 is handled. Duration 667 ms by bot id=8413666974
2025-08-27 11:58:16,610 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 11:58:16,611 - aiogram.event - INFO - Update id=954948426 is handled. Duration 701 ms by bot id=8413666974
2025-08-27 11:58:24,372 - __main__ - INFO - FSM State Change: None
2025-08-27 11:58:24,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:58:24,399 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 11:58:24,399 - sqlalchemy.engine.Engine - INFO - [cached since 8.47s ago] (37996964,)
2025-08-27 11:58:24,412 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 11:58:24,412 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 0)
2025-08-27 11:58:24,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 11:58:24,666 - aiogram.event - INFO - Update id=954948428 is handled. Duration 294 ms by bot id=8413666974
2025-08-27 11:58:32,367 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 11:58:32,495 - aiogram.event - INFO - Update id=954948429 is handled. Duration 157 ms by bot id=8413666974
2025-08-27 11:58:34,810 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 11:58:34,812 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 11:58:34,929 - root - INFO - Состояние установено: waiting_media
2025-08-27 11:58:34,930 - aiogram.event - INFO - Update id=954948430 is handled. Duration 120 ms by bot id=8413666974
2025-08-27 11:58:37,008 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 11:58:37,128 - aiogram.event - INFO - Update id=954948431 is handled. Duration 121 ms by bot id=8413666974
2025-08-27 11:59:00,276 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 11:59:00,295 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 11:59:00,296 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 11:59:00,299 - aiogram.event - INFO - Update id=954948434 is handled. Duration 26 ms by bot id=8413666974
2025-08-27 11:59:00,299 - aiogram.event - INFO - Update id=954948433 is handled. Duration 26 ms by bot id=8413666974
2025-08-27 11:59:00,299 - aiogram.event - INFO - Update id=954948432 is handled. Duration 28 ms by bot id=8413666974
2025-08-27 11:59:10,350 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 11:59:10,474 - aiogram.event - INFO - Update id=954948435 is handled. Duration 124 ms by bot id=8413666974
2025-08-27 11:59:15,352 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 11:59:15,507 - aiogram.event - INFO - Update id=954948436 is handled. Duration 155 ms by bot id=8413666974
2025-08-27 11:59:18,918 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 11:59:19,097 - aiogram.event - INFO - Update id=954948437 is handled. Duration 181 ms by bot id=8413666974
2025-08-27 11:59:23,165 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 11:59:23,382 - aiogram.event - INFO - Update id=954948438 is handled. Duration 223 ms by bot id=8413666974
2025-08-27 11:59:25,902 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 11:59:25,909 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:59:25,917 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 11:59:25,917 - sqlalchemy.engine.Engine - INFO - [generated in 0.00126s] ('0203', 1, 'буккет хризантем', 'буккет хризантем №0203', '["AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN5AAM2BA", "AgACAgIAAxkBAANAaK5AP8_iumuwTNKqoPLxDt_1Em4AAlL2MRsJF3lJ9etWy46PJHIBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA"]', None, 'выываыаываы', 'null', 200000, 'RUB')
2025-08-27 11:59:25,925 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 11:59:25,929 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:59:25,933 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 11:59:25,933 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (3,)
2025-08-27 11:59:26,085 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 11:59:26,086 - aiogram.event - INFO - Update id=954948439 is handled. Duration 185 ms by bot id=8413666974
2025-08-27 11:59:28,739 - __main__ - INFO - FSM State Change: None
2025-08-27 11:59:28,747 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 11:59:28,760 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 11:59:28,760 - sqlalchemy.engine.Engine - INFO - [cached since 72.83s ago] (37996964,)
2025-08-27 11:59:28,763 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 11:59:28,763 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (1, 10, 0)
2025-08-27 11:59:28,923 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 11:59:28,923 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1,)
2025-08-27 11:59:28,924 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 11:59:28,924 - aiogram.event - INFO - Update id=954948440 is handled. Duration 185 ms by bot id=8413666974
2025-08-27 12:10:24,143 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 12:10:24,230 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 12:26:20,951 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 12:26:21,023 - aiogram.dispatcher - WARNING - Sleep for 1.437056 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 12:44:18,023 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 12:44:18,024 - aiogram.dispatcher - WARNING - Sleep for 1.848764 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-27 13:01:38,930 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 13:01:38,930 - aiogram.dispatcher - WARNING - Sleep for 2.564337 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-27 13:17:12,922 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 13:17:12,993 - aiogram.dispatcher - WARNING - Sleep for 3.217405 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-27 13:32:41,915 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 13:32:41,915 - aiogram.dispatcher - WARNING - Sleep for 4.288935 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-27 13:47:57,906 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 13:47:57,976 - aiogram.dispatcher - WARNING - Sleep for 5.137621 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-27 13:58:32,289 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 13:58:32,292 - aiogram.dispatcher - WARNING - Sleep for 4.954040 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-27 13:59:37,254 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 13:59:37,256 - aiogram.dispatcher - WARNING - Sleep for 5.065733 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-27 14:00:42,332 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 14:00:42,334 - aiogram.dispatcher - WARNING - Sleep for 5.007272 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-27 14:01:47,354 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 14:01:47,356 - aiogram.dispatcher - WARNING - Sleep for 4.924702 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-27 14:02:52,287 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 14:02:52,289 - aiogram.dispatcher - WARNING - Sleep for 4.828306 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-27 14:03:57,130 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 14:03:57,133 - aiogram.dispatcher - WARNING - Sleep for 4.950400 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-27 14:05:02,097 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-08-27 14:05:02,099 - aiogram.dispatcher - WARNING - Sleep for 5.133160 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-27 14:05:19,114 - aiogram.dispatcher - INFO - Connection established (tryings = 14, bot id = 8413666974)
2025-08-27 14:24:24,986 - __main__ - INFO - FSM State Change: None
2025-08-27 14:24:25,024 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 14:24:25,025 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 14:24:25,025 - sqlalchemy.engine.Engine - INFO - [cached since 2278s ago] (37996964,)
2025-08-27 14:24:26,722 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 14:24:26,722 - aiogram.event - INFO - Update id=954948441 is handled. Duration 1814 ms by bot id=8413666974
2025-08-27 14:24:29,357 - __main__ - INFO - FSM State Change: None
2025-08-27 14:24:29,358 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 14:24:29,359 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 14:24:29,359 - sqlalchemy.engine.Engine - INFO - [cached since 2282s ago] (37996964,)
2025-08-27 14:24:29,373 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 14:24:29,373 - sqlalchemy.engine.Engine - INFO - [cached since 2274s ago] (1, 0)
2025-08-27 14:24:29,545 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 14:24:29,546 - aiogram.event - INFO - Update id=954948442 is handled. Duration 189 ms by bot id=8413666974
2025-08-27 14:24:34,682 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 14:24:34,847 - aiogram.event - INFO - Update id=954948443 is handled. Duration 165 ms by bot id=8413666974
2025-08-27 14:24:39,553 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 14:24:39,554 - aiogram.event - INFO - Update id=954948444 is handled. Duration 1 ms by bot id=8413666974
2025-08-27 14:24:49,472 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 14:24:49,474 - aiogram.event - INFO - Update id=954948445 is handled. Duration 2 ms by bot id=8413666974
2025-08-27 14:24:54,804 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 14:24:55,003 - aiogram.event - INFO - Update id=954948446 is handled. Duration 199 ms by bot id=8413666974
2025-08-27 14:24:58,816 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 14:24:58,819 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 14:24:59,029 - root - INFO - Состояние установено: waiting_media
2025-08-27 14:24:59,030 - aiogram.event - INFO - Update id=954948447 is handled. Duration 214 ms by bot id=8413666974
2025-08-27 14:25:20,807 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 14:25:20,809 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 14:25:20,809 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 14:25:20,812 - aiogram.event - INFO - Update id=954948448 is handled. Duration 15 ms by bot id=8413666974
2025-08-27 14:25:20,812 - aiogram.event - INFO - Update id=954948450 is handled. Duration 10 ms by bot id=8413666974
2025-08-27 14:25:20,812 - aiogram.event - INFO - Update id=954948449 is handled. Duration 11 ms by bot id=8413666974
2025-08-27 14:25:25,445 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 14:25:25,769 - aiogram.event - INFO - Update id=954948451 is handled. Duration 324 ms by bot id=8413666974
2025-08-27 14:25:28,734 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 14:25:28,987 - aiogram.event - INFO - Update id=954948452 is handled. Duration 254 ms by bot id=8413666974
2025-08-27 14:25:32,288 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 14:25:32,490 - aiogram.event - INFO - Update id=954948453 is handled. Duration 203 ms by bot id=8413666974
2025-08-27 14:25:36,581 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 14:25:36,886 - aiogram.event - INFO - Update id=954948454 is handled. Duration 305 ms by bot id=8413666974
2025-08-27 14:25:39,834 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 14:25:39,843 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 14:25:39,848 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 14:25:39,848 - sqlalchemy.engine.Engine - INFO - [cached since 2283s ago] ('0204', 1, 'dssadasd', 'dssadasd №0204', '["AgACAgIAAxkBAANAaK5AP8_iumuwTNKqoPLxDt_1Em4AAlL2MRsJF3lJ9etWy46PJHIBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN5AAM2BA", "AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA"]', None, 'dasdasdsa', 'null', 200000, 'RUB')
2025-08-27 14:25:39,860 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 14:25:39,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 14:25:39,864 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 14:25:39,864 - sqlalchemy.engine.Engine - INFO - [cached since 2283s ago] (4,)
2025-08-27 14:25:40,070 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 14:25:40,071 - aiogram.event - INFO - Update id=954948455 is handled. Duration 238 ms by bot id=8413666974
2025-08-27 14:25:44,686 - __main__ - INFO - FSM State Change: None
2025-08-27 14:25:44,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 14:25:44,693 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 14:25:44,694 - sqlalchemy.engine.Engine - INFO - [cached since 2358s ago] (37996964,)
2025-08-27 14:25:44,702 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 14:25:44,702 - sqlalchemy.engine.Engine - INFO - [cached since 2285s ago] (1, 10, 0)
2025-08-27 14:25:44,868 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 14:25:44,868 - sqlalchemy.engine.Engine - INFO - [cached since 2285s ago] (1,)
2025-08-27 14:25:44,869 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 14:25:44,870 - aiogram.event - INFO - Update id=954948456 is handled. Duration 184 ms by bot id=8413666974
2025-08-27 15:03:39,706 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 15:03:39,709 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 15:08:15,582 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 15:08:15,583 - aiogram.dispatcher - WARNING - Sleep for 1.370477 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 15:10:43,835 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 15:10:43,838 - aiogram.dispatcher - WARNING - Sleep for 2.054862 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-27 15:10:56,804 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-08-27 15:42:54,659 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 15:42:54,660 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 16:00:07,532 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 16:00:07,611 - aiogram.dispatcher - WARNING - Sleep for 1.265754 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 16:16:57,494 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 16:16:57,574 - aiogram.dispatcher - WARNING - Sleep for 1.531099 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-27 16:33:07,467 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 16:33:07,468 - aiogram.dispatcher - WARNING - Sleep for 1.979724 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-27 16:51:07,027 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 16:51:07,109 - aiogram.dispatcher - WARNING - Sleep for 2.802978 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-27 17:07:33,965 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 17:07:33,965 - aiogram.dispatcher - WARNING - Sleep for 3.657130 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-27 17:24:45,987 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 17:24:45,988 - aiogram.dispatcher - WARNING - Sleep for 4.674523 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-27 17:42:10,840 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 17:42:10,840 - aiogram.dispatcher - WARNING - Sleep for 4.963402 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-27 17:57:53,868 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 17:57:53,869 - aiogram.dispatcher - WARNING - Sleep for 4.922555 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-27 18:05:03,373 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 18:05:03,374 - aiogram.dispatcher - WARNING - Sleep for 4.902127 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-27 18:05:19,871 - aiogram.dispatcher - INFO - Connection established (tryings = 10, bot id = 8413666974)
2025-08-27 18:12:01,490 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 18:12:01,506 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 18:12:01,507 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 18:12:01,777 - __main__ - INFO - Работа бота завершена
2025-08-27 18:13:06,174 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 18:13:06,225 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:06,225 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 18:13:06,225 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 18:13:06,226 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 18:13:06,226 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 18:13:06,227 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 18:13:06,227 - __main__ - INFO - База данных инициализирована
2025-08-27 18:13:06,244 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 18:13:06,244 - __main__ - INFO - Запуск polling...
2025-08-27 18:13:06,244 - aiogram.dispatcher - INFO - Start polling
2025-08-27 18:13:07,283 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 18:13:07,514 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:07,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:07,527 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 18:13:07,527 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (37996964,)
2025-08-27 18:13:08,449 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:13:08,450 - aiogram.event - INFO - Update id=954948457 is handled. Duration 947 ms by bot id=8413666974
2025-08-27 18:13:11,740 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:11,759 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:11,760 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 18:13:11,760 - sqlalchemy.engine.Engine - INFO - [cached since 4.233s ago] (37996964,)
2025-08-27 18:13:11,766 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 18:13:11,766 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1, 10, 0)
2025-08-27 18:13:11,892 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:13:11,893 - aiogram.event - INFO - Update id=954948458 is handled. Duration 153 ms by bot id=8413666974
2025-08-27 18:13:21,017 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:21,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:21,023 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 18:13:21,023 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ('0204',)
2025-08-27 18:13:21,182 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:13:21,184 - aiogram.event - INFO - Update id=954948459 is handled. Duration 168 ms by bot id=8413666974
2025-08-27 18:13:31,923 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:31,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:31,927 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 18:13:31,928 - sqlalchemy.engine.Engine - INFO - [cached since 10.9s ago] ('0204',)
2025-08-27 18:13:31,933 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-27 18:13:31,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (4,)
2025-08-27 18:13:31,938 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 18:13:32,092 - aiogram.event - INFO - Update id=954948460 is handled. Duration 170 ms by bot id=8413666974
2025-08-27 18:13:42,282 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:42,292 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:42,293 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 18:13:42,294 - sqlalchemy.engine.Engine - INFO - [cached since 34.77s ago] (37996964,)
2025-08-27 18:13:42,297 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 18:13:42,297 - sqlalchemy.engine.Engine - INFO - [cached since 30.53s ago] (1, 10, 0)
2025-08-27 18:13:42,303 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 18:13:42,303 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1,)
2025-08-27 18:13:42,412 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:13:42,413 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-27 18:13:42,551 - aiogram.event - INFO - Update id=954948461 is handled. Duration 273 ms by bot id=8413666974
2025-08-27 18:13:47,124 - __main__ - INFO - FSM State Change: None
2025-08-27 18:13:47,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:13:47,129 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 18:13:47,129 - sqlalchemy.engine.Engine - INFO - [cached since 39.6s ago] (37996964,)
2025-08-27 18:13:47,130 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 18:13:47,131 - sqlalchemy.engine.Engine - INFO - [cached since 35.36s ago] (1, 10, 0)
2025-08-27 18:13:47,364 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:13:47,365 - aiogram.event - INFO - Update id=954948462 is handled. Duration 241 ms by bot id=8413666974
2025-08-27 18:15:22,020 - __main__ - INFO - FSM State Change: None
2025-08-27 18:15:22,028 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:15:22,030 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 18:15:22,030 - sqlalchemy.engine.Engine - INFO - [cached since 121s ago] ('0203',)
2025-08-27 18:15:22,173 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:15:22,174 - aiogram.event - INFO - Update id=954948463 is handled. Duration 157 ms by bot id=8413666974
2025-08-27 18:15:33,219 - __main__ - INFO - FSM State Change: None
2025-08-27 18:15:33,222 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:15:33,223 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 18:15:33,223 - sqlalchemy.engine.Engine - INFO - [cached since 132.2s ago] ('0203',)
2025-08-27 18:15:33,227 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-27 18:15:33,227 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] (3,)
2025-08-27 18:15:33,231 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 18:15:33,369 - aiogram.event - INFO - Update id=954948464 is handled. Duration 150 ms by bot id=8413666974
2025-08-27 18:17:48,912 - __main__ - INFO - FSM State Change: None
2025-08-27 18:17:48,938 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:17:48,952 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 18:17:48,954 - sqlalchemy.engine.Engine - INFO - [cached since 281.4s ago] (37996964,)
2025-08-27 18:17:48,960 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 18:17:48,960 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1, 0)
2025-08-27 18:17:49,107 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:17:49,108 - aiogram.event - INFO - Update id=954948465 is handled. Duration 199 ms by bot id=8413666974
2025-08-27 18:18:05,129 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 18:18:05,262 - aiogram.event - INFO - Update id=954948466 is handled. Duration 179 ms by bot id=8413666974
2025-08-27 18:18:08,829 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 18:18:08,831 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 18:18:09,087 - root - INFO - Состояние установлено: waiting_media
2025-08-27 18:18:09,087 - aiogram.event - INFO - Update id=954948467 is handled. Duration 259 ms by bot id=8413666974
2025-08-27 18:19:01,898 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 18:19:01,912 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 18:19:01,914 - aiogram.event - INFO - Update id=954948468 is handled. Duration 22 ms by bot id=8413666974
2025-08-27 18:19:01,914 - aiogram.event - INFO - Update id=954948469 is handled. Duration 21 ms by bot id=8413666974
2025-08-27 18:19:09,163 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 18:19:09,323 - aiogram.event - INFO - Update id=954948470 is handled. Duration 160 ms by bot id=8413666974
2025-08-27 18:19:13,900 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 18:19:14,089 - aiogram.event - INFO - Update id=954948471 is handled. Duration 190 ms by bot id=8413666974
2025-08-27 18:19:16,963 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 18:19:17,091 - aiogram.event - INFO - Update id=954948472 is handled. Duration 129 ms by bot id=8413666974
2025-08-27 18:19:21,083 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 18:19:21,311 - aiogram.event - INFO - Update id=954948473 is handled. Duration 228 ms by bot id=8413666974
2025-08-27 18:19:24,278 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 18:19:24,993 - root - ERROR - Ошибка при загрузке фото на сервер: Ошибка загрузки файла из памяти: expected string or bytes-like object, got 'NoneType'
2025-08-27 18:19:24,993 - root - WARNING - Не удалось загрузить фото 0 для букета 0203, используем file_id
2025-08-27 18:19:25,384 - root - ERROR - Ошибка при загрузке фото на сервер: Ошибка загрузки файла из памяти: expected string or bytes-like object, got 'NoneType'
2025-08-27 18:19:25,384 - root - WARNING - Не удалось загрузить фото 1 для букета 0203, используем file_id
2025-08-27 18:19:25,391 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:19:25,399 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 18:19:25,399 - sqlalchemy.engine.Engine - INFO - [generated in 0.00107s] ('0203', 1, 'ририориориро', 'ририориориро №0203', '["AgACAgIAAxkBAAOwaK8h5vhz2G_Ze4RwmklHp9hkwBkAAmn6MRsJF4FJFquGmmiB9f4BAAMCAAN5AAM2BA", "AgACAgIAAxkBAAOxaK8h5rRDvtl_330a30zNq1ssD04AAmr6MRsJF4FJDsalDd7G44sBAAMCAAN5AAM2BA"]', None, 'малволва оалв м', 'null', 200000, 'RUB')
2025-08-27 18:19:25,406 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 18:19:25,411 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 18:19:25,413 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 18:19:25,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (3,)
2025-08-27 18:19:25,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 18:19:25,667 - aiogram.event - INFO - Update id=954948474 is handled. Duration 1389 ms by bot id=8413666974
2025-08-27 18:51:41,360 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-27 18:51:41,366 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 18:51:53,102 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-27 19:00:29,666 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-27 19:00:29,668 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 19:00:41,045 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-27 21:09:50,286 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-27 21:09:50,288 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-27 23:20:53,423 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-27 23:20:53,425 - aiogram.dispatcher - WARNING - Sleep for 1.264543 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-27 23:21:41,717 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-27 23:22:52,711 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 23:22:52,722 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 23:22:52,722 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 23:22:52,984 - __main__ - INFO - Работа бота завершена
2025-08-27 23:24:28,659 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 23:24:28,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:28,710 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 23:24:28,710 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 23:24:28,711 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 23:24:28,711 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 23:24:28,712 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:24:28,712 - __main__ - INFO - База данных инициализирована
2025-08-27 23:24:28,729 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 23:24:28,729 - __main__ - INFO - Запуск polling...
2025-08-27 23:24:28,729 - aiogram.dispatcher - INFO - Start polling
2025-08-27 23:24:28,999 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 23:24:29,094 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:29,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:29,107 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:24:29,107 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (37996964,)
2025-08-27 23:24:29,411 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:29,412 - aiogram.event - INFO - Update id=954948475 is handled. Duration 324 ms by bot id=8413666974
2025-08-27 23:24:31,883 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:31,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:31,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:24:31,885 - sqlalchemy.engine.Engine - INFO - [cached since 2.779s ago] (37996964,)
2025-08-27 23:24:31,904 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:24:31,904 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (1, 10, 0)
2025-08-27 23:24:32,056 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:32,057 - aiogram.event - INFO - Update id=954948476 is handled. Duration 175 ms by bot id=8413666974
2025-08-27 23:24:35,909 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:35,913 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:35,916 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:24:35,916 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('0203',)
2025-08-27 23:24:36,026 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:36,027 - aiogram.event - INFO - Update id=954948477 is handled. Duration 118 ms by bot id=8413666974
2025-08-27 23:24:38,901 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:38,906 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:38,907 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:24:38,907 - sqlalchemy.engine.Engine - INFO - [cached since 2.992s ago] ('0203',)
2025-08-27 23:24:38,913 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-27 23:24:38,913 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (3,)
2025-08-27 23:24:38,916 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:24:39,036 - aiogram.event - INFO - Update id=954948478 is handled. Duration 135 ms by bot id=8413666974
2025-08-27 23:24:40,383 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:40,386 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:40,386 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:24:40,387 - sqlalchemy.engine.Engine - INFO - [cached since 11.28s ago] (37996964,)
2025-08-27 23:24:40,389 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:24:40,389 - sqlalchemy.engine.Engine - INFO - [cached since 8.485s ago] (1, 10, 0)
2025-08-27 23:24:40,397 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 23:24:40,397 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (1,)
2025-08-27 23:24:40,485 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:40,486 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-27 23:24:40,572 - aiogram.event - INFO - Update id=954948479 is handled. Duration 190 ms by bot id=8413666974
2025-08-27 23:24:43,291 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:43,292 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:43,294 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:24:43,294 - sqlalchemy.engine.Engine - INFO - [cached since 14.19s ago] (37996964,)
2025-08-27 23:24:43,295 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:24:43,295 - sqlalchemy.engine.Engine - INFO - [cached since 11.39s ago] (1, 10, 0)
2025-08-27 23:24:43,296 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 23:24:43,296 - sqlalchemy.engine.Engine - INFO - [cached since 2.899s ago] (1,)
2025-08-27 23:24:43,372 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:43,372 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-27 23:24:43,456 - aiogram.event - INFO - Update id=954948480 is handled. Duration 168 ms by bot id=8413666974
2025-08-27 23:24:45,183 - __main__ - INFO - FSM State Change: None
2025-08-27 23:24:45,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:24:45,207 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:24:45,210 - sqlalchemy.engine.Engine - INFO - [cached since 16.1s ago] (37996964,)
2025-08-27 23:24:45,222 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 23:24:45,222 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (1, 0)
2025-08-27 23:24:45,367 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:24:45,368 - aiogram.event - INFO - Update id=954948481 is handled. Duration 187 ms by bot id=8413666974
2025-08-27 23:25:19,483 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 23:25:19,502 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:25:19,503 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:25:19,503 - sqlalchemy.engine.Engine - INFO - [cached since 50.4s ago] (37996964,)
2025-08-27 23:25:19,507 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-27 23:25:19,507 - sqlalchemy.engine.Engine - INFO - [cached since 34.29s ago] (1, 0)
2025-08-27 23:25:19,610 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:25:19,610 - aiogram.event - INFO - Update id=954948482 is handled. Duration 168 ms by bot id=8413666974
2025-08-27 23:25:23,142 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 23:25:23,381 - aiogram.event - INFO - Update id=954948483 is handled. Duration 238 ms by bot id=8413666974
2025-08-27 23:25:26,144 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-27 23:25:26,145 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-27 23:25:26,250 - root - INFO - Состояние установлено: waiting_media
2025-08-27 23:25:26,251 - aiogram.event - INFO - Update id=954948484 is handled. Duration 108 ms by bot id=8413666974
2025-08-27 23:25:52,604 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 23:25:52,606 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 23:25:52,608 - aiogram.event - INFO - Update id=954948485 is handled. Duration 9 ms by bot id=8413666974
2025-08-27 23:25:52,609 - aiogram.event - INFO - Update id=954948486 is handled. Duration 8 ms by bot id=8413666974
2025-08-27 23:25:56,186 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-27 23:25:56,351 - aiogram.event - INFO - Update id=954948487 is handled. Duration 166 ms by bot id=8413666974
2025-08-27 23:25:59,510 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-27 23:25:59,677 - aiogram.event - INFO - Update id=954948488 is handled. Duration 167 ms by bot id=8413666974
2025-08-27 23:26:02,001 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-27 23:26:02,104 - aiogram.event - INFO - Update id=954948489 is handled. Duration 104 ms by bot id=8413666974
2025-08-27 23:26:06,815 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-27 23:26:07,010 - aiogram.event - INFO - Update id=954948490 is handled. Duration 195 ms by bot id=8413666974
2025-08-27 23:26:08,980 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-27 23:26:08,981 - root - WARNING - Не настроены учетные данные Yandex Object Storage
2025-08-27 23:26:08,982 - root - WARNING - Не настроены учетные данные Yandex Object Storage
2025-08-27 23:26:08,988 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:26:08,994 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 23:26:08,994 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('0203', 1, 'апкпуав', 'апкпуав №0203', '["AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA"]', None, 'ваыаываы', 'null', 700000, 'RUB')
2025-08-27 23:26:09,000 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:26:09,004 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:26:09,006 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-27 23:26:09,006 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (3,)
2025-08-27 23:26:09,113 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:26:09,114 - aiogram.event - INFO - Update id=954948491 is handled. Duration 134 ms by bot id=8413666974
2025-08-27 23:26:38,397 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-27 23:26:38,400 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 23:26:38,400 - aiogram.dispatcher - INFO - Polling stopped
2025-08-27 23:26:38,658 - __main__ - INFO - Работа бота завершена
2025-08-27 23:56:43,158 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-27 23:56:43,210 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:56:43,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-27 23:56:43,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 23:56:43,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-27 23:56:43,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-27 23:56:43,212 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:56:43,212 - __main__ - INFO - База данных инициализирована
2025-08-27 23:56:43,229 - __main__ - INFO - Бот успешно создан и настроен
2025-08-27 23:56:43,229 - __main__ - INFO - Запуск polling...
2025-08-27 23:56:43,230 - aiogram.dispatcher - INFO - Start polling
2025-08-27 23:56:43,492 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-27 23:56:55,813 - __main__ - INFO - FSM State Change: None
2025-08-27 23:56:55,823 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:56:55,835 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:56:55,835 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (37996964,)
2025-08-27 23:56:56,115 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:56:56,116 - aiogram.event - INFO - Update id=954948492 is handled. Duration 407 ms by bot id=8413666974
2025-08-27 23:56:58,244 - __main__ - INFO - FSM State Change: None
2025-08-27 23:56:58,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:56:58,246 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:56:58,246 - sqlalchemy.engine.Engine - INFO - [cached since 2.412s ago] (37996964,)
2025-08-27 23:56:58,248 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:56:58,248 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] (1, 10, 0)
2025-08-27 23:56:58,359 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:56:58,360 - aiogram.event - INFO - Update id=954948493 is handled. Duration 116 ms by bot id=8413666974
2025-08-27 23:57:00,277 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:00,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:00,282 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:57:00,282 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('0203',)
2025-08-27 23:57:00,398 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:00,400 - aiogram.event - INFO - Update id=954948494 is handled. Duration 123 ms by bot id=8413666974
2025-08-27 23:57:02,161 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:02,164 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:02,165 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:57:02,165 - sqlalchemy.engine.Engine - INFO - [cached since 1.884s ago] ('0203',)
2025-08-27 23:57:02,169 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-27 23:57:02,169 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (3,)
2025-08-27 23:57:02,171 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:57:02,271 - aiogram.event - INFO - Update id=954948495 is handled. Duration 110 ms by bot id=8413666974
2025-08-27 23:57:06,023 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:06,026 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:06,027 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:57:06,027 - sqlalchemy.engine.Engine - INFO - [cached since 10.19s ago] (37996964,)
2025-08-27 23:57:06,028 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:57:06,028 - sqlalchemy.engine.Engine - INFO - [cached since 7.781s ago] (1, 10, 0)
2025-08-27 23:57:06,030 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 23:57:06,031 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1,)
2025-08-27 23:57:06,114 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:06,115 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-27 23:57:06,197 - aiogram.event - INFO - Update id=954948496 is handled. Duration 175 ms by bot id=8413666974
2025-08-27 23:57:16,398 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:16,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:16,401 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:57:16,402 - sqlalchemy.engine.Engine - INFO - [cached since 20.57s ago] (37996964,)
2025-08-27 23:57:16,403 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:57:16,404 - sqlalchemy.engine.Engine - INFO - [cached since 18.16s ago] (1, 10, 0)
2025-08-27 23:57:16,406 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-27 23:57:16,406 - sqlalchemy.engine.Engine - INFO - [cached since 10.38s ago] (1,)
2025-08-27 23:57:16,484 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:16,485 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-27 23:57:16,630 - aiogram.event - INFO - Update id=954948497 is handled. Duration 233 ms by bot id=8413666974
2025-08-27 23:57:21,474 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:21,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:21,478 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:57:21,478 - sqlalchemy.engine.Engine - INFO - [cached since 25.64s ago] (37996964,)
2025-08-27 23:57:21,480 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:57:21,480 - sqlalchemy.engine.Engine - INFO - [cached since 23.23s ago] (1, 10, 0)
2025-08-27 23:57:21,594 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:21,594 - aiogram.event - INFO - Update id=954948498 is handled. Duration 120 ms by bot id=8413666974
2025-08-27 23:57:24,434 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:24,446 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:24,446 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:57:24,447 - sqlalchemy.engine.Engine - INFO - [cached since 28.61s ago] (8413666974,)
2025-08-27 23:57:24,452 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, media_limit, created_at, updated_at) VALUES (?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-27 23:57:24,453 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (8413666974, 6)
2025-08-27 23:57:24,456 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:57:24,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:24,460 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.id = ?
2025-08-27 23:57:24,460 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (2,)
2025-08-27 23:57:24,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:24,651 - aiogram.event - INFO - Update id=954948499 is handled. Duration 218 ms by bot id=8413666974
2025-08-27 23:57:31,709 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:31,711 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:31,711 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-27 23:57:31,711 - sqlalchemy.engine.Engine - INFO - [cached since 35.88s ago] (37996964,)
2025-08-27 23:57:31,713 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-27 23:57:31,716 - sqlalchemy.engine.Engine - INFO - [cached since 33.47s ago] (1, 10, 0)
2025-08-27 23:57:31,849 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:31,849 - aiogram.event - INFO - Update id=954948500 is handled. Duration 141 ms by bot id=8413666974
2025-08-27 23:57:34,297 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:34,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:34,299 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:57:34,300 - sqlalchemy.engine.Engine - INFO - [cached since 34.02s ago] ('0202',)
2025-08-27 23:57:34,415 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-27 23:57:34,418 - aiogram.event - INFO - Update id=954948501 is handled. Duration 121 ms by bot id=8413666974
2025-08-27 23:57:37,565 - __main__ - INFO - FSM State Change: None
2025-08-27 23:57:37,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-27 23:57:37,569 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-27 23:57:37,569 - sqlalchemy.engine.Engine - INFO - [cached since 37.29s ago] ('0202',)
2025-08-27 23:57:37,571 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-27 23:57:37,571 - sqlalchemy.engine.Engine - INFO - [cached since 35.4s ago] (2,)
2025-08-27 23:57:37,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-27 23:57:37,674 - aiogram.event - INFO - Update id=954948502 is handled. Duration 110 ms by bot id=8413666974
2025-08-28 00:21:28,873 - __main__ - INFO - FSM State Change: None
2025-08-28 00:21:28,884 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 00:21:28,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 00:21:28,885 - sqlalchemy.engine.Engine - INFO - [cached since 1473s ago] (37996964,)
2025-08-28 00:21:28,900 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 00:21:28,901 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (1, 0)
2025-08-28 00:21:29,026 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 00:21:29,027 - aiogram.event - INFO - Update id=954948503 is handled. Duration 263 ms by bot id=8413666974
2025-08-28 00:21:35,471 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 00:21:35,567 - aiogram.event - INFO - Update id=954948504 is handled. Duration 97 ms by bot id=8413666974
2025-08-28 00:21:40,611 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 00:21:40,614 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 00:21:40,740 - root - INFO - Состояние установлено: waiting_media
2025-08-28 00:21:40,740 - aiogram.event - INFO - Update id=954948505 is handled. Duration 130 ms by bot id=8413666974
2025-08-28 00:22:00,225 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 00:22:00,228 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 00:22:00,233 - aiogram.event - INFO - Update id=954948506 is handled. Duration 34 ms by bot id=8413666974
2025-08-28 00:22:00,233 - aiogram.event - INFO - Update id=954948507 is handled. Duration 33 ms by bot id=8413666974
2025-08-28 00:22:26,667 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 00:22:26,834 - aiogram.event - INFO - Update id=954948508 is handled. Duration 168 ms by bot id=8413666974
2025-08-28 00:22:30,991 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 00:22:31,121 - aiogram.event - INFO - Update id=954948509 is handled. Duration 130 ms by bot id=8413666974
2025-08-28 00:22:34,887 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 00:22:35,010 - aiogram.event - INFO - Update id=954948510 is handled. Duration 125 ms by bot id=8413666974
2025-08-28 00:22:39,610 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 00:22:39,751 - aiogram.event - INFO - Update id=954948511 is handled. Duration 142 ms by bot id=8413666974
2025-08-28 00:22:41,896 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 00:22:42,300 - root - ERROR - Ошибка при загрузке фото на сервер: Ошибка загрузки файла из памяти: expected string or bytes-like object, got 'NoneType'
2025-08-28 00:22:42,300 - root - WARNING - Не удалось загрузить фото 0 для букета 0202, используем file_id
2025-08-28 00:22:43,311 - root - ERROR - Ошибка при загрузке фото на сервер: Ошибка загрузки файла из памяти: expected string or bytes-like object, got 'NoneType'
2025-08-28 00:22:43,311 - root - WARNING - Не удалось загрузить фото 1 для букета 0202, используем file_id
2025-08-28 00:22:43,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 00:22:43,325 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 00:22:43,325 - sqlalchemy.engine.Engine - INFO - [generated in 0.00087s] ('0202', 1, 'тетс тестов', 'тетс тестов №0202', '["AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA", "AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA"]', None, 'ориориорио', 'null', 567700, 'RUB')
2025-08-28 00:22:43,332 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 00:22:43,336 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 00:22:43,338 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 00:22:43,338 - sqlalchemy.engine.Engine - INFO - [generated in 0.00027s] (2,)
2025-08-28 00:22:43,451 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 00:22:43,452 - aiogram.event - INFO - Update id=954948512 is handled. Duration 1557 ms by bot id=8413666974
2025-08-28 00:40:50,198 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 00:40:50,334 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 00:41:02,149 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 00:42:10,977 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 00:42:10,980 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 00:42:10,980 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 00:42:11,237 - __main__ - INFO - Работа бота завершена
2025-08-28 01:26:42,395 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 01:26:42,399 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:26:42,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 01:26:42,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 01:26:42,399 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 01:26:42,399 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 01:26:42,400 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:26:42,400 - __main__ - INFO - База данных инициализирована
2025-08-28 01:26:42,417 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 01:26:42,418 - __main__ - INFO - Запуск polling...
2025-08-28 01:26:42,418 - aiogram.dispatcher - INFO - Start polling
2025-08-28 01:26:42,685 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 01:28:36,160 - __main__ - INFO - FSM State Change: None
2025-08-28 01:28:36,166 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:28:36,175 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:28:36,175 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (37996964,)
2025-08-28 01:28:36,465 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:28:36,466 - aiogram.event - INFO - Update id=954948513 is handled. Duration 343 ms by bot id=8413666974
2025-08-28 01:28:38,611 - __main__ - INFO - FSM State Change: None
2025-08-28 01:28:38,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:28:38,615 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:28:38,615 - sqlalchemy.engine.Engine - INFO - [cached since 2.441s ago] (37996964,)
2025-08-28 01:28:38,619 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 01:28:38,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00012s] (1, 0)
2025-08-28 01:28:38,713 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:28:38,714 - aiogram.event - INFO - Update id=954948514 is handled. Duration 103 ms by bot id=8413666974
2025-08-28 01:28:45,357 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 01:28:45,475 - aiogram.event - INFO - Update id=954948515 is handled. Duration 118 ms by bot id=8413666974
2025-08-28 01:28:47,608 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 01:28:47,610 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 01:28:47,738 - root - INFO - Состояние установлено: waiting_media
2025-08-28 01:28:47,738 - aiogram.event - INFO - Update id=954948516 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 01:29:05,673 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:29:05,674 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:29:05,677 - aiogram.event - INFO - Update id=954948517 is handled. Duration 38 ms by bot id=8413666974
2025-08-28 01:29:05,678 - aiogram.event - INFO - Update id=954948518 is handled. Duration 14 ms by bot id=8413666974
2025-08-28 01:29:09,364 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:29:09,461 - aiogram.event - INFO - Update id=954948519 is handled. Duration 98 ms by bot id=8413666974
2025-08-28 01:29:14,093 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 01:29:14,194 - aiogram.event - INFO - Update id=954948520 is handled. Duration 101 ms by bot id=8413666974
2025-08-28 01:29:16,555 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 01:29:16,652 - aiogram.event - INFO - Update id=954948521 is handled. Duration 98 ms by bot id=8413666974
2025-08-28 01:29:21,115 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 01:29:21,214 - aiogram.event - INFO - Update id=954948522 is handled. Duration 99 ms by bot id=8413666974
2025-08-28 01:29:23,334 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 01:29:23,336 - root - INFO - Начинаем загрузку медиа для букета 0203
2025-08-28 01:29:23,337 - root - INFO - Начинаем загрузку 2 медиафайлов для букета 0203
2025-08-28 01:29:23,337 - root - INFO - Обрабатываем медиа 1/2: AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA
2025-08-28 01:29:23,337 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:29:23,419 - root - INFO - Файл получен из Telegram: photos/file_3.jpg
2025-08-28 01:29:23,419 - root - INFO - Генерируем имя объекта: bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg
2025-08-28 01:29:23,653 - root - INFO - Размер файла: 83400 байт
2025-08-28 01:29:23,654 - root - INFO - YC_BUCKET_NAME: foto-cat
2025-08-28 01:29:23,654 - root - INFO - YC_ENDPOINT_URL: https://storage.yandexcloud.net
2025-08-28 01:29:23,654 - root - INFO - YC_ACCESS_KEY_ID: set
2025-08-28 01:29:23,655 - root - INFO - YC_SECRET_ACCESS_KEY: set
2025-08-28 01:29:24,030 - root - INFO - Yandex Object Storage client успешно инициализирован и подключен
2025-08-28 01:29:24,030 - root - INFO - Загрузка файла bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg, размер: 83400 байт
2025-08-28 01:29:24,193 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg
2025-08-28 01:29:24,193 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg
2025-08-28 01:29:24,194 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg
2025-08-28 01:29:24,194 - root - INFO - Обрабатываем медиа 2/2: AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA
2025-08-28 01:29:24,194 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:29:24,270 - root - INFO - Файл получен из Telegram: photos/file_2.jpg
2025-08-28 01:29:24,271 - root - INFO - Генерируем имя объекта: bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg
2025-08-28 01:29:24,506 - root - INFO - Размер файла: 89982 байт
2025-08-28 01:29:24,506 - root - INFO - Загрузка файла bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg, размер: 89982 байт
2025-08-28 01:29:24,654 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg
2025-08-28 01:29:24,654 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg
2025-08-28 01:29:24,654 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg
2025-08-28 01:29:24,654 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg']
2025-08-28 01:29:24,656 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:29:24,659 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 01:29:24,659 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('0203', 1, 'Тест тестов', 'Тест тестов №0203', '["https://foto-cat.storage.yandexcloud.net/bouquets/0203/5a2ae5a7cdc0424285812e141f1d7026.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0203/426a05c0621f4ed68b43f34f087fd59c.jpg"]', None, 'вавааав', 'null', 600000, 'RUB')
2025-08-28 01:29:24,664 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:29:24,667 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:29:24,670 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 01:29:24,670 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (3,)
2025-08-28 01:29:24,774 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:29:24,774 - aiogram.event - INFO - Update id=954948523 is handled. Duration 1441 ms by bot id=8413666974
2025-08-28 01:31:00,593 - __main__ - INFO - FSM State Change: None
2025-08-28 01:31:00,618 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:31:00,619 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:31:00,619 - sqlalchemy.engine.Engine - INFO - [cached since 144.4s ago] (37996964,)
2025-08-28 01:31:00,626 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:31:00,627 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (1, 10, 0)
2025-08-28 01:31:00,722 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:31:00,723 - aiogram.event - INFO - Update id=954948524 is handled. Duration 159 ms by bot id=8413666974
2025-08-28 01:31:05,736 - __main__ - INFO - FSM State Change: None
2025-08-28 01:31:05,738 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:31:05,740 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:31:05,740 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] ('0203',)
2025-08-28 01:31:06,444 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:31:06,446 - aiogram.event - INFO - Update id=954948525 is handled. Duration 710 ms by bot id=8413666974
2025-08-28 01:31:09,336 - __main__ - INFO - FSM State Change: None
2025-08-28 01:31:09,339 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:31:09,339 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:31:09,339 - sqlalchemy.engine.Engine - INFO - [cached since 3.6s ago] ('0203',)
2025-08-28 01:31:09,461 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:31:09,462 - aiogram.event - INFO - Update id=954948526 is handled. Duration 127 ms by bot id=8413666974
2025-08-28 01:32:58,352 - __main__ - INFO - FSM State Change: None
2025-08-28 01:32:58,507 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-08-28 01:32:58,691 - aiogram.event - INFO - Update id=954948527 is handled. Duration 342 ms by bot id=8413666974
2025-08-28 01:33:07,032 - __main__ - INFO - FSM State Change: None
2025-08-28 01:33:07,042 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:33:07,044 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:33:07,044 - sqlalchemy.engine.Engine - INFO - [cached since 121.3s ago] ('0203',)
2025-08-28 01:33:07,058 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 01:33:07,058 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (3,)
2025-08-28 01:33:07,061 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:33:07,165 - aiogram.event - INFO - Update id=954948528 is handled. Duration 133 ms by bot id=8413666974
2025-08-28 01:33:11,449 - __main__ - INFO - FSM State Change: None
2025-08-28 01:33:11,451 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:33:11,451 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:33:11,452 - sqlalchemy.engine.Engine - INFO - [cached since 275.3s ago] (37996964,)
2025-08-28 01:33:11,461 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:33:11,461 - sqlalchemy.engine.Engine - INFO - [cached since 130.8s ago] (1, 10, 0)
2025-08-28 01:33:11,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:33:11,567 - aiogram.event - INFO - Update id=954948529 is handled. Duration 118 ms by bot id=8413666974
2025-08-28 01:42:11,887 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 01:42:11,896 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 01:42:11,896 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 01:42:12,174 - __main__ - INFO - Работа бота завершена
2025-08-28 01:51:41,860 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 01:51:41,864 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:51:41,864 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 01:51:41,864 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 01:51:41,865 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 01:51:41,865 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 01:51:41,865 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:51:41,866 - __main__ - INFO - База данных инициализирована
2025-08-28 01:51:41,882 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 01:51:41,882 - __main__ - INFO - Запуск polling...
2025-08-28 01:51:41,882 - aiogram.dispatcher - INFO - Start polling
2025-08-28 01:51:42,668 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 01:51:53,648 - __main__ - INFO - FSM State Change: None
2025-08-28 01:51:53,655 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:51:53,667 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:51:53,667 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (37996964,)
2025-08-28 01:51:54,423 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:51:54,423 - aiogram.event - INFO - Update id=954948530 is handled. Duration 811 ms by bot id=8413666974
2025-08-28 01:52:16,960 - __main__ - INFO - FSM State Change: None
2025-08-28 01:52:16,970 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:52:16,971 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:52:16,971 - sqlalchemy.engine.Engine - INFO - [cached since 23.31s ago] (37996964,)
2025-08-28 01:52:16,975 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 01:52:16,975 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1, 0)
2025-08-28 01:52:17,131 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:52:17,131 - aiogram.event - INFO - Update id=954948531 is handled. Duration 200 ms by bot id=8413666974
2025-08-28 01:52:28,018 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 01:52:28,134 - aiogram.event - INFO - Update id=954948532 is handled. Duration 116 ms by bot id=8413666974
2025-08-28 01:52:32,360 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 01:52:32,362 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 01:52:32,496 - root - INFO - Состояние установлено: waiting_media
2025-08-28 01:52:32,496 - aiogram.event - INFO - Update id=954948533 is handled. Duration 137 ms by bot id=8413666974
2025-08-28 01:53:10,150 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,152 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,153 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,155 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,162 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,163 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:10,164 - aiogram.event - INFO - Update id=954948534 is handled. Duration 24 ms by bot id=8413666974
2025-08-28 01:53:10,164 - aiogram.event - INFO - Update id=954948535 is handled. Duration 23 ms by bot id=8413666974
2025-08-28 01:53:10,165 - aiogram.event - INFO - Update id=954948536 is handled. Duration 23 ms by bot id=8413666974
2025-08-28 01:53:10,165 - aiogram.event - INFO - Update id=954948537 is handled. Duration 23 ms by bot id=8413666974
2025-08-28 01:53:10,165 - aiogram.event - INFO - Update id=954948538 is handled. Duration 23 ms by bot id=8413666974
2025-08-28 01:53:10,165 - aiogram.event - INFO - Update id=954948539 is handled. Duration 23 ms by bot id=8413666974
2025-08-28 01:53:15,268 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 01:53:15,383 - aiogram.event - INFO - Update id=954948540 is handled. Duration 116 ms by bot id=8413666974
2025-08-28 01:53:27,136 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 01:53:27,261 - aiogram.event - INFO - Update id=954948541 is handled. Duration 138 ms by bot id=8413666974
2025-08-28 01:53:36,104 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 01:53:36,227 - aiogram.event - INFO - Update id=954948542 is handled. Duration 124 ms by bot id=8413666974
2025-08-28 01:53:40,548 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 01:53:40,667 - aiogram.event - INFO - Update id=954948543 is handled. Duration 121 ms by bot id=8413666974
2025-08-28 01:53:43,922 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 01:53:43,924 - root - INFO - Начинаем загрузку медиа для букета 0203
2025-08-28 01:53:43,924 - root - INFO - Начинаем загрузку 6 медиафайлов для букета 0203
2025-08-28 01:53:43,924 - root - INFO - Обрабатываем медиа 1/6: AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA
2025-08-28 01:53:43,925 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:44,055 - root - INFO - Файл получен из Telegram: photos/file_4.jpg
2025-08-28 01:53:44,055 - root - INFO - Генерируем имя объекта: bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg
2025-08-28 01:53:44,481 - root - INFO - Размер файла: 138763 байт
2025-08-28 01:53:44,700 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 01:53:44,701 - root - INFO - Загрузка файла bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg, размер: 138763 байт
2025-08-28 01:53:45,844 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg
2025-08-28 01:53:45,844 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg
2025-08-28 01:53:45,844 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg
2025-08-28 01:53:45,844 - root - INFO - Обрабатываем медиа 2/6: AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN5AAM2BA
2025-08-28 01:53:45,844 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMTaK426XAdr7-3SA5pW1iPvrYN0MoAAj72MRsJF3lJdVS3_xK-Ah4BAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:45,979 - root - INFO - Файл получен из Telegram: photos/file_5.jpg
2025-08-28 01:53:45,980 - root - INFO - Генерируем имя объекта: bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg
2025-08-28 01:53:46,479 - root - INFO - Размер файла: 228065 байт
2025-08-28 01:53:46,479 - root - INFO - Загрузка файла bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg, размер: 228065 байт
2025-08-28 01:53:46,897 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg
2025-08-28 01:53:46,898 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg
2025-08-28 01:53:46,898 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg
2025-08-28 01:53:46,898 - root - INFO - Обрабатываем медиа 3/6: AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN5AAM2BA
2025-08-28 01:53:46,898 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:47,018 - root - INFO - Файл получен из Telegram: photos/file_6.jpg
2025-08-28 01:53:47,019 - root - INFO - Генерируем имя объекта: bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg
2025-08-28 01:53:47,297 - root - INFO - Размер файла: 94029 байт
2025-08-28 01:53:47,298 - root - INFO - Загрузка файла bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg, размер: 94029 байт
2025-08-28 01:53:47,628 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg
2025-08-28 01:53:47,628 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg
2025-08-28 01:53:47,629 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg
2025-08-28 01:53:47,629 - root - INFO - Обрабатываем медиа 4/6: AgACAgIAAxkBAAMVaK426XkCiTYhq6miSCsZnZOoWAMAAkD2MRsJF3lJ_LmJc6SmTFABAAMCAAN5AAM2BA
2025-08-28 01:53:47,629 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMVaK426XkCiTYhq6miSCsZnZOoWAMAAkD2MRsJF3lJ_LmJc6SmTFABAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:47,756 - root - INFO - Файл получен из Telegram: photos/file_7.jpg
2025-08-28 01:53:47,757 - root - INFO - Генерируем имя объекта: bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg
2025-08-28 01:53:47,961 - root - INFO - Размер файла: 145008 байт
2025-08-28 01:53:47,962 - root - INFO - Загрузка файла bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg, размер: 145008 байт
2025-08-28 01:53:48,313 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg
2025-08-28 01:53:48,314 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg
2025-08-28 01:53:48,314 - root - INFO - Медиа 4 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg
2025-08-28 01:53:48,314 - root - INFO - Обрабатываем медиа 5/6: AgACAgIAAxkBAAMWaK426ezEC3_76k3brcxD0eqiJpwAAkH2MRsJF3lJSbh5kPitE7wBAAMCAAN5AAM2BA
2025-08-28 01:53:48,314 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMWaK426ezEC3_76k3brcxD0eqiJpwAAkH2MRsJF3lJSbh5kPitE7wBAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:48,485 - root - INFO - Файл получен из Telegram: photos/file_8.jpg
2025-08-28 01:53:48,485 - root - INFO - Генерируем имя объекта: bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg
2025-08-28 01:53:48,661 - root - INFO - Размер файла: 155259 байт
2025-08-28 01:53:48,661 - root - INFO - Загрузка файла bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg, размер: 155259 байт
2025-08-28 01:53:49,036 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg
2025-08-28 01:53:49,037 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg
2025-08-28 01:53:49,037 - root - INFO - Медиа 5 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg
2025-08-28 01:53:49,037 - root - INFO - Обрабатываем медиа 6/6: AgACAgIAAxkBAAMXaK426X17uUVdOEK4mVLeulnTnesAAkL2MRsJF3lJnsdtP5dv1RABAAMCAAN5AAM2BA
2025-08-28 01:53:49,037 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMXaK426X17uUVdOEK4mVLeulnTnesAAkL2MRsJF3lJnsdtP5dv1RABAAMCAAN5AAM2BA для букета 0203
2025-08-28 01:53:49,159 - root - INFO - Файл получен из Telegram: photos/file_9.jpg
2025-08-28 01:53:49,160 - root - INFO - Генерируем имя объекта: bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg
2025-08-28 01:53:49,336 - root - INFO - Размер файла: 205543 байт
2025-08-28 01:53:49,336 - root - INFO - Загрузка файла bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg, размер: 205543 байт
2025-08-28 01:53:49,714 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg
2025-08-28 01:53:49,714 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg
2025-08-28 01:53:49,714 - root - INFO - Медиа 6 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg
2025-08-28 01:53:49,715 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg']
2025-08-28 01:53:49,717 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:53:49,722 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 01:53:49,723 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('0203', 1, 'букет из хризантем', 'букет из хризантем №0203', '["https://foto-cat.storage.yandexcloud.net/bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/02 ... (272 characters truncated) ... t/bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg"]', None, 'классный укет', 'null', 300000, 'RUB')
2025-08-28 01:53:49,729 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:53:49,732 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:53:49,735 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 01:53:49,735 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (3,)
2025-08-28 01:53:49,854 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:53:49,854 - aiogram.event - INFO - Update id=954948544 is handled. Duration 5933 ms by bot id=8413666974
2025-08-28 01:53:59,443 - __main__ - INFO - FSM State Change: None
2025-08-28 01:53:59,449 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:53:59,450 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:53:59,450 - sqlalchemy.engine.Engine - INFO - [cached since 125.8s ago] (37996964,)
2025-08-28 01:53:59,452 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:53:59,452 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 10, 0)
2025-08-28 01:53:59,567 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:53:59,568 - aiogram.event - INFO - Update id=954948545 is handled. Duration 127 ms by bot id=8413666974
2025-08-28 01:54:07,396 - __main__ - INFO - FSM State Change: None
2025-08-28 01:54:07,404 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:54:07,407 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:54:07,408 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('0203',)
2025-08-28 01:54:08,394 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:54:08,394 - aiogram.event - INFO - Update id=954948546 is handled. Duration 1001 ms by bot id=8413666974
2025-08-28 01:54:18,433 - __main__ - INFO - FSM State Change: None
2025-08-28 01:54:18,435 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:54:18,436 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:54:18,436 - sqlalchemy.engine.Engine - INFO - [cached since 144.8s ago] (37996964,)
2025-08-28 01:54:18,438 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:54:18,439 - sqlalchemy.engine.Engine - INFO - [cached since 18.99s ago] (1, 10, 0)
2025-08-28 01:54:18,447 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-28 01:54:18,448 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (1,)
2025-08-28 01:54:18,563 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:54:18,564 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-28 01:54:18,679 - aiogram.event - INFO - Update id=954948547 is handled. Duration 246 ms by bot id=8413666974
2025-08-28 01:56:13,174 - __main__ - INFO - FSM State Change: None
2025-08-28 01:56:13,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:56:13,200 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:56:13,200 - sqlalchemy.engine.Engine - INFO - [cached since 259.5s ago] (37996964,)
2025-08-28 01:56:13,203 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:56:13,203 - sqlalchemy.engine.Engine - INFO - [cached since 133.8s ago] (1, 10, 0)
2025-08-28 01:56:13,331 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:56:13,331 - aiogram.event - INFO - Update id=954948548 is handled. Duration 159 ms by bot id=8413666974
2025-08-28 01:56:30,895 - __main__ - INFO - FSM State Change: None
2025-08-28 01:56:30,904 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:56:30,906 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:56:30,906 - sqlalchemy.engine.Engine - INFO - [cached since 143.5s ago] ('0203',)
2025-08-28 01:56:31,109 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:56:31,110 - aiogram.event - INFO - Update id=954948549 is handled. Duration 218 ms by bot id=8413666974
2025-08-28 01:56:36,824 - __main__ - INFO - FSM State Change: None
2025-08-28 01:56:36,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:56:36,829 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:56:36,829 - sqlalchemy.engine.Engine - INFO - [cached since 283.2s ago] (37996964,)
2025-08-28 01:56:36,832 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:56:36,833 - sqlalchemy.engine.Engine - INFO - [cached since 157.4s ago] (1, 10, 0)
2025-08-28 01:56:36,836 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-28 01:56:36,836 - sqlalchemy.engine.Engine - INFO - [cached since 138.4s ago] (1,)
2025-08-28 01:56:36,937 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:56:36,938 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-28 01:56:37,050 - aiogram.event - INFO - Update id=954948550 is handled. Duration 228 ms by bot id=8413666974
2025-08-28 01:56:41,060 - __main__ - INFO - FSM State Change: None
2025-08-28 01:56:41,063 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:56:41,063 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:56:41,063 - sqlalchemy.engine.Engine - INFO - [cached since 153.7s ago] ('0203',)
2025-08-28 01:56:41,193 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:56:41,194 - aiogram.event - INFO - Update id=954948551 is handled. Duration 135 ms by bot id=8413666974
2025-08-28 01:57:40,536 - __main__ - INFO - FSM State Change: None
2025-08-28 01:57:40,545 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:57:40,546 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:57:40,547 - sqlalchemy.engine.Engine - INFO - [cached since 213.2s ago] ('0203',)
2025-08-28 01:57:40,551 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:57:40,553 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:57:40,553 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 01:57:40,553 - sqlalchemy.engine.Engine - INFO - [cached since 230.8s ago] (3,)
2025-08-28 01:57:40,711 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:57:40,712 - aiogram.event - INFO - Update id=954948552 is handled. Duration 179 ms by bot id=8413666974
2025-08-28 01:57:44,559 - __main__ - INFO - FSM State Change: None
2025-08-28 01:57:44,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:57:44,563 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:57:44,563 - sqlalchemy.engine.Engine - INFO - [cached since 350.9s ago] (37996964,)
2025-08-28 01:57:44,564 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:57:44,564 - sqlalchemy.engine.Engine - INFO - [cached since 225.1s ago] (1, 10, 0)
2025-08-28 01:57:44,690 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:57:44,690 - aiogram.event - INFO - Update id=954948553 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 01:57:53,239 - __main__ - INFO - FSM State Change: None
2025-08-28 01:57:53,246 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:57:53,248 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:57:53,248 - sqlalchemy.engine.Engine - INFO - [cached since 225.9s ago] ('0203',)
2025-08-28 01:57:53,369 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:57:53,370 - aiogram.event - INFO - Update id=954948554 is handled. Duration 133 ms by bot id=8413666974
2025-08-28 01:57:55,206 - __main__ - INFO - FSM State Change: None
2025-08-28 01:57:55,208 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:57:55,208 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:57:55,208 - sqlalchemy.engine.Engine - INFO - [cached since 227.8s ago] ('0203',)
2025-08-28 01:57:56,030 - root - INFO - Объект bouquets/0203/1ebcb8e01b954e78b33fb256ae65355c.jpg успешно удален из хранилища
2025-08-28 01:57:56,190 - root - INFO - Объект bouquets/0203/5b22ec8d67344162a8037f08883afab4.jpg успешно удален из хранилища
2025-08-28 01:57:56,351 - root - INFO - Объект bouquets/0203/a6950aa2806342f897490d3fbb39dc99.jpg успешно удален из хранилища
2025-08-28 01:57:56,513 - root - INFO - Объект bouquets/0203/7c5959458d9c4e4ea31c228e3cfd198e.jpg успешно удален из хранилища
2025-08-28 01:57:56,676 - root - INFO - Объект bouquets/0203/e193b4466c9a4af4bbd792d894bca79e.jpg успешно удален из хранилища
2025-08-28 01:57:56,840 - root - INFO - Объект bouquets/0203/fdee6fa7741a4e058c6c53d7b343f5bf.jpg успешно удален из хранилища
2025-08-28 01:57:56,840 - root - INFO - Удалено 6 файлов букета 0203
2025-08-28 01:57:56,840 - root - INFO - Файлы букета 0203 успешно удалены с сервера
2025-08-28 01:57:56,841 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 01:57:56,842 - sqlalchemy.engine.Engine - INFO - [cached since 229.5s ago] ('0203',)
2025-08-28 01:57:56,848 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 01:57:56,849 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (3,)
2025-08-28 01:57:56,853 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 01:57:56,983 - aiogram.event - INFO - Update id=954948555 is handled. Duration 1778 ms by bot id=8413666974
2025-08-28 01:58:00,236 - __main__ - INFO - FSM State Change: None
2025-08-28 01:58:00,251 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 01:58:00,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 01:58:00,256 - sqlalchemy.engine.Engine - INFO - [cached since 366.6s ago] (37996964,)
2025-08-28 01:58:00,263 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 01:58:00,263 - sqlalchemy.engine.Engine - INFO - [cached since 240.8s ago] (1, 10, 0)
2025-08-28 01:58:00,378 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 01:58:00,379 - aiogram.event - INFO - Update id=954948556 is handled. Duration 143 ms by bot id=8413666974
2025-08-28 02:01:22,193 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-28 02:01:22,195 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 02:01:33,914 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 02:04:56,548 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 02:04:56,552 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 02:04:56,552 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 02:04:56,811 - __main__ - INFO - Работа бота завершена
2025-08-28 02:04:59,580 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 02:04:59,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:04:59,590 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 02:04:59,590 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 02:04:59,591 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 02:04:59,591 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 02:04:59,591 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 02:04:59,591 - __main__ - INFO - База данных инициализирована
2025-08-28 02:04:59,609 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 02:04:59,609 - __main__ - INFO - Запуск polling...
2025-08-28 02:04:59,609 - aiogram.dispatcher - INFO - Start polling
2025-08-28 02:05:00,314 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 02:05:08,527 - __main__ - INFO - FSM State Change: None
2025-08-28 02:05:08,534 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:05:08,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:05:08,539 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (37996964,)
2025-08-28 02:05:09,347 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:05:09,349 - aiogram.event - INFO - Update id=954948557 is handled. Duration 828 ms by bot id=8413666974
2025-08-28 02:05:11,917 - __main__ - INFO - FSM State Change: None
2025-08-28 02:05:11,919 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:05:11,919 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:05:11,919 - sqlalchemy.engine.Engine - INFO - [cached since 3.38s ago] (37996964,)
2025-08-28 02:05:11,922 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:05:11,923 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] (1, 10, 0)
2025-08-28 02:05:12,143 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:05:12,144 - aiogram.event - INFO - Update id=954948558 is handled. Duration 228 ms by bot id=8413666974
2025-08-28 02:05:21,259 - __main__ - INFO - FSM State Change: None
2025-08-28 02:05:21,263 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:05:21,265 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 02:05:21,265 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ('0201',)
2025-08-28 02:05:21,457 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:05:21,458 - aiogram.event - INFO - Update id=954948559 is handled. Duration 199 ms by bot id=8413666974
2025-08-28 02:05:28,352 - __main__ - INFO - FSM State Change: None
2025-08-28 02:05:28,355 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:05:28,356 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:05:28,356 - sqlalchemy.engine.Engine - INFO - [cached since 19.82s ago] (37996964,)
2025-08-28 02:05:28,359 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:05:28,359 - sqlalchemy.engine.Engine - INFO - [cached since 16.44s ago] (1, 10, 0)
2025-08-28 02:05:28,365 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-28 02:05:28,366 - sqlalchemy.engine.Engine - INFO - [generated in 0.00163s] (1,)
2025-08-28 02:05:28,473 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:05:28,474 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-28 02:05:28,574 - aiogram.event - INFO - Update id=954948560 is handled. Duration 224 ms by bot id=8413666974
2025-08-28 02:05:34,446 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 02:05:34,449 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 02:05:34,449 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 02:05:34,704 - __main__ - INFO - Работа бота завершена
2025-08-28 02:05:41,699 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 02:05:41,700 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:05:41,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 02:05:41,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 02:05:41,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 02:05:41,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 02:05:41,701 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 02:05:41,701 - __main__ - INFO - База данных инициализирована
2025-08-28 02:05:41,718 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 02:05:41,718 - __main__ - INFO - Запуск polling...
2025-08-28 02:05:41,718 - aiogram.dispatcher - INFO - Start polling
2025-08-28 02:05:42,370 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 02:06:13,647 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:13,652 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:13,658 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:13,658 - sqlalchemy.engine.Engine - INFO - [generated in 0.00026s] (37996964,)
2025-08-28 02:06:14,336 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:14,338 - aiogram.event - INFO - Update id=954948561 is handled. Duration 697 ms by bot id=8413666974
2025-08-28 02:06:15,933 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:15,935 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:15,935 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:15,935 - sqlalchemy.engine.Engine - INFO - [cached since 2.277s ago] (37996964,)
2025-08-28 02:06:15,938 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:06:15,938 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, 10, 0)
2025-08-28 02:06:16,163 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:16,163 - aiogram.event - INFO - Update id=954948562 is handled. Duration 231 ms by bot id=8413666974
2025-08-28 02:06:18,017 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:18,019 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:18,021 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 02:06:18,022 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('0202',)
2025-08-28 02:06:18,147 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:18,148 - aiogram.event - INFO - Update id=954948563 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 02:06:20,475 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:20,476 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:20,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:20,477 - sqlalchemy.engine.Engine - INFO - [cached since 6.819s ago] (37996964,)
2025-08-28 02:06:20,479 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:06:20,479 - sqlalchemy.engine.Engine - INFO - [cached since 4.541s ago] (1, 10, 0)
2025-08-28 02:06:20,486 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-28 02:06:20,486 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1,)
2025-08-28 02:06:20,591 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:20,592 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-28 02:06:20,699 - aiogram.event - INFO - Update id=954948564 is handled. Duration 224 ms by bot id=8413666974
2025-08-28 02:06:26,114 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:26,134 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:26,135 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:26,136 - sqlalchemy.engine.Engine - INFO - [cached since 12.48s ago] (8413666974,)
2025-08-28 02:06:26,270 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:26,371 - aiogram.event - INFO - Update id=954948565 is handled. Duration 260 ms by bot id=8413666974
2025-08-28 02:06:29,535 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:29,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:29,538 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:29,538 - sqlalchemy.engine.Engine - INFO - [cached since 15.88s ago] (37996964,)
2025-08-28 02:06:29,541 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:06:29,541 - sqlalchemy.engine.Engine - INFO - [cached since 13.6s ago] (1, 10, 0)
2025-08-28 02:06:29,660 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:29,661 - aiogram.event - INFO - Update id=954948566 is handled. Duration 127 ms by bot id=8413666974
2025-08-28 02:06:31,106 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:31,108 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:31,109 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 02:06:31,109 - sqlalchemy.engine.Engine - INFO - [cached since 13.09s ago] ('0201',)
2025-08-28 02:06:31,236 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:31,237 - aiogram.event - INFO - Update id=954948567 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 02:06:32,926 - __main__ - INFO - FSM State Change: None
2025-08-28 02:06:32,929 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:06:32,929 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:06:32,930 - sqlalchemy.engine.Engine - INFO - [cached since 19.27s ago] (37996964,)
2025-08-28 02:06:32,932 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 02:06:32,933 - sqlalchemy.engine.Engine - INFO - [cached since 17s ago] (1, 10, 0)
2025-08-28 02:06:32,935 - sqlalchemy.engine.Engine - INFO - SELECT count(bouquets.id) AS count_1 
FROM bouquets 
WHERE bouquets.user_id = ?
2025-08-28 02:06:32,936 - sqlalchemy.engine.Engine - INFO - [cached since 12.45s ago] (1,)
2025-08-28 02:06:33,033 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:06:33,034 - root - ERROR - Ошибка в handle_bouquet_pagination: Telegram server says - Bad Request: there is no text in the message to edit
2025-08-28 02:06:33,141 - aiogram.event - INFO - Update id=954948568 is handled. Duration 216 ms by bot id=8413666974
2025-08-28 02:37:09,742 - __main__ - INFO - FSM State Change: None
2025-08-28 02:37:09,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:37:09,775 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 02:37:09,776 - sqlalchemy.engine.Engine - INFO - [cached since 1856s ago] (37996964,)
2025-08-28 02:37:09,786 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 02:37:09,786 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1, 0)
2025-08-28 02:37:10,452 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:37:10,453 - aiogram.event - INFO - Update id=954948569 is handled. Duration 741 ms by bot id=8413666974
2025-08-28 02:37:22,986 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 02:37:23,111 - aiogram.event - INFO - Update id=954948570 is handled. Duration 125 ms by bot id=8413666974
2025-08-28 02:37:25,846 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 02:37:25,849 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 02:37:25,962 - root - INFO - Состояние установлено: waiting_media
2025-08-28 02:37:25,963 - aiogram.event - INFO - Update id=954948571 is handled. Duration 117 ms by bot id=8413666974
2025-08-28 02:37:47,700 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 02:37:47,701 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 02:37:47,704 - aiogram.event - INFO - Update id=954948572 is handled. Duration 36 ms by bot id=8413666974
2025-08-28 02:37:47,704 - aiogram.event - INFO - Update id=954948573 is handled. Duration 35 ms by bot id=8413666974
2025-08-28 02:37:55,242 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 02:37:55,244 - aiogram.event - INFO - Update id=954948574 is handled. Duration 2 ms by bot id=8413666974
2025-08-28 02:39:16,545 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 02:39:16,552 - aiogram.event - INFO - Update id=954948575 is not handled. Duration 44 ms by bot id=8413666974
2025-08-28 02:40:37,522 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 02:40:37,658 - aiogram.event - INFO - Update id=954948576 is handled. Duration 153 ms by bot id=8413666974
2025-08-28 02:40:45,353 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 02:40:45,480 - aiogram.event - INFO - Update id=954948577 is handled. Duration 127 ms by bot id=8413666974
2025-08-28 02:40:52,559 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 02:40:52,670 - aiogram.event - INFO - Update id=954948578 is handled. Duration 112 ms by bot id=8413666974
2025-08-28 02:40:56,957 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 02:40:57,078 - aiogram.event - INFO - Update id=954948579 is handled. Duration 121 ms by bot id=8413666974
2025-08-28 02:41:00,631 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 02:41:00,632 - root - INFO - Начинаем загрузку медиа для букета 0203
2025-08-28 02:41:00,633 - root - INFO - Начинаем загрузку 2 медиафайлов для букета 0203
2025-08-28 02:41:00,633 - root - INFO - Обрабатываем медиа 1/2: AgACAgIAAxkBAAIBQWivlstFET103AqLQAvUWrvXykzaAAIc_TEbCReBSR5qBT8kY_btAQADAgADeQADNgQ
2025-08-28 02:41:00,633 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBQWivlstFET103AqLQAvUWrvXykzaAAIc_TEbCReBSR5qBT8kY_btAQADAgADeQADNgQ для букета 0203
2025-08-28 02:41:00,760 - root - INFO - Файл получен из Telegram: photos/file_10.jpg
2025-08-28 02:41:00,760 - root - INFO - Генерируем имя объекта: bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg
2025-08-28 02:41:01,086 - root - INFO - Размер файла: 184131 байт
2025-08-28 02:41:01,395 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 02:41:01,395 - root - INFO - Загрузка файла bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg, размер: 184131 байт
2025-08-28 02:41:02,617 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg
2025-08-28 02:41:02,617 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg
2025-08-28 02:41:02,617 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg
2025-08-28 02:41:02,617 - root - INFO - Обрабатываем медиа 2/2: AgACAgIAAxkBAAIBQmivlsvJLAqTpo5ebUcth4QpMJBOAAId_TEbCReBSfXq-sZr2Ks7AQADAgADeQADNgQ
2025-08-28 02:41:02,617 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBQmivlsvJLAqTpo5ebUcth4QpMJBOAAId_TEbCReBSfXq-sZr2Ks7AQADAgADeQADNgQ для букета 0203
2025-08-28 02:41:02,727 - root - INFO - Файл получен из Telegram: photos/file_11.jpg
2025-08-28 02:41:02,727 - root - INFO - Генерируем имя объекта: bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg
2025-08-28 02:41:03,057 - root - INFO - Размер файла: 190702 байт
2025-08-28 02:41:03,057 - root - INFO - Загрузка файла bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg, размер: 190702 байт
2025-08-28 02:41:03,468 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg
2025-08-28 02:41:03,469 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg
2025-08-28 02:41:03,469 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg
2025-08-28 02:41:03,469 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg']
2025-08-28 02:41:03,473 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:41:03,479 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 02:41:03,479 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('0203', 1, 'букет альстромерий', 'букет альстромерий №0203', '["https://foto-cat.storage.yandexcloud.net/bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg"]', None, 'орриоиорио', 'null', 9999900, 'RUB')
2025-08-28 02:41:03,489 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 02:41:03,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 02:41:03,495 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 02:41:03,495 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (3,)
2025-08-28 02:41:03,619 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 02:41:03,620 - aiogram.event - INFO - Update id=954948580 is handled. Duration 2989 ms by bot id=8413666974
2025-08-28 02:57:01,610 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 02:57:01,616 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 03:14:33,329 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 03:14:33,410 - aiogram.dispatcher - WARNING - Sleep for 1.210480 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 03:32:26,282 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 03:32:26,367 - aiogram.dispatcher - WARNING - Sleep for 1.535197 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 03:48:55,264 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 03:48:55,322 - aiogram.dispatcher - WARNING - Sleep for 1.994940 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-28 04:06:44,207 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 04:06:44,291 - aiogram.dispatcher - WARNING - Sleep for 2.584955 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-28 04:23:03,182 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 04:23:03,265 - aiogram.dispatcher - WARNING - Sleep for 3.542384 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-28 04:40:59,161 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 04:40:59,162 - aiogram.dispatcher - WARNING - Sleep for 4.530992 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-28 04:57:14,149 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 04:57:14,229 - aiogram.dispatcher - WARNING - Sleep for 5.032253 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-28 05:04:13,996 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 05:04:13,997 - aiogram.dispatcher - WARNING - Sleep for 4.893268 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-28 05:21:50,067 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 05:21:50,150 - aiogram.dispatcher - WARNING - Sleep for 4.984253 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-28 05:39:36,027 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 05:39:36,112 - aiogram.dispatcher - WARNING - Sleep for 4.917195 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-28 05:55:48,997 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 05:55:49,079 - aiogram.dispatcher - WARNING - Sleep for 4.989416 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-28 06:11:15,977 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 06:11:16,064 - aiogram.dispatcher - WARNING - Sleep for 4.971456 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-28 06:29:12,023 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-28 06:29:12,024 - aiogram.dispatcher - WARNING - Sleep for 5.097940 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-28 06:42:47,711 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-28 06:42:47,795 - aiogram.dispatcher - WARNING - Sleep for 4.975756 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-08-28 06:43:53,478 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 06:43:53,480 - aiogram.dispatcher - WARNING - Sleep for 5.112641 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-08-28 06:59:03,917 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 06:59:04,004 - aiogram.dispatcher - WARNING - Sleep for 4.939702 seconds and try again... (tryings = 16, bot id = 8413666974)
2025-08-28 07:15:29,956 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 07:15:30,022 - aiogram.dispatcher - WARNING - Sleep for 5.004857 seconds and try again... (tryings = 17, bot id = 8413666974)
2025-08-28 07:15:45,637 - aiogram.dispatcher - INFO - Connection established (tryings = 18, bot id = 8413666974)
2025-08-28 07:33:17,981 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 07:33:17,999 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 07:48:36,899 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 07:48:36,899 - aiogram.dispatcher - WARNING - Sleep for 1.358603 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 08:04:38,888 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 08:04:38,970 - aiogram.dispatcher - WARNING - Sleep for 1.749609 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 08:14:12,639 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 08:14:12,719 - aiogram.dispatcher - WARNING - Sleep for 2.264359 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-28 08:14:25,751 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 8413666974)
2025-08-28 08:25:38,234 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 08:25:38,315 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 08:43:13,874 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 08:43:13,875 - aiogram.dispatcher - WARNING - Sleep for 1.334797 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 09:00:59,846 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 09:00:59,925 - aiogram.dispatcher - WARNING - Sleep for 1.672269 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 09:16:04,832 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 09:16:04,909 - aiogram.dispatcher - WARNING - Sleep for 2.177581 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-28 09:17:15,672 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 09:17:15,751 - aiogram.dispatcher - WARNING - Sleep for 2.971850 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-28 09:17:29,386 - aiogram.dispatcher - INFO - Connection established (tryings = 5, bot id = 8413666974)
2025-08-28 09:28:54,319 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 09:28:54,339 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 09:28:54,340 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 09:28:54,613 - __main__ - INFO - Работа бота завершена
2025-08-28 14:46:49,748 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 14:46:49,756 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 14:46:49,756 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 14:46:49,756 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 14:46:49,757 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 14:46:49,757 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 14:46:49,757 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 14:46:49,758 - __main__ - INFO - База данных инициализирована
2025-08-28 14:46:49,775 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 14:46:49,775 - __main__ - INFO - Запуск polling...
2025-08-28 14:46:49,775 - aiogram.dispatcher - INFO - Start polling
2025-08-28 14:46:50,689 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 14:46:50,807 - __main__ - INFO - FSM State Change: None
2025-08-28 14:46:50,808 - __main__ - INFO - FSM State Change: None
2025-08-28 14:46:50,811 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 14:46:50,818 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 14:46:50,819 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (37996964,)
2025-08-28 14:46:50,822 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 14:46:50,822 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (1, 10, 0)
2025-08-28 14:46:50,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 14:46:50,826 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 14:46:50,826 - sqlalchemy.engine.Engine - INFO - [cached since 0.007975s ago] (37996964,)
2025-08-28 14:46:51,623 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 14:46:51,623 - aiogram.event - INFO - Update id=954948582 is handled. Duration 829 ms by bot id=8413666974
2025-08-28 14:46:51,715 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 14:46:51,716 - aiogram.event - INFO - Update id=954948581 is handled. Duration 922 ms by bot id=8413666974
2025-08-28 15:00:05,700 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 15:00:05,702 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 15:00:18,022 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 15:01:20,969 - __main__ - INFO - FSM State Change: None
2025-08-28 15:01:20,987 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:01:20,988 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:01:20,988 - sqlalchemy.engine.Engine - INFO - [cached since 84.66s ago] (8413666974,)
2025-08-28 15:01:21,833 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:01:21,994 - aiogram.event - INFO - Update id=954948583 is handled. Duration 1033 ms by bot id=8413666974
2025-08-28 15:01:24,258 - __main__ - INFO - FSM State Change: None
2025-08-28 15:01:24,260 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:01:24,261 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:01:24,261 - sqlalchemy.engine.Engine - INFO - [cached since 87.93s ago] (37996964,)
2025-08-28 15:01:24,263 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 15:01:24,263 - sqlalchemy.engine.Engine - INFO - [cached since 87.93s ago] (1, 10, 0)
2025-08-28 15:01:24,389 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:01:24,390 - aiogram.event - INFO - Update id=954948584 is handled. Duration 132 ms by bot id=8413666974
2025-08-28 15:01:37,394 - __main__ - INFO - FSM State Change: None
2025-08-28 15:01:37,397 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:01:37,398 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:01:37,398 - sqlalchemy.engine.Engine - INFO - [cached since 101.1s ago] (37996964,)
2025-08-28 15:01:37,414 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 15:01:37,414 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1, 0)
2025-08-28 15:01:37,608 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:01:37,608 - aiogram.event - INFO - Update id=954948585 is handled. Duration 216 ms by bot id=8413666974
2025-08-28 15:01:45,708 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 15:01:45,932 - aiogram.event - INFO - Update id=954948586 is handled. Duration 224 ms by bot id=8413666974
2025-08-28 15:01:48,225 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 15:01:48,229 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 15:01:48,398 - root - INFO - Состояние установлено: waiting_media
2025-08-28 15:01:48,398 - aiogram.event - INFO - Update id=954948587 is handled. Duration 175 ms by bot id=8413666974
2025-08-28 15:02:29,604 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:02:29,606 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:02:29,609 - aiogram.event - INFO - Update id=954948588 is handled. Duration 8 ms by bot id=8413666974
2025-08-28 15:02:29,609 - aiogram.event - INFO - Update id=954948589 is handled. Duration 6 ms by bot id=8413666974
2025-08-28 15:02:35,701 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:02:35,904 - aiogram.event - INFO - Update id=954948590 is handled. Duration 204 ms by bot id=8413666974
2025-08-28 15:04:36,500 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:04:36,505 - aiogram.event - INFO - Update id=954948591 is not handled. Duration 9 ms by bot id=8413666974
2025-08-28 15:05:38,381 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:05:38,557 - aiogram.event - INFO - Update id=954948592 is handled. Duration 191 ms by bot id=8413666974
2025-08-28 15:05:42,480 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 15:05:42,738 - aiogram.event - INFO - Update id=954948593 is handled. Duration 258 ms by bot id=8413666974
2025-08-28 15:05:44,904 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 15:05:45,026 - aiogram.event - INFO - Update id=954948594 is handled. Duration 123 ms by bot id=8413666974
2025-08-28 15:05:49,186 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 15:05:49,318 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-08-28 15:05:49,443 - aiogram.event - INFO - Update id=954948595 is handled. Duration 259 ms by bot id=8413666974
2025-08-28 15:05:51,652 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 15:05:51,653 - root - INFO - Начинаем загрузку медиа для букета 0204
2025-08-28 15:05:51,653 - root - INFO - Начинаем загрузку 2 медиафайлов для букета 0204
2025-08-28 15:05:51,653 - root - INFO - Обрабатываем медиа 1/2: AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA
2025-08-28 15:05:51,653 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA для букета 0204
2025-08-28 15:05:51,768 - root - INFO - Файл получен из Telegram: photos/file_3.jpg
2025-08-28 15:05:51,768 - root - INFO - Генерируем имя объекта: bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg
2025-08-28 15:05:52,118 - root - INFO - Размер файла: 83400 байт
2025-08-28 15:05:52,358 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 15:05:52,358 - root - INFO - Загрузка файла bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg, размер: 83400 байт
2025-08-28 15:05:53,847 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg
2025-08-28 15:05:53,848 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg
2025-08-28 15:05:53,848 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg
2025-08-28 15:05:53,848 - root - INFO - Обрабатываем медиа 2/2: AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA
2025-08-28 15:05:53,848 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA для букета 0204
2025-08-28 15:05:53,956 - root - INFO - Файл получен из Telegram: photos/file_2.jpg
2025-08-28 15:05:53,956 - root - INFO - Генерируем имя объекта: bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg
2025-08-28 15:05:54,292 - root - INFO - Размер файла: 89982 байт
2025-08-28 15:05:54,293 - root - INFO - Загрузка файла bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg, размер: 89982 байт
2025-08-28 15:05:54,676 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg
2025-08-28 15:05:54,677 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg
2025-08-28 15:05:54,677 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg
2025-08-28 15:05:54,677 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg']
2025-08-28 15:05:54,679 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:05:54,686 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 15:05:54,687 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] ('0204', 1, 'тест тестов', 'тест тестов №0204', '["https://foto-cat.storage.yandexcloud.net/bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg"]', None, 'выаываывав', 'null', 200000, 'RUB')
2025-08-28 15:05:54,697 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 15:05:54,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:05:54,703 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 15:05:54,703 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (4,)
2025-08-28 15:05:54,890 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:05:54,890 - aiogram.event - INFO - Update id=954948596 is handled. Duration 3239 ms by bot id=8413666974
2025-08-28 15:05:58,220 - __main__ - INFO - FSM State Change: None
2025-08-28 15:05:58,222 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:05:58,222 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:05:58,222 - sqlalchemy.engine.Engine - INFO - [cached since 361.9s ago] (37996964,)
2025-08-28 15:05:58,224 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 15:05:58,224 - sqlalchemy.engine.Engine - INFO - [cached since 361.9s ago] (1, 10, 0)
2025-08-28 15:05:58,375 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:05:58,376 - aiogram.event - INFO - Update id=954948597 is handled. Duration 157 ms by bot id=8413666974
2025-08-28 15:06:04,901 - __main__ - INFO - FSM State Change: None
2025-08-28 15:06:04,912 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:06:04,915 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 15:06:04,915 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('0204',)
2025-08-28 15:06:05,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:06:05,854 - aiogram.event - INFO - Update id=954948598 is handled. Duration 954 ms by bot id=8413666974
2025-08-28 15:13:01,285 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 15:13:01,289 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 15:13:01,290 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 15:13:01,559 - __main__ - INFO - Работа бота завершена
2025-08-28 15:50:25,216 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 15:50:25,220 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:50:25,220 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 15:50:25,220 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 15:50:25,221 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 15:50:25,221 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 15:50:25,221 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 15:50:25,221 - __main__ - INFO - База данных инициализирована
2025-08-28 15:50:25,238 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 15:50:25,238 - __main__ - INFO - Запуск polling...
2025-08-28 15:50:25,238 - aiogram.dispatcher - INFO - Start polling
2025-08-28 15:50:26,910 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 15:50:37,017 - __main__ - INFO - FSM State Change: None
2025-08-28 15:50:37,028 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:50:37,043 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:50:37,043 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (37996964,)
2025-08-28 15:50:38,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:50:38,055 - aiogram.event - INFO - Update id=954948599 is handled. Duration 1193 ms by bot id=8413666974
2025-08-28 15:51:48,086 - __main__ - INFO - FSM State Change: None
2025-08-28 15:51:48,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:51:48,097 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:51:48,097 - sqlalchemy.engine.Engine - INFO - [cached since 71.06s ago] (37996964,)
2025-08-28 15:51:48,103 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 15:51:48,104 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1, 0)
2025-08-28 15:51:48,229 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:51:48,229 - aiogram.event - INFO - Update id=954948600 is handled. Duration 163 ms by bot id=8413666974
2025-08-28 15:51:49,733 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 15:51:49,895 - aiogram.event - INFO - Update id=954948601 is handled. Duration 163 ms by bot id=8413666974
2025-08-28 15:51:52,333 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 15:51:52,336 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 15:51:52,573 - root - INFO - Состояние установлено: waiting_media
2025-08-28 15:51:52,574 - aiogram.event - INFO - Update id=954948602 is handled. Duration 244 ms by bot id=8413666974
2025-08-28 15:51:55,185 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:51:55,315 - aiogram.event - INFO - Update id=954948603 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 15:52:46,815 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:52:46,820 - aiogram.event - INFO - Update id=954948604 is not handled. Duration 7 ms by bot id=8413666974
2025-08-28 15:53:10,106 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:53:10,265 - aiogram.event - INFO - Update id=954948605 is handled. Duration 159 ms by bot id=8413666974
2025-08-28 15:53:31,191 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:53:31,714 - aiogram.event - INFO - Update id=954948606 is handled. Duration 525 ms by bot id=8413666974
2025-08-28 15:53:35,187 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:53:35,451 - aiogram.event - INFO - Update id=954948607 is handled. Duration 265 ms by bot id=8413666974
2025-08-28 15:54:11,626 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:54:11,632 - aiogram.event - INFO - Update id=954948608 is not handled. Duration 11 ms by bot id=8413666974
2025-08-28 15:57:29,009 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 15:57:29,202 - aiogram.event - INFO - Update id=954948609 is handled. Duration 195 ms by bot id=8413666974
2025-08-28 15:57:33,159 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 15:57:33,387 - aiogram.event - INFO - Update id=954948610 is handled. Duration 227 ms by bot id=8413666974
2025-08-28 15:57:37,185 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 15:57:37,556 - aiogram.event - INFO - Update id=954948611 is handled. Duration 372 ms by bot id=8413666974
2025-08-28 15:57:41,301 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 15:57:41,554 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-08-28 15:57:41,790 - aiogram.event - INFO - Update id=954948612 is handled. Duration 489 ms by bot id=8413666974
2025-08-28 15:57:45,708 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 15:57:45,709 - root - INFO - Начинаем загрузку медиа для букета 0205
2025-08-28 15:57:45,709 - root - INFO - Начинаем загрузку 1 медиафайлов для букета 0205
2025-08-28 15:57:45,710 - root - INFO - Обрабатываем медиа 1/1: AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA
2025-08-28 15:57:45,710 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMSaK426ZZN0QsWYfSy90SiTtzqRfMAAj32MRsJF3lJ4NV_zzZsNIwBAAMCAAN5AAM2BA для букета 0205
2025-08-28 15:57:45,812 - root - INFO - Файл получен из Telegram: photos/file_4.jpg
2025-08-28 15:57:45,813 - root - INFO - Генерируем имя объекта: bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg
2025-08-28 15:57:46,259 - root - INFO - Размер файла: 138763 байт
2025-08-28 15:57:46,500 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 15:57:46,500 - root - INFO - Загрузка файла bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg, размер: 138763 байт
2025-08-28 15:57:47,973 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg
2025-08-28 15:57:47,973 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg
2025-08-28 15:57:47,974 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg
2025-08-28 15:57:47,974 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg']
2025-08-28 15:57:47,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:57:47,982 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 15:57:47,982 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ('0205', 1, 'выавыавы', 'выавыавы №0205', '["https://foto-cat.storage.yandexcloud.net/bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg"]', None, 'ываыава', 'null', 400000, 'RUB')
2025-08-28 15:57:47,992 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 15:57:47,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:57:47,997 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 15:57:47,997 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (5,)
2025-08-28 15:57:48,136 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:57:48,137 - aiogram.event - INFO - Update id=954948613 is handled. Duration 2430 ms by bot id=8413666974
2025-08-28 15:57:50,308 - __main__ - INFO - FSM State Change: None
2025-08-28 15:57:50,321 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:57:50,322 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 15:57:50,322 - sqlalchemy.engine.Engine - INFO - [cached since 433.3s ago] (37996964,)
2025-08-28 15:57:50,323 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 15:57:50,323 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] (1, 10, 0)
2025-08-28 15:57:50,465 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:57:50,466 - aiogram.event - INFO - Update id=954948614 is handled. Duration 159 ms by bot id=8413666974
2025-08-28 15:57:55,371 - __main__ - INFO - FSM State Change: None
2025-08-28 15:57:55,375 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:57:55,377 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 15:57:55,377 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('0205',)
2025-08-28 15:57:56,354 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:57:56,355 - aiogram.event - INFO - Update id=954948615 is handled. Duration 984 ms by bot id=8413666974
2025-08-28 15:59:10,529 - __main__ - INFO - FSM State Change: None
2025-08-28 15:59:10,541 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 15:59:10,543 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 15:59:10,543 - sqlalchemy.engine.Engine - INFO - [cached since 75.17s ago] ('0205',)
2025-08-28 15:59:10,811 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 15:59:10,813 - aiogram.event - INFO - Update id=954948616 is handled. Duration 286 ms by bot id=8413666974
2025-08-28 16:02:45,343 - __main__ - INFO - FSM State Change: None
2025-08-28 16:02:45,493 - aiogram.event - INFO - Update id=954948617 is handled. Duration 157 ms by bot id=8413666974
2025-08-28 16:25:42,326 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 16:25:42,329 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 16:43:35,942 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 16:43:36,023 - aiogram.dispatcher - WARNING - Sleep for 1.247488 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 16:50:19,252 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 16:50:19,326 - aiogram.dispatcher - WARNING - Sleep for 1.672396 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 16:50:50,202 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-08-28 16:54:26,222 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 16:54:26,306 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 17:09:42,906 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 17:09:42,980 - aiogram.dispatcher - WARNING - Sleep for 1.201181 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 17:23:26,244 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 17:23:26,245 - aiogram.dispatcher - WARNING - Sleep for 1.626892 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 17:30:07,066 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 17:30:07,069 - aiogram.dispatcher - WARNING - Sleep for 2.194061 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-28 17:30:20,117 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 8413666974)
2025-08-28 17:48:07,892 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 17:48:07,974 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 17:49:09,795 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 17:49:09,796 - aiogram.dispatcher - WARNING - Sleep for 1.344968 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 17:49:22,396 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-28 17:53:51,523 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 17:53:51,539 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 17:53:51,539 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 17:53:51,810 - __main__ - INFO - Работа бота завершена
2025-08-28 17:53:55,080 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 17:53:55,084 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 17:53:55,084 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 17:53:55,084 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 17:53:55,084 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 17:53:55,084 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 17:53:55,085 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 17:53:55,085 - __main__ - INFO - База данных инициализирована
2025-08-28 17:53:55,102 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 17:53:55,102 - __main__ - INFO - Запуск polling...
2025-08-28 17:53:55,102 - aiogram.dispatcher - INFO - Start polling
2025-08-28 17:53:55,896 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 17:54:17,871 - __main__ - INFO - FSM State Change: None
2025-08-28 17:54:17,880 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 17:54:17,894 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 17:54:17,894 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (37996964,)
2025-08-28 17:54:18,712 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 17:54:18,713 - aiogram.event - INFO - Update id=954948618 is handled. Duration 887 ms by bot id=8413666974
2025-08-28 17:54:56,351 - __main__ - INFO - FSM State Change: None
2025-08-28 17:54:56,361 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 17:54:56,363 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 17:54:56,363 - sqlalchemy.engine.Engine - INFO - [cached since 38.47s ago] (37996964,)
2025-08-28 17:54:56,374 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 17:54:56,374 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1, 0)
2025-08-28 17:54:56,504 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 17:54:56,504 - aiogram.event - INFO - Update id=954948619 is handled. Duration 157 ms by bot id=8413666974
2025-08-28 17:55:00,864 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 17:55:01,009 - aiogram.event - INFO - Update id=954948620 is handled. Duration 147 ms by bot id=8413666974
2025-08-28 17:55:02,703 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 17:55:02,705 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 17:55:02,854 - root - INFO - Состояние установлено: waiting_media
2025-08-28 17:55:02,855 - aiogram.event - INFO - Update id=954948621 is handled. Duration 153 ms by bot id=8413666974
2025-08-28 17:55:32,790 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:55:32,791 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:55:32,793 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:55:32,793 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:55:32,794 - aiogram.event - INFO - Update id=954948622 is handled. Duration 8 ms by bot id=8413666974
2025-08-28 17:55:32,794 - aiogram.event - INFO - Update id=954948623 is handled. Duration 7 ms by bot id=8413666974
2025-08-28 17:55:32,795 - aiogram.event - INFO - Update id=954948624 is handled. Duration 8 ms by bot id=8413666974
2025-08-28 17:55:32,795 - aiogram.event - INFO - Update id=954948625 is handled. Duration 8 ms by bot id=8413666974
2025-08-28 17:55:38,281 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:55:38,570 - aiogram.event - INFO - Update id=954948626 is handled. Duration 290 ms by bot id=8413666974
2025-08-28 17:56:31,114 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 17:56:31,120 - aiogram.event - INFO - Update id=954948627 is not handled. Duration 7 ms by bot id=8413666974
2025-08-28 18:18:53,008 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 18:18:53,011 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 18:19:04,912 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 18:28:23,916 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 18:28:24,774 - aiogram.event - INFO - Update id=954948628 is handled. Duration 872 ms by bot id=8413666974
2025-08-28 18:28:28,081 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 18:28:28,205 - aiogram.event - INFO - Update id=954948629 is handled. Duration 124 ms by bot id=8413666974
2025-08-28 18:28:30,276 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 18:28:30,430 - aiogram.event - INFO - Update id=954948630 is handled. Duration 156 ms by bot id=8413666974
2025-08-28 18:28:34,203 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 18:28:34,354 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-08-28 18:28:34,477 - aiogram.event - INFO - Update id=954948631 is handled. Duration 274 ms by bot id=8413666974
2025-08-28 18:28:36,303 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 18:28:36,304 - root - INFO - Начинаем загрузку медиа для букета 0206
2025-08-28 18:28:36,304 - root - INFO - Начинаем загрузку 4 медиафайлов для букета 0206
2025-08-28 18:28:36,305 - root - INFO - Обрабатываем медиа 1/4: AgACAgIAAxkBAAIBjGiwbeT5y-h2J_1WmxfX7b-N9WdjAALA-zEb8p-ASfRENR7HS7zTAQADAgADeQADNgQ
2025-08-28 18:28:36,306 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBjGiwbeT5y-h2J_1WmxfX7b-N9WdjAALA-zEb8p-ASfRENR7HS7zTAQADAgADeQADNgQ для букета 0206
2025-08-28 18:28:36,423 - root - INFO - Файл получен из Telegram: photos/file_12.jpg
2025-08-28 18:28:36,424 - root - INFO - Генерируем имя объекта: bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg
2025-08-28 18:28:36,786 - root - INFO - Размер файла: 131108 байт
2025-08-28 18:28:37,116 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 18:28:37,116 - root - INFO - Загрузка файла bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg, размер: 131108 байт
2025-08-28 18:28:38,513 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg
2025-08-28 18:28:38,514 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg
2025-08-28 18:28:38,514 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg
2025-08-28 18:28:38,514 - root - INFO - Обрабатываем медиа 2/4: AgACAgIAAxkBAAIBjWiwbeQKvjtxVAvDcBP7PqTQGmPYAALB-zEb8p-ASRv9JIS7cNVWAQADAgADeQADNgQ
2025-08-28 18:28:38,514 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBjWiwbeQKvjtxVAvDcBP7PqTQGmPYAALB-zEb8p-ASRv9JIS7cNVWAQADAgADeQADNgQ для букета 0206
2025-08-28 18:28:38,622 - root - INFO - Файл получен из Telegram: photos/file_13.jpg
2025-08-28 18:28:38,623 - root - INFO - Генерируем имя объекта: bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg
2025-08-28 18:28:38,882 - root - INFO - Размер файла: 99681 байт
2025-08-28 18:28:38,882 - root - INFO - Загрузка файла bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg, размер: 99681 байт
2025-08-28 18:28:39,340 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg
2025-08-28 18:28:39,340 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg
2025-08-28 18:28:39,340 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg
2025-08-28 18:28:39,340 - root - INFO - Обрабатываем медиа 3/4: AgACAgIAAxkBAAIBjmiwbeTzPOYjfYnhbJqVajKBe5zkAALC-zEb8p-ASYB9vN8TIjqIAQADAgADeQADNgQ
2025-08-28 18:28:39,340 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBjmiwbeTzPOYjfYnhbJqVajKBe5zkAALC-zEb8p-ASYB9vN8TIjqIAQADAgADeQADNgQ для букета 0206
2025-08-28 18:28:39,443 - root - INFO - Файл получен из Telegram: photos/file_14.jpg
2025-08-28 18:28:39,444 - root - INFO - Генерируем имя объекта: bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg
2025-08-28 18:28:39,716 - root - INFO - Размер файла: 125301 байт
2025-08-28 18:28:39,717 - root - INFO - Загрузка файла bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg, размер: 125301 байт
2025-08-28 18:28:40,245 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg
2025-08-28 18:28:40,245 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg
2025-08-28 18:28:40,245 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg
2025-08-28 18:28:40,246 - root - INFO - Обрабатываем медиа 4/4: AgACAgIAAxkBAAIBj2iwbeSrvGgjFSYho7uObxQ9shfxAALD-zEb8p-ASfUVNwkzf4euAQADAgADeQADNgQ
2025-08-28 18:28:40,246 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBj2iwbeSrvGgjFSYho7uObxQ9shfxAALD-zEb8p-ASfUVNwkzf4euAQADAgADeQADNgQ для букета 0206
2025-08-28 18:28:40,357 - root - INFO - Файл получен из Telegram: photos/file_15.jpg
2025-08-28 18:28:40,357 - root - INFO - Генерируем имя объекта: bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg
2025-08-28 18:28:40,736 - root - INFO - Размер файла: 129199 байт
2025-08-28 18:28:40,737 - root - INFO - Загрузка файла bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg, размер: 129199 байт
2025-08-28 18:28:41,258 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg
2025-08-28 18:28:41,259 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg
2025-08-28 18:28:41,259 - root - INFO - Медиа 4 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg
2025-08-28 18:28:41,259 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg']
2025-08-28 18:28:41,261 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 18:28:41,268 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 18:28:41,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00093s] ('0206', 1, 'авпуавпав', 'авпуавпав №0206', '["https://foto-cat.storage.yandexcloud.net/bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/02 ... (82 characters truncated) ... t/bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg"]', None, 'авыпавпвав', 'null', 2000000, 'RUB')
2025-08-28 18:28:41,278 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 18:28:41,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 18:28:41,283 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 18:28:41,284 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (6,)
2025-08-28 18:28:41,491 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 18:28:41,491 - aiogram.event - INFO - Update id=954948632 is handled. Duration 5189 ms by bot id=8413666974
2025-08-28 18:28:53,797 - __main__ - INFO - FSM State Change: None
2025-08-28 18:28:53,799 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 18:28:53,799 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 18:28:53,799 - sqlalchemy.engine.Engine - INFO - [cached since 1905s ago] (37996964,)
2025-08-28 18:28:53,801 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 18:28:53,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (1, 10, 0)
2025-08-28 18:28:53,976 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 18:28:53,977 - aiogram.event - INFO - Update id=954948633 is handled. Duration 181 ms by bot id=8413666974
2025-08-28 18:29:07,670 - __main__ - INFO - FSM State Change: None
2025-08-28 18:29:07,678 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 18:29:07,682 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 18:29:07,682 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ('0206',)
2025-08-28 18:29:08,665 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 18:29:08,666 - aiogram.event - INFO - Update id=954948634 is handled. Duration 997 ms by bot id=8413666974
2025-08-28 20:37:57,560 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 20:37:57,580 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 20:37:57,581 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 20:37:57,853 - __main__ - INFO - Работа бота завершена
2025-08-28 20:38:02,733 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 20:38:02,737 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:38:02,737 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 20:38:02,737 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 20:38:02,738 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 20:38:02,738 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 20:38:02,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 20:38:02,738 - __main__ - INFO - База данных инициализирована
2025-08-28 20:38:02,755 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 20:38:02,755 - __main__ - INFO - Запуск polling...
2025-08-28 20:38:02,755 - aiogram.dispatcher - INFO - Start polling
2025-08-28 20:38:03,632 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 20:38:32,684 - __main__ - INFO - FSM State Change: None
2025-08-28 20:38:32,694 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:38:32,713 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 20:38:32,713 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (37996964,)
2025-08-28 20:38:33,429 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:38:33,429 - aiogram.event - INFO - Update id=954948635 is handled. Duration 824 ms by bot id=8413666974
2025-08-28 20:38:50,162 - __main__ - INFO - FSM State Change: None
2025-08-28 20:38:50,164 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:38:50,165 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 20:38:50,165 - sqlalchemy.engine.Engine - INFO - [cached since 17.45s ago] (37996964,)
2025-08-28 20:38:50,170 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 20:38:50,170 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, 0)
2025-08-28 20:38:50,414 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:38:50,415 - aiogram.event - INFO - Update id=954948636 is handled. Duration 254 ms by bot id=8413666974
2025-08-28 20:38:52,884 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 20:38:53,034 - aiogram.event - INFO - Update id=954948637 is handled. Duration 152 ms by bot id=8413666974
2025-08-28 20:38:55,422 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 20:38:55,424 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 20:38:55,553 - root - INFO - Состояние установлено: waiting_media
2025-08-28 20:38:55,553 - aiogram.event - INFO - Update id=954948638 is handled. Duration 131 ms by bot id=8413666974
2025-08-28 20:39:20,287 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:39:20,289 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:39:20,290 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:39:20,300 - aiogram.event - INFO - Update id=954948639 is handled. Duration 38 ms by bot id=8413666974
2025-08-28 20:39:20,300 - aiogram.event - INFO - Update id=954948640 is handled. Duration 37 ms by bot id=8413666974
2025-08-28 20:39:20,301 - aiogram.event - INFO - Update id=954948641 is handled. Duration 26 ms by bot id=8413666974
2025-08-28 20:39:24,810 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:39:25,119 - aiogram.event - INFO - Update id=954948642 is handled. Duration 309 ms by bot id=8413666974
2025-08-28 20:40:09,153 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:40:09,158 - aiogram.event - INFO - Update id=954948643 is not handled. Duration 8 ms by bot id=8413666974
2025-08-28 20:40:23,006 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 20:40:23,205 - aiogram.event - INFO - Update id=954948644 is handled. Duration 199 ms by bot id=8413666974
2025-08-28 20:40:27,663 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 20:40:27,806 - aiogram.event - INFO - Update id=954948645 is handled. Duration 143 ms by bot id=8413666974
2025-08-28 20:40:29,998 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 20:40:30,291 - aiogram.event - INFO - Update id=954948646 is handled. Duration 293 ms by bot id=8413666974
2025-08-28 20:40:33,988 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 20:40:34,113 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-08-28 20:40:34,253 - aiogram.event - INFO - Update id=954948647 is handled. Duration 266 ms by bot id=8413666974
2025-08-28 20:40:41,781 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 20:40:41,783 - root - INFO - Начинаем загрузку медиа для букета 0207
2025-08-28 20:40:41,784 - root - INFO - Начинаем загрузку 3 медиафайлов для букета 0207
2025-08-28 20:40:41,784 - root - INFO - Обрабатываем медиа 1/3: AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN5AAM2BA
2025-08-28 20:40:41,784 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMUaK426VRy7yNZcQ_GhyT6e7DAZT4AAj_2MRsJF3lJmeqshYm7r-gBAAMCAAN5AAM2BA для букета 0207
2025-08-28 20:40:41,896 - root - INFO - Файл получен из Telegram: photos/file_6.jpg
2025-08-28 20:40:41,896 - root - INFO - Генерируем имя объекта: bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg
2025-08-28 20:40:42,279 - root - INFO - Размер файла: 94029 байт
2025-08-28 20:40:42,494 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 20:40:42,494 - root - INFO - Загрузка файла bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg, размер: 94029 байт
2025-08-28 20:40:43,837 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg
2025-08-28 20:40:43,837 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg
2025-08-28 20:40:43,837 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg
2025-08-28 20:40:43,837 - root - INFO - Обрабатываем медиа 2/3: AgACAgIAAxkBAAMVaK426XkCiTYhq6miSCsZnZOoWAMAAkD2MRsJF3lJ_LmJc6SmTFABAAMCAAN5AAM2BA
2025-08-28 20:40:43,838 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAMVaK426XkCiTYhq6miSCsZnZOoWAMAAkD2MRsJF3lJ_LmJc6SmTFABAAMCAAN5AAM2BA для букета 0207
2025-08-28 20:40:43,999 - root - INFO - Файл получен из Telegram: photos/file_7.jpg
2025-08-28 20:40:44,000 - root - INFO - Генерируем имя объекта: bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg
2025-08-28 20:40:44,477 - root - INFO - Размер файла: 145008 байт
2025-08-28 20:40:44,477 - root - INFO - Загрузка файла bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg, размер: 145008 байт
2025-08-28 20:40:45,051 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg
2025-08-28 20:40:45,051 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg
2025-08-28 20:40:45,051 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg
2025-08-28 20:40:45,051 - root - INFO - Обрабатываем медиа 3/3: AgACAgIAAxkBAAIBp2iwlEgbJHRVrVxgcH-m2HW7k-ipAAI0_jEb8p-ASegQmi3IgR4TAQADAgADeQADNgQ
2025-08-28 20:40:45,051 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIBp2iwlEgbJHRVrVxgcH-m2HW7k-ipAAI0_jEb8p-ASegQmi3IgR4TAQADAgADeQADNgQ для букета 0207
2025-08-28 20:40:45,192 - root - INFO - Файл получен из Telegram: photos/file_16.jpg
2025-08-28 20:40:45,193 - root - INFO - Генерируем имя объекта: bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg
2025-08-28 20:40:45,459 - root - INFO - Размер файла: 145414 байт
2025-08-28 20:40:45,459 - root - INFO - Загрузка файла bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg, размер: 145414 байт
2025-08-28 20:40:45,890 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg
2025-08-28 20:40:45,890 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg
2025-08-28 20:40:45,890 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg
2025-08-28 20:40:45,890 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg']
2025-08-28 20:40:45,892 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:40:45,896 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 20:40:45,896 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('0207', 1, 'вавыавыа', 'вавыавыа №0207', '["https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg"]', None, 'вавыавы', 'null', 99900, 'RUB')
2025-08-28 20:40:45,902 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 20:40:45,905 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:40:45,907 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 20:40:45,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (7,)
2025-08-28 20:40:46,035 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:40:46,035 - aiogram.event - INFO - Update id=954948648 is handled. Duration 4255 ms by bot id=8413666974
2025-08-28 20:40:51,445 - __main__ - INFO - FSM State Change: None
2025-08-28 20:40:51,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:40:51,448 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 20:40:51,448 - sqlalchemy.engine.Engine - INFO - [cached since 138.7s ago] (37996964,)
2025-08-28 20:40:51,451 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 20:40:51,452 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (1, 10, 0)
2025-08-28 20:40:51,601 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:40:51,602 - aiogram.event - INFO - Update id=954948649 is handled. Duration 157 ms by bot id=8413666974
2025-08-28 20:40:54,924 - __main__ - INFO - FSM State Change: None
2025-08-28 20:40:54,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:40:54,929 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 20:40:54,929 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ('0207',)
2025-08-28 20:40:55,826 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:40:55,827 - aiogram.event - INFO - Update id=954948650 is handled. Duration 903 ms by bot id=8413666974
2025-08-28 20:40:59,033 - __main__ - INFO - FSM State Change: None
2025-08-28 20:40:59,039 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:40:59,041 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 20:40:59,041 - sqlalchemy.engine.Engine - INFO - [cached since 4.112s ago] ('0207',)
2025-08-28 20:40:59,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:40:59,237 - aiogram.event - INFO - Update id=954948651 is handled. Duration 206 ms by bot id=8413666974
2025-08-28 20:41:01,784 - __main__ - INFO - FSM State Change: None
2025-08-28 20:41:01,933 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-08-28 20:41:02,043 - aiogram.event - INFO - Update id=954948652 is handled. Duration 260 ms by bot id=8413666974
2025-08-28 20:41:06,334 - __main__ - INFO - FSM State Change: None
2025-08-28 20:41:06,336 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:41:06,337 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 20:41:06,337 - sqlalchemy.engine.Engine - INFO - [cached since 11.41s ago] ('0207',)
2025-08-28 20:41:06,339 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 20:41:06,340 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:41:06,341 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 20:41:06,341 - sqlalchemy.engine.Engine - INFO - [cached since 20.44s ago] (7,)
2025-08-28 20:41:06,477 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:41:06,478 - aiogram.event - INFO - Update id=954948653 is handled. Duration 144 ms by bot id=8413666974
2025-08-28 20:41:11,165 - __main__ - INFO - FSM State Change: None
2025-08-28 20:41:11,168 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 20:41:11,168 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 20:41:11,168 - sqlalchemy.engine.Engine - INFO - [cached since 158.5s ago] (37996964,)
2025-08-28 20:41:11,174 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 20:41:11,174 - sqlalchemy.engine.Engine - INFO - [cached since 19.72s ago] (1, 10, 0)
2025-08-28 20:41:11,345 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 20:41:11,346 - aiogram.event - INFO - Update id=954948654 is handled. Duration 183 ms by bot id=8413666974
2025-08-28 21:09:38,068 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 21:09:38,081 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 21:09:49,882 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 21:30:00,526 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 21:30:00,528 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 21:30:12,895 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 21:36:10,119 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 21:36:10,123 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 21:36:22,617 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 21:37:15,785 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 21:37:15,796 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 21:37:15,797 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 21:37:16,061 - __main__ - INFO - Работа бота завершена
2025-08-28 21:45:49,314 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 21:45:49,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:45:49,318 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 21:45:49,318 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 21:45:49,319 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 21:45:49,319 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 21:45:49,319 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:45:49,319 - __main__ - INFO - База данных инициализирована
2025-08-28 21:45:49,338 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 21:45:49,338 - __main__ - INFO - Запуск polling...
2025-08-28 21:45:49,338 - aiogram.dispatcher - INFO - Start polling
2025-08-28 21:45:50,129 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 21:46:01,156 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:01,166 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:01,181 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:01,182 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('0207',)
2025-08-28 21:46:01,989 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:01,990 - aiogram.event - INFO - Update id=954948655 is handled. Duration 845 ms by bot id=8413666974
2025-08-28 21:46:03,668 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:03,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:03,672 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:03,672 - sqlalchemy.engine.Engine - INFO - [cached since 2.491s ago] ('0207',)
2025-08-28 21:46:04,804 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 21:46:04,951 - root - INFO - Объект https://foto-cat.storage.yandexcloud.net/bouquets/0207/d10ae86bef3a4552a5617bf42aa87e50.jpg успешно удален из хранилища
2025-08-28 21:46:05,126 - root - INFO - Объект bouquets/0207/3edbd9fa20f646cc983a32612ac3c44b.jpg успешно удален из хранилища
2025-08-28 21:46:05,300 - root - INFO - Объект bouquets/0207/46f192a6efc647b0bfea570d25c3ec02.jpg успешно удален из хранилища
2025-08-28 21:46:05,301 - root - INFO - Удалено 3 файлов букета 0207
2025-08-28 21:46:05,301 - root - INFO - Файлы букета 0207 успешно удалены с сервера
2025-08-28 21:46:05,302 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:05,302 - sqlalchemy.engine.Engine - INFO - [cached since 4.121s ago] ('0207',)
2025-08-28 21:46:05,310 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:05,310 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (7,)
2025-08-28 21:46:05,314 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:05,496 - aiogram.event - INFO - Update id=954948656 is handled. Duration 1829 ms by bot id=8413666974
2025-08-28 21:46:07,681 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:07,682 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:07,684 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:07,684 - sqlalchemy.engine.Engine - INFO - [generated in 0.00021s] (37996964,)
2025-08-28 21:46:07,686 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:07,686 - sqlalchemy.engine.Engine - INFO - [generated in 0.00031s] (1, 10, 0)
2025-08-28 21:46:07,892 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:07,893 - aiogram.event - INFO - Update id=954948657 is handled. Duration 212 ms by bot id=8413666974
2025-08-28 21:46:09,334 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:09,339 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:09,340 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:09,340 - sqlalchemy.engine.Engine - INFO - [cached since 8.159s ago] ('0206',)
2025-08-28 21:46:09,522 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:09,523 - aiogram.event - INFO - Update id=954948658 is handled. Duration 194 ms by bot id=8413666974
2025-08-28 21:46:11,390 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:11,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:11,394 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:11,394 - sqlalchemy.engine.Engine - INFO - [cached since 10.21s ago] ('0206',)
2025-08-28 21:46:11,556 - root - INFO - Объект bouquets/0206/4ec9b3cb1dec44799fc05b0cf3af12f8.jpg успешно удален из хранилища
2025-08-28 21:46:11,745 - root - INFO - Объект bouquets/0206/3e509e64a5ba4c1198c31fc7bd9a6e3d.jpg успешно удален из хранилища
2025-08-28 21:46:11,904 - root - INFO - Объект bouquets/0206/3a00b99d391047c7aec31ab280949d55.jpg успешно удален из хранилища
2025-08-28 21:46:12,072 - root - INFO - Объект bouquets/0206/5391789e37e740438d1adb5db289c5de.jpg успешно удален из хранилища
2025-08-28 21:46:12,073 - root - INFO - Удалено 4 файлов букета 0206
2025-08-28 21:46:12,073 - root - INFO - Файлы букета 0206 успешно удалены с сервера
2025-08-28 21:46:12,074 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:12,074 - sqlalchemy.engine.Engine - INFO - [cached since 10.89s ago] ('0206',)
2025-08-28 21:46:12,079 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:12,080 - sqlalchemy.engine.Engine - INFO - [cached since 6.77s ago] (6,)
2025-08-28 21:46:12,082 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:12,260 - aiogram.event - INFO - Update id=954948659 is handled. Duration 872 ms by bot id=8413666974
2025-08-28 21:46:14,601 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:14,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:14,603 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:14,603 - sqlalchemy.engine.Engine - INFO - [cached since 6.92s ago] (37996964,)
2025-08-28 21:46:14,605 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:14,605 - sqlalchemy.engine.Engine - INFO - [cached since 6.919s ago] (1, 10, 0)
2025-08-28 21:46:14,895 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:14,897 - aiogram.event - INFO - Update id=954948660 is handled. Duration 296 ms by bot id=8413666974
2025-08-28 21:46:16,617 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:16,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:16,620 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:16,620 - sqlalchemy.engine.Engine - INFO - [cached since 15.44s ago] ('0205',)
2025-08-28 21:46:16,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:16,781 - aiogram.event - INFO - Update id=954948661 is handled. Duration 165 ms by bot id=8413666974
2025-08-28 21:46:18,583 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:18,586 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:18,587 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:18,587 - sqlalchemy.engine.Engine - INFO - [cached since 17.41s ago] ('0205',)
2025-08-28 21:46:18,769 - root - INFO - Объект bouquets/0205/e9fd5c66a37d4cc5a2bf8e3e7e482a0c.jpg успешно удален из хранилища
2025-08-28 21:46:18,769 - root - INFO - Удалено 1 файлов букета 0205
2025-08-28 21:46:18,770 - root - INFO - Файлы букета 0205 успешно удалены с сервера
2025-08-28 21:46:18,782 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:18,783 - sqlalchemy.engine.Engine - INFO - [cached since 17.6s ago] ('0205',)
2025-08-28 21:46:18,784 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:18,785 - sqlalchemy.engine.Engine - INFO - [cached since 13.48s ago] (5,)
2025-08-28 21:46:18,785 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:18,918 - aiogram.event - INFO - Update id=954948662 is handled. Duration 335 ms by bot id=8413666974
2025-08-28 21:46:22,938 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:22,940 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:22,940 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:22,940 - sqlalchemy.engine.Engine - INFO - [cached since 15.26s ago] (37996964,)
2025-08-28 21:46:22,942 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:22,942 - sqlalchemy.engine.Engine - INFO - [cached since 15.26s ago] (1, 10, 0)
2025-08-28 21:46:23,100 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:23,101 - aiogram.event - INFO - Update id=954948663 is handled. Duration 163 ms by bot id=8413666974
2025-08-28 21:46:24,628 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:24,631 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:24,632 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:24,632 - sqlalchemy.engine.Engine - INFO - [cached since 23.45s ago] ('0204',)
2025-08-28 21:46:24,752 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:24,753 - aiogram.event - INFO - Update id=954948664 is handled. Duration 126 ms by bot id=8413666974
2025-08-28 21:46:26,603 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:26,607 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:26,607 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:26,607 - sqlalchemy.engine.Engine - INFO - [cached since 25.43s ago] ('0204',)
2025-08-28 21:46:26,766 - root - INFO - Объект bouquets/0204/7b1037ca13f248c5825692a354a9b001.jpg успешно удален из хранилища
2025-08-28 21:46:27,892 - root - INFO - Объект bouquets/0204/13c980d8f8cd47ebb9d4f68ae9d8d852.jpg успешно удален из хранилища
2025-08-28 21:46:27,894 - root - INFO - Удалено 2 файлов букета 0204
2025-08-28 21:46:27,894 - root - INFO - Файлы букета 0204 успешно удалены с сервера
2025-08-28 21:46:27,895 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:27,896 - sqlalchemy.engine.Engine - INFO - [cached since 26.72s ago] ('0204',)
2025-08-28 21:46:27,898 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:27,899 - sqlalchemy.engine.Engine - INFO - [cached since 22.59s ago] (4,)
2025-08-28 21:46:27,900 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:28,037 - aiogram.event - INFO - Update id=954948665 is handled. Duration 1435 ms by bot id=8413666974
2025-08-28 21:46:30,990 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:30,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:30,991 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:30,992 - sqlalchemy.engine.Engine - INFO - [cached since 23.31s ago] (37996964,)
2025-08-28 21:46:30,993 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:30,993 - sqlalchemy.engine.Engine - INFO - [cached since 23.31s ago] (1, 10, 0)
2025-08-28 21:46:31,210 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:31,210 - aiogram.event - INFO - Update id=954948666 is handled. Duration 221 ms by bot id=8413666974
2025-08-28 21:46:32,794 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:32,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:32,798 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:32,798 - sqlalchemy.engine.Engine - INFO - [cached since 31.62s ago] ('0203',)
2025-08-28 21:46:34,134 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:34,135 - aiogram.event - INFO - Update id=954948667 is handled. Duration 1342 ms by bot id=8413666974
2025-08-28 21:46:35,484 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:35,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:35,486 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:35,486 - sqlalchemy.engine.Engine - INFO - [cached since 34.31s ago] ('0203',)
2025-08-28 21:46:35,656 - root - INFO - Объект bouquets/0203/588a7e835820496ebb8b4c0f09d9c76a.jpg успешно удален из хранилища
2025-08-28 21:46:35,814 - root - INFO - Объект bouquets/0203/9a5b8a6f27cf4f238968b1e5fb46acad.jpg успешно удален из хранилища
2025-08-28 21:46:35,814 - root - INFO - Удалено 2 файлов букета 0203
2025-08-28 21:46:35,814 - root - INFO - Файлы букета 0203 успешно удалены с сервера
2025-08-28 21:46:35,816 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:35,816 - sqlalchemy.engine.Engine - INFO - [cached since 34.64s ago] ('0203',)
2025-08-28 21:46:35,820 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:35,820 - sqlalchemy.engine.Engine - INFO - [cached since 30.51s ago] (3,)
2025-08-28 21:46:35,823 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:35,960 - aiogram.event - INFO - Update id=954948668 is handled. Duration 477 ms by bot id=8413666974
2025-08-28 21:46:37,929 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:37,930 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:37,930 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:37,930 - sqlalchemy.engine.Engine - INFO - [cached since 30.25s ago] (37996964,)
2025-08-28 21:46:37,932 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:37,932 - sqlalchemy.engine.Engine - INFO - [cached since 30.25s ago] (1, 10, 0)
2025-08-28 21:46:38,132 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:38,133 - aiogram.event - INFO - Update id=954948669 is handled. Duration 204 ms by bot id=8413666974
2025-08-28 21:46:39,563 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:39,564 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:39,564 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:39,564 - sqlalchemy.engine.Engine - INFO - [cached since 38.38s ago] ('0202',)
2025-08-28 21:46:39,756 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:39,757 - aiogram.event - INFO - Update id=954948670 is handled. Duration 193 ms by bot id=8413666974
2025-08-28 21:46:41,710 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:41,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:41,713 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:41,713 - sqlalchemy.engine.Engine - INFO - [cached since 40.53s ago] ('0202',)
2025-08-28 21:46:41,715 - root - INFO - Удалено 0 файлов букета 0202
2025-08-28 21:46:41,715 - root - WARNING - Не удалось удалить файлы букета 0202 с сервера
2025-08-28 21:46:41,716 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:41,716 - sqlalchemy.engine.Engine - INFO - [cached since 40.54s ago] ('0202',)
2025-08-28 21:46:41,720 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:41,720 - sqlalchemy.engine.Engine - INFO - [cached since 36.41s ago] (2,)
2025-08-28 21:46:41,722 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:41,931 - aiogram.event - INFO - Update id=954948671 is handled. Duration 222 ms by bot id=8413666974
2025-08-28 21:46:48,601 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:48,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:48,604 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:48,604 - sqlalchemy.engine.Engine - INFO - [cached since 40.92s ago] (37996964,)
2025-08-28 21:46:48,606 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:48,606 - sqlalchemy.engine.Engine - INFO - [cached since 40.92s ago] (1, 10, 0)
2025-08-28 21:46:48,742 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:48,743 - aiogram.event - INFO - Update id=954948672 is handled. Duration 142 ms by bot id=8413666974
2025-08-28 21:46:50,625 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:50,626 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:50,627 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:50,627 - sqlalchemy.engine.Engine - INFO - [cached since 49.45s ago] ('0201',)
2025-08-28 21:46:50,763 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:50,764 - aiogram.event - INFO - Update id=954948673 is handled. Duration 140 ms by bot id=8413666974
2025-08-28 21:46:52,303 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:52,306 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:52,307 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:52,307 - sqlalchemy.engine.Engine - INFO - [cached since 51.13s ago] ('0201',)
2025-08-28 21:46:52,309 - root - INFO - Удалено 0 файлов букета 0201
2025-08-28 21:46:52,310 - root - WARNING - Не удалось удалить файлы букета 0201 с сервера
2025-08-28 21:46:52,310 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:46:52,310 - sqlalchemy.engine.Engine - INFO - [cached since 51.13s ago] ('0201',)
2025-08-28 21:46:52,313 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 21:46:52,313 - sqlalchemy.engine.Engine - INFO - [cached since 47.01s ago] (1,)
2025-08-28 21:46:52,314 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:46:52,456 - aiogram.event - INFO - Update id=954948674 is handled. Duration 154 ms by bot id=8413666974
2025-08-28 21:46:57,453 - __main__ - INFO - FSM State Change: None
2025-08-28 21:46:57,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:46:57,480 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:46:57,480 - sqlalchemy.engine.Engine - INFO - [cached since 49.8s ago] (37996964,)
2025-08-28 21:46:57,483 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:46:57,483 - sqlalchemy.engine.Engine - INFO - [cached since 49.8s ago] (1, 10, 0)
2025-08-28 21:46:57,618 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:46:57,619 - aiogram.event - INFO - Update id=954948675 is handled. Duration 167 ms by bot id=8413666974
2025-08-28 21:47:00,891 - __main__ - INFO - FSM State Change: None
2025-08-28 21:47:01,015 - aiogram.event - INFO - Update id=954948676 is handled. Duration 124 ms by bot id=8413666974
2025-08-28 21:47:04,773 - __main__ - INFO - FSM State Change: None
2025-08-28 21:47:05,157 - aiogram.event - INFO - Update id=954948677 is handled. Duration 385 ms by bot id=8413666974
2025-08-28 21:47:38,227 - __main__ - INFO - FSM State Change: None
2025-08-28 21:47:38,229 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:47:38,229 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:47:38,229 - sqlalchemy.engine.Engine - INFO - [cached since 90.55s ago] (37996964,)
2025-08-28 21:47:38,234 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 21:47:38,234 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1, 0)
2025-08-28 21:47:38,361 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:47:38,362 - aiogram.event - INFO - Update id=954948678 is handled. Duration 138 ms by bot id=8413666974
2025-08-28 21:47:42,889 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 21:47:43,078 - aiogram.event - INFO - Update id=954948679 is handled. Duration 190 ms by bot id=8413666974
2025-08-28 21:47:46,058 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 21:47:46,061 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 21:47:46,303 - root - INFO - Состояние установлено: waiting_media
2025-08-28 21:47:46,304 - aiogram.event - INFO - Update id=954948680 is handled. Duration 246 ms by bot id=8413666974
2025-08-28 21:48:07,629 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:07,629 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:07,630 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:07,633 - aiogram.event - INFO - Update id=954948682 is handled. Duration 12 ms by bot id=8413666974
2025-08-28 21:48:07,634 - aiogram.event - INFO - Update id=954948683 is handled. Duration 11 ms by bot id=8413666974
2025-08-28 21:48:07,634 - aiogram.event - INFO - Update id=954948681 is handled. Duration 14 ms by bot id=8413666974
2025-08-28 21:48:12,351 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:12,630 - aiogram.event - INFO - Update id=954948684 is handled. Duration 279 ms by bot id=8413666974
2025-08-28 21:48:54,006 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:54,011 - aiogram.event - INFO - Update id=954948685 is not handled. Duration 25 ms by bot id=8413666974
2025-08-28 21:48:59,077 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 21:48:59,261 - aiogram.event - INFO - Update id=954948686 is handled. Duration 184 ms by bot id=8413666974
2025-08-28 21:49:04,079 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 21:49:04,239 - aiogram.event - INFO - Update id=954948687 is handled. Duration 161 ms by bot id=8413666974
2025-08-28 21:49:06,452 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 21:49:06,618 - aiogram.event - INFO - Update id=954948688 is handled. Duration 166 ms by bot id=8413666974
2025-08-28 21:49:10,136 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 21:49:10,306 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-08-28 21:49:10,464 - aiogram.event - INFO - Update id=954948689 is handled. Duration 332 ms by bot id=8413666974
2025-08-28 21:49:20,642 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 21:49:20,642 - root - INFO - Начинаем загрузку медиа для букета 0201
2025-08-28 21:49:20,643 - root - INFO - Начинаем загрузку 3 медиафайлов для букета 0201
2025-08-28 21:49:20,643 - root - INFO - Обрабатываем медиа 1/3: AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA
2025-08-28 21:49:20,643 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPJaK9p0EHQARd_g2rT5pn947bbsJMAAp78MRsJF4FJoKyCYtkr2OEBAAMCAAN5AAM2BA для букета 0201
2025-08-28 21:49:20,738 - root - INFO - Файл получен из Telegram: photos/file_2.jpg
2025-08-28 21:49:20,738 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg
2025-08-28 21:49:21,001 - root - INFO - Размер файла: 89982 байт
2025-08-28 21:49:21,815 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 21:49:21,816 - root - INFO - Загрузка файла bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg, размер: 89982 байт
2025-08-28 21:49:22,311 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg
2025-08-28 21:49:22,312 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg
2025-08-28 21:49:22,316 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg
2025-08-28 21:49:22,316 - root - INFO - Обрабатываем медиа 2/3: AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ
2025-08-28 21:49:22,316 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ для букета 0201
2025-08-28 21:49:22,434 - root - INFO - Файл получен из Telegram: photos/file_17.jpg
2025-08-28 21:49:22,434 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg
2025-08-28 21:49:22,693 - root - INFO - Размер файла: 90801 байт
2025-08-28 21:49:23,490 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 21:49:23,490 - root - INFO - Загрузка файла bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg, размер: 90801 байт
2025-08-28 21:49:24,045 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg
2025-08-28 21:49:24,045 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg
2025-08-28 21:49:24,049 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg
2025-08-28 21:49:24,050 - root - INFO - Обрабатываем медиа 3/3: AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA
2025-08-28 21:49:24,050 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAPIaK9p0EnEnFQ1YMrDKvByNLG1sscAAp38MRsJF4FJlSikgS8oi8EBAAMCAAN5AAM2BA для букета 0201
2025-08-28 21:49:24,148 - root - INFO - Файл получен из Telegram: photos/file_3.jpg
2025-08-28 21:49:24,148 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg
2025-08-28 21:49:24,399 - root - INFO - Размер файла: 83400 байт
2025-08-28 21:49:25,292 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 21:49:25,293 - root - INFO - Загрузка файла bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg, размер: 83400 байт
2025-08-28 21:49:25,755 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg
2025-08-28 21:49:25,755 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg
2025-08-28 21:49:25,758 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg
2025-08-28 21:49:25,758 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg']
2025-08-28 21:49:25,762 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:49:25,766 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 21:49:25,766 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] ('0201', 1, 'тетмс ntt', 'тетмс ntt №0201', '["https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg", "https://foto-cat.storage.yandexcloud.net/bouq ... (8 characters truncated) ... 1/photos/842eedf1d6834801a9436eca98161a71.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg"]', None, 'ffegfdgdf', 'null', 500000, 'RUB')
2025-08-28 21:49:25,773 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 21:49:25,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:49:25,781 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 21:49:25,781 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (1,)
2025-08-28 21:49:25,921 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:49:25,922 - aiogram.event - INFO - Update id=954948690 is handled. Duration 5281 ms by bot id=8413666974
2025-08-28 21:50:17,060 - __main__ - INFO - FSM State Change: None
2025-08-28 21:50:17,067 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:50:17,090 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 21:50:17,090 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] (37996964,)
2025-08-28 21:50:17,096 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 21:50:17,096 - sqlalchemy.engine.Engine - INFO - [cached since 249.4s ago] (1, 10, 0)
2025-08-28 21:50:17,267 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:50:17,268 - aiogram.event - INFO - Update id=954948691 is handled. Duration 210 ms by bot id=8413666974
2025-08-28 21:50:21,070 - __main__ - INFO - FSM State Change: None
2025-08-28 21:50:21,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:50:21,072 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:50:21,072 - sqlalchemy.engine.Engine - INFO - [cached since 259.9s ago] ('0201',)
2025-08-28 21:50:21,724 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:50:21,725 - aiogram.event - INFO - Update id=954948692 is handled. Duration 656 ms by bot id=8413666974
2025-08-28 21:50:23,875 - __main__ - INFO - FSM State Change: None
2025-08-28 21:50:23,878 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 21:50:23,878 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 21:50:23,878 - sqlalchemy.engine.Engine - INFO - [cached since 262.7s ago] ('0201',)
2025-08-28 21:50:24,081 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 21:50:24,082 - aiogram.event - INFO - Update id=954948693 is handled. Duration 208 ms by bot id=8413666974
2025-08-28 22:31:19,282 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 22:31:19,313 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 22:31:31,066 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-28 22:54:38,163 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-28 22:54:38,187 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 22:54:38,188 - aiogram.dispatcher - INFO - Polling stopped
2025-08-28 22:54:38,473 - __main__ - INFO - Работа бота завершена
2025-08-28 22:54:41,214 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-28 22:54:41,217 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:54:41,217 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-28 22:54:41,217 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 22:54:41,218 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-28 22:54:41,218 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-28 22:54:41,218 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 22:54:41,218 - __main__ - INFO - База данных инициализирована
2025-08-28 22:54:41,235 - __main__ - INFO - Бот успешно создан и настроен
2025-08-28 22:54:41,235 - __main__ - INFO - Запуск polling...
2025-08-28 22:54:41,235 - aiogram.dispatcher - INFO - Start polling
2025-08-28 22:54:41,999 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-28 22:56:53,866 - __main__ - INFO - FSM State Change: None
2025-08-28 22:56:53,875 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:56:53,888 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 22:56:53,888 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (37996964,)
2025-08-28 22:56:54,566 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:56:54,567 - aiogram.event - INFO - Update id=954948694 is handled. Duration 753 ms by bot id=8413666974
2025-08-28 22:56:56,911 - __main__ - INFO - FSM State Change: None
2025-08-28 22:56:56,926 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:56:56,927 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 22:56:56,927 - sqlalchemy.engine.Engine - INFO - [cached since 3.04s ago] (37996964,)
2025-08-28 22:56:56,931 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 22:56:56,931 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1, 10, 0)
2025-08-28 22:56:57,133 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:56:57,134 - aiogram.event - INFO - Update id=954948695 is handled. Duration 223 ms by bot id=8413666974
2025-08-28 22:56:59,068 - __main__ - INFO - FSM State Change: None
2025-08-28 22:56:59,070 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:56:59,071 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 22:56:59,071 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('0201',)
2025-08-28 22:56:59,239 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:56:59,240 - aiogram.event - INFO - Update id=954948696 is handled. Duration 184 ms by bot id=8413666974
2025-08-28 22:57:01,524 - __main__ - INFO - FSM State Change: None
2025-08-28 22:57:01,527 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:57:01,527 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 22:57:01,527 - sqlalchemy.engine.Engine - INFO - [cached since 2.456s ago] ('0201',)
2025-08-28 22:57:02,771 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 22:57:02,920 - root - INFO - Объект https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/9bfa1379dc364cf19d26cf48ad66bdd5.jpg успешно удален из хранилища
2025-08-28 22:57:03,076 - root - INFO - Объект bouquets/0201/photos/842eedf1d6834801a9436eca98161a71.jpg успешно удален из хранилища
2025-08-28 22:57:03,219 - root - INFO - Объект bouquets/0201/photos/e884a9730f2641a9a3a8b4cffe63ccca.jpg успешно удален из хранилища
2025-08-28 22:57:03,219 - root - INFO - Удалено 3 файлов букета 0201
2025-08-28 22:57:03,219 - root - INFO - Файлы букета 0201 успешно удалены с сервера
2025-08-28 22:57:03,221 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 22:57:03,221 - sqlalchemy.engine.Engine - INFO - [cached since 4.15s ago] ('0201',)
2025-08-28 22:57:03,228 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 22:57:03,228 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (1,)
2025-08-28 22:57:03,231 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 22:57:03,454 - aiogram.event - INFO - Update id=954948697 is handled. Duration 1932 ms by bot id=8413666974
2025-08-28 22:57:06,098 - __main__ - INFO - FSM State Change: None
2025-08-28 22:57:06,104 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:57:06,108 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 22:57:06,108 - sqlalchemy.engine.Engine - INFO - [cached since 12.22s ago] (37996964,)
2025-08-28 22:57:06,115 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-28 22:57:06,115 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 0)
2025-08-28 22:57:06,273 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:57:06,274 - aiogram.event - INFO - Update id=954948698 is handled. Duration 177 ms by bot id=8413666974
2025-08-28 22:57:09,866 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 22:57:10,006 - aiogram.event - INFO - Update id=954948699 is handled. Duration 164 ms by bot id=8413666974
2025-08-28 22:57:12,675 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-28 22:57:12,677 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-28 22:57:12,893 - root - INFO - Состояние установлено: waiting_media
2025-08-28 22:57:12,893 - aiogram.event - INFO - Update id=954948700 is handled. Duration 218 ms by bot id=8413666974
2025-08-28 22:57:41,407 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:57:41,409 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:57:41,423 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:57:41,424 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:57:41,425 - aiogram.event - INFO - Update id=954948702 is handled. Duration 55 ms by bot id=8413666974
2025-08-28 22:57:41,425 - aiogram.event - INFO - Update id=954948701 is handled. Duration 57 ms by bot id=8413666974
2025-08-28 22:57:41,427 - aiogram.event - INFO - Update id=954948703 is handled. Duration 57 ms by bot id=8413666974
2025-08-28 22:57:41,428 - aiogram.event - INFO - Update id=954948704 is handled. Duration 57 ms by bot id=8413666974
2025-08-28 22:57:51,574 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:57:51,844 - aiogram.event - INFO - Update id=954948705 is handled. Duration 271 ms by bot id=8413666974
2025-08-28 22:58:42,962 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:58:42,980 - aiogram.event - INFO - Update id=954948706 is not handled. Duration 32 ms by bot id=8413666974
2025-08-28 22:58:50,683 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-28 22:58:50,862 - aiogram.event - INFO - Update id=954948707 is handled. Duration 181 ms by bot id=8413666974
2025-08-28 22:58:56,565 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-28 22:58:56,758 - aiogram.event - INFO - Update id=954948708 is handled. Duration 195 ms by bot id=8413666974
2025-08-28 22:58:59,344 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-28 22:58:59,667 - aiogram.event - INFO - Update id=954948709 is handled. Duration 323 ms by bot id=8413666974
2025-08-28 22:59:03,649 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-28 22:59:03,782 - aiogram.event - INFO - Update id=954948710 is handled. Duration 133 ms by bot id=8413666974
2025-08-28 22:59:05,930 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 22:59:05,931 - root - INFO - Начинаем загрузку медиа для букета 0201
2025-08-28 22:59:05,932 - root - INFO - Начинаем загрузку 4 медиафайлов для букета 0201
2025-08-28 22:59:05,933 - root - INFO - Обрабатываем медиа 1/4: AgACAgIAAxkBAAIB_WiwtLX9ltgOqixoOoB9C8iWd0ddAAJW_zEb8p-ASa_GYhW0YqnFAQADAgADeQADNgQ
2025-08-28 22:59:05,933 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB_WiwtLX9ltgOqixoOoB9C8iWd0ddAAJW_zEb8p-ASa_GYhW0YqnFAQADAgADeQADNgQ для букета 0201
2025-08-28 22:59:06,048 - root - INFO - Файл получен из Telegram: photos/file_18.jpg
2025-08-28 22:59:06,048 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg
2025-08-28 22:59:06,339 - root - INFO - Размер файла: 82133 байт
2025-08-28 22:59:07,242 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 22:59:07,242 - root - INFO - Загрузка файла bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg, размер: 82133 байт
2025-08-28 22:59:07,808 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg
2025-08-28 22:59:07,809 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg
2025-08-28 22:59:07,812 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg
2025-08-28 22:59:07,812 - root - INFO - Обрабатываем медиа 2/4: AgACAgIAAxkBAAIB_GiwtLWg4u-Giq799G2dHRQeI-WUAAJV_zEb8p-AScqp0wUL-BQtAQADAgADeQADNgQ
2025-08-28 22:59:07,814 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB_GiwtLWg4u-Giq799G2dHRQeI-WUAAJV_zEb8p-AScqp0wUL-BQtAQADAgADeQADNgQ для букета 0201
2025-08-28 22:59:07,948 - root - INFO - Файл получен из Telegram: photos/file_19.jpg
2025-08-28 22:59:07,948 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg
2025-08-28 22:59:08,219 - root - INFO - Размер файла: 81687 байт
2025-08-28 22:59:09,003 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 22:59:09,003 - root - INFO - Загрузка файла bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg, размер: 81687 байт
2025-08-28 22:59:09,489 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg
2025-08-28 22:59:09,489 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg
2025-08-28 22:59:09,493 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg
2025-08-28 22:59:09,493 - root - INFO - Обрабатываем медиа 3/4: AgACAgIAAxkBAAIB_miwtLXQjFK46nYAAd372vDT4We7_wACV_8xG_KfgEntbx9YrsQfcQEAAwIAA3kAAzYE
2025-08-28 22:59:09,493 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB_miwtLXQjFK46nYAAd372vDT4We7_wACV_8xG_KfgEntbx9YrsQfcQEAAwIAA3kAAzYE для букета 0201
2025-08-28 22:59:09,702 - root - INFO - Файл получен из Telegram: photos/file_20.jpg
2025-08-28 22:59:09,702 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg
2025-08-28 22:59:09,966 - root - INFO - Размер файла: 76419 байт
2025-08-28 22:59:11,001 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 22:59:11,002 - root - INFO - Загрузка файла bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg, размер: 76419 байт
2025-08-28 22:59:11,026 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-28 22:59:11,034 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:59:11,035 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 22:59:11,035 - sqlalchemy.engine.Engine - INFO - [cached since 137.2s ago] (37996964,)
2025-08-28 22:59:11,041 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 22:59:11,041 - sqlalchemy.engine.Engine - INFO - [cached since 134.1s ago] (1, 10, 0)
2025-08-28 22:59:11,183 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:59:11,183 - aiogram.event - INFO - Update id=954948712 is handled. Duration 158 ms by bot id=8413666974
2025-08-28 22:59:11,468 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg
2025-08-28 22:59:11,468 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg
2025-08-28 22:59:11,472 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg
2025-08-28 22:59:11,472 - root - INFO - Обрабатываем медиа 4/4: AgACAgIAAxkBAAIB_2iwtLV7yrMHDdtlIW8_5Vre9DbZAAJY_zEb8p-ASbmNGTMYZrwdAQADAgADeQADNgQ
2025-08-28 22:59:11,473 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB_2iwtLV7yrMHDdtlIW8_5Vre9DbZAAJY_zEb8p-ASbmNGTMYZrwdAQADAgADeQADNgQ для букета 0201
2025-08-28 22:59:11,716 - root - INFO - Файл получен из Telegram: photos/file_21.jpg
2025-08-28 22:59:11,717 - root - INFO - Генерируем имя объекта: bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg
2025-08-28 22:59:11,965 - root - INFO - Размер файла: 75543 байт
2025-08-28 22:59:12,853 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-28 22:59:12,853 - root - INFO - Загрузка файла bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg, размер: 75543 байт
2025-08-28 22:59:13,347 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg
2025-08-28 22:59:13,348 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg
2025-08-28 22:59:13,350 - root - INFO - Медиа 4 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg
2025-08-28 22:59:13,351 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg']
2025-08-28 22:59:13,353 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:59:13,360 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-28 22:59:13,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('0201', 1, 'выаваыв', 'выаваыв №0201', '["https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg", "https://foto-cat.storage.yandexcloud.net/bouq ... (110 characters truncated) ... 1/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg"]', None, 'ваываывавы', 'null', 455400, 'RUB')
2025-08-28 22:59:13,364 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 22:59:13,368 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:59:13,371 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-28 22:59:13,371 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (1,)
2025-08-28 22:59:13,524 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:59:13,525 - aiogram.event - INFO - Update id=954948711 is handled. Duration 7596 ms by bot id=8413666974
2025-08-28 22:59:16,349 - __main__ - INFO - FSM State Change: None
2025-08-28 22:59:16,360 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:59:16,360 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-28 22:59:16,361 - sqlalchemy.engine.Engine - INFO - [cached since 142.5s ago] (37996964,)
2025-08-28 22:59:16,362 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-28 22:59:16,362 - sqlalchemy.engine.Engine - INFO - [cached since 139.4s ago] (1, 10, 0)
2025-08-28 22:59:16,482 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:59:16,483 - aiogram.event - INFO - Update id=954948713 is handled. Duration 142 ms by bot id=8413666974
2025-08-28 22:59:19,508 - __main__ - INFO - FSM State Change: None
2025-08-28 22:59:19,513 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 22:59:19,513 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 22:59:19,514 - sqlalchemy.engine.Engine - INFO - [cached since 140.4s ago] ('0201',)
2025-08-28 22:59:20,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-28 22:59:20,300 - aiogram.event - INFO - Update id=954948714 is handled. Duration 793 ms by bot id=8413666974
2025-08-28 23:00:08,870 - __main__ - INFO - FSM State Change: None
2025-08-28 23:00:08,878 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-28 23:00:08,879 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 23:00:08,879 - sqlalchemy.engine.Engine - INFO - [cached since 189.8s ago] ('0201',)
2025-08-28 23:00:10,222 - root - INFO - Объект bouquets/0201/photos/2c1e09f8670b4a34aacbc37d66e4b7ef.jpg успешно удален из хранилища
2025-08-28 23:00:10,411 - root - INFO - Объект bouquets/0201/photos/ce4321e592e948279c0d26166c6bf898.jpg успешно удален из хранилища
2025-08-28 23:00:10,601 - root - INFO - Объект bouquets/0201/photos/ed8af170ecbc47f18db2f1181bd44d29.jpg успешно удален из хранилища
2025-08-28 23:00:10,784 - root - INFO - Объект bouquets/0201/photos/e330e7a78e064e01be764f7dade50863.jpg успешно удален из хранилища
2025-08-28 23:00:10,784 - root - INFO - Удалено 4 файлов букета 0201
2025-08-28 23:00:10,784 - root - INFO - Файлы букета 0201 успешно удалены с сервера
2025-08-28 23:00:10,785 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-28 23:00:10,785 - sqlalchemy.engine.Engine - INFO - [cached since 191.7s ago] ('0201',)
2025-08-28 23:00:10,788 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-08-28 23:00:10,788 - sqlalchemy.engine.Engine - INFO - [cached since 187.6s ago] (1,)
2025-08-28 23:00:10,790 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-28 23:00:11,096 - aiogram.event - INFO - Update id=954948715 is handled. Duration 2229 ms by bot id=8413666974
2025-08-28 23:17:34,255 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 23:17:34,258 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-28 23:35:37,192 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 23:35:37,196 - aiogram.dispatcher - WARNING - Sleep for 1.498601 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-28 23:53:01,049 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-28 23:53:01,130 - aiogram.dispatcher - WARNING - Sleep for 2.036301 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-28 23:53:13,951 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-08-29 00:08:48,185 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 00:08:48,186 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 00:26:01,139 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 00:26:01,229 - aiogram.dispatcher - WARNING - Sleep for 1.200509 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-29 00:43:11,110 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 00:43:11,196 - aiogram.dispatcher - WARNING - Sleep for 1.461128 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-29 00:59:29,096 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 00:59:29,178 - aiogram.dispatcher - WARNING - Sleep for 1.840004 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-29 01:15:18,140 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 01:15:18,222 - aiogram.dispatcher - WARNING - Sleep for 2.470520 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-29 01:32:27,118 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 01:32:27,200 - aiogram.dispatcher - WARNING - Sleep for 3.249378 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-29 01:47:41,103 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 01:47:41,188 - aiogram.dispatcher - WARNING - Sleep for 4.287982 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-29 02:03:38,078 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 02:03:38,161 - aiogram.dispatcher - WARNING - Sleep for 4.905077 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-29 02:19:53,049 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 02:19:53,132 - aiogram.dispatcher - WARNING - Sleep for 4.889504 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-29 02:37:38,025 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 02:37:38,025 - aiogram.dispatcher - WARNING - Sleep for 5.026526 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-29 02:55:22,006 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 02:55:22,091 - aiogram.dispatcher - WARNING - Sleep for 5.149704 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-29 03:11:33,990 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 03:11:34,075 - aiogram.dispatcher - WARNING - Sleep for 4.983990 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-29 03:11:49,681 - aiogram.dispatcher - INFO - Connection established (tryings = 12, bot id = 8413666974)
2025-08-29 03:28:11,990 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 03:28:12,059 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 03:43:20,954 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 03:43:21,039 - aiogram.dispatcher - WARNING - Sleep for 1.106414 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-29 03:58:56,825 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 03:58:56,909 - aiogram.dispatcher - WARNING - Sleep for 1.455970 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-29 04:14:41,791 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 04:14:41,791 - aiogram.dispatcher - WARNING - Sleep for 2.073346 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-29 04:32:37,746 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 04:32:37,826 - aiogram.dispatcher - WARNING - Sleep for 2.768167 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-29 04:50:07,697 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 04:50:07,697 - aiogram.dispatcher - WARNING - Sleep for 3.441978 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-29 05:08:06,573 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 05:08:06,656 - aiogram.dispatcher - WARNING - Sleep for 4.440273 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-29 05:24:18,531 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 05:24:18,531 - aiogram.dispatcher - WARNING - Sleep for 5.037507 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-29 05:40:00,500 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 05:40:00,584 - aiogram.dispatcher - WARNING - Sleep for 4.947206 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-29 05:55:35,475 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 05:55:35,475 - aiogram.dispatcher - WARNING - Sleep for 5.047745 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-29 06:13:15,448 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 06:13:15,529 - aiogram.dispatcher - WARNING - Sleep for 5.028847 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-29 06:30:25,407 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 06:30:25,491 - aiogram.dispatcher - WARNING - Sleep for 5.072603 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-29 06:45:55,363 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 06:45:55,364 - aiogram.dispatcher - WARNING - Sleep for 4.973282 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-29 07:00:00,319 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 07:00:00,406 - aiogram.dispatcher - WARNING - Sleep for 5.105349 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-29 07:13:31,432 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 07:13:31,514 - aiogram.dispatcher - WARNING - Sleep for 4.957368 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-08-29 07:30:48,412 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 07:30:48,494 - aiogram.dispatcher - WARNING - Sleep for 4.911951 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-08-29 07:46:32,386 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 07:46:32,468 - aiogram.dispatcher - WARNING - Sleep for 5.026989 seconds and try again... (tryings = 16, bot id = 8413666974)
2025-08-29 08:21:17,312 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 08:21:17,392 - aiogram.dispatcher - WARNING - Sleep for 4.879780 seconds and try again... (tryings = 17, bot id = 8413666974)
2025-08-29 08:38:09,187 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 08:38:09,187 - aiogram.dispatcher - WARNING - Sleep for 5.013885 seconds and try again... (tryings = 18, bot id = 8413666974)
2025-08-29 08:55:24,138 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 08:55:24,214 - aiogram.dispatcher - WARNING - Sleep for 5.077775 seconds and try again... (tryings = 19, bot id = 8413666974)
2025-08-29 09:30:33,140 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 09:30:33,203 - aiogram.dispatcher - WARNING - Sleep for 5.012504 seconds and try again... (tryings = 20, bot id = 8413666974)
2025-08-29 09:46:36,097 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 09:46:36,173 - aiogram.dispatcher - WARNING - Sleep for 4.832150 seconds and try again... (tryings = 21, bot id = 8413666974)
2025-08-29 10:01:48,070 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 10:01:48,156 - aiogram.dispatcher - WARNING - Sleep for 4.871327 seconds and try again... (tryings = 22, bot id = 8413666974)
2025-08-29 10:19:37,051 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 10:19:37,134 - aiogram.dispatcher - WARNING - Sleep for 4.864227 seconds and try again... (tryings = 23, bot id = 8413666974)
2025-08-29 10:37:13,024 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-29 10:37:13,093 - aiogram.dispatcher - WARNING - Sleep for 5.087263 seconds and try again... (tryings = 24, bot id = 8413666974)
2025-08-29 11:09:36,919 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 11:09:37,013 - aiogram.dispatcher - WARNING - Sleep for 5.088008 seconds and try again... (tryings = 25, bot id = 8413666974)
2025-08-29 11:33:28,672 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 11:33:28,755 - aiogram.dispatcher - WARNING - Sleep for 4.946133 seconds and try again... (tryings = 26, bot id = 8413666974)
2025-08-29 11:33:44,461 - aiogram.dispatcher - INFO - Connection established (tryings = 27, bot id = 8413666974)
2025-08-29 12:11:36,262 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 12:11:36,269 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 12:11:47,979 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 12:14:39,664 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 12:14:39,667 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 12:14:50,915 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 12:34:05,400 - __main__ - INFO - FSM State Change: None
2025-08-29 12:34:05,443 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-29 12:34:05,447 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-29 12:34:05,449 - sqlalchemy.engine.Engine - INFO - [cached since 4196s ago] (37996964,)
2025-08-29 12:34:06,461 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-29 12:34:06,462 - aiogram.event - INFO - Update id=954948716 is handled. Duration 1196 ms by bot id=8413666974
2025-08-29 12:39:31,698 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-29 12:39:31,708 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-29 12:39:31,708 - aiogram.dispatcher - INFO - Polling stopped
2025-08-29 12:39:31,980 - __main__ - INFO - Работа бота завершена
2025-08-29 12:39:35,208 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-29 12:39:35,211 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-29 12:39:35,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-29 12:39:35,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-29 12:39:35,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-29 12:39:35,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-29 12:39:35,212 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-29 12:39:35,212 - __main__ - INFO - База данных инициализирована
2025-08-29 12:39:35,231 - __main__ - INFO - Бот успешно создан и настроен
2025-08-29 12:39:35,231 - __main__ - INFO - Запуск polling...
2025-08-29 12:39:35,231 - aiogram.dispatcher - INFO - Start polling
2025-08-29 12:39:36,247 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-29 12:42:27,673 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 12:42:27,675 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 12:42:39,026 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 13:47:12,110 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 13:47:12,124 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 13:47:23,814 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 13:52:22,841 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 13:52:22,842 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 13:52:34,656 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 13:59:47,594 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-29 13:59:47,595 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 13:59:59,891 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 14:29:53,474 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 14:29:53,477 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 14:30:04,762 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 17:53:49,617 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 17:53:49,621 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 19:17:28,521 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 19:17:28,530 - aiogram.dispatcher - WARNING - Sleep for 1.369527 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-29 19:24:08,391 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-29 20:51:25,818 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 20:51:25,821 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 21:02:09,468 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-29 22:18:19,206 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 22:18:19,208 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-29 22:51:28,181 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 22:51:28,183 - aiogram.dispatcher - WARNING - Sleep for 1.621495 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-29 22:51:37,915 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-29 22:51:37,916 - aiogram.dispatcher - WARNING - Sleep for 2.147256 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-29 22:51:48,083 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-29 22:51:48,084 - aiogram.dispatcher - WARNING - Sleep for 2.811112 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-29 23:55:21,486 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-29 23:55:21,489 - aiogram.dispatcher - WARNING - Sleep for 3.585760 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-30 00:12:09,888 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 00:12:09,889 - aiogram.dispatcher - WARNING - Sleep for 4.744714 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-30 00:44:41,027 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 00:44:41,028 - aiogram.dispatcher - WARNING - Sleep for 4.896517 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-30 01:19:15,282 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:19:15,283 - aiogram.dispatcher - WARNING - Sleep for 4.902141 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-30 01:32:34,849 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:32:34,851 - aiogram.dispatcher - WARNING - Sleep for 4.866856 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-30 01:32:47,734 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:32:47,735 - aiogram.dispatcher - WARNING - Sleep for 4.939149 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-30 01:33:00,684 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:33:00,684 - aiogram.dispatcher - WARNING - Sleep for 5.112186 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-30 01:33:13,822 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:33:13,823 - aiogram.dispatcher - WARNING - Sleep for 5.095720 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-30 01:33:26,958 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:33:26,960 - aiogram.dispatcher - WARNING - Sleep for 5.011262 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-30 01:33:39,979 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:33:39,980 - aiogram.dispatcher - WARNING - Sleep for 4.884678 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-30 01:33:52,875 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:33:52,876 - aiogram.dispatcher - WARNING - Sleep for 5.131482 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-08-30 01:34:06,017 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:34:06,018 - aiogram.dispatcher - WARNING - Sleep for 5.126366 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-08-30 01:34:19,181 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:34:19,183 - aiogram.dispatcher - WARNING - Sleep for 5.043785 seconds and try again... (tryings = 16, bot id = 8413666974)
2025-08-30 01:34:32,239 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:34:32,241 - aiogram.dispatcher - WARNING - Sleep for 4.866454 seconds and try again... (tryings = 17, bot id = 8413666974)
2025-08-30 01:34:45,213 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:34:45,214 - aiogram.dispatcher - WARNING - Sleep for 5.068367 seconds and try again... (tryings = 18, bot id = 8413666974)
2025-08-30 01:34:58,305 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:34:58,307 - aiogram.dispatcher - WARNING - Sleep for 4.900225 seconds and try again... (tryings = 19, bot id = 8413666974)
2025-08-30 01:35:11,228 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:35:11,230 - aiogram.dispatcher - WARNING - Sleep for 4.882291 seconds and try again... (tryings = 20, bot id = 8413666974)
2025-08-30 01:35:24,190 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connect call failed ('149.154.167.220', 443)]
2025-08-30 01:35:24,191 - aiogram.dispatcher - WARNING - Sleep for 5.096008 seconds and try again... (tryings = 21, bot id = 8413666974)
2025-08-30 01:35:29,300 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:29,301 - aiogram.dispatcher - WARNING - Sleep for 5.139731 seconds and try again... (tryings = 22, bot id = 8413666974)
2025-08-30 01:35:34,448 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:34,448 - aiogram.dispatcher - WARNING - Sleep for 4.986215 seconds and try again... (tryings = 23, bot id = 8413666974)
2025-08-30 01:35:39,439 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:39,440 - aiogram.dispatcher - WARNING - Sleep for 4.976074 seconds and try again... (tryings = 24, bot id = 8413666974)
2025-08-30 01:35:44,419 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:44,419 - aiogram.dispatcher - WARNING - Sleep for 5.092156 seconds and try again... (tryings = 25, bot id = 8413666974)
2025-08-30 01:35:49,517 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:49,518 - aiogram.dispatcher - WARNING - Sleep for 4.903160 seconds and try again... (tryings = 26, bot id = 8413666974)
2025-08-30 01:35:54,424 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:54,424 - aiogram.dispatcher - WARNING - Sleep for 5.082153 seconds and try again... (tryings = 27, bot id = 8413666974)
2025-08-30 01:35:59,518 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:35:59,520 - aiogram.dispatcher - WARNING - Sleep for 4.887382 seconds and try again... (tryings = 28, bot id = 8413666974)
2025-08-30 01:36:04,411 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:04,412 - aiogram.dispatcher - WARNING - Sleep for 4.923096 seconds and try again... (tryings = 29, bot id = 8413666974)
2025-08-30 01:36:09,341 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:09,342 - aiogram.dispatcher - WARNING - Sleep for 4.971755 seconds and try again... (tryings = 30, bot id = 8413666974)
2025-08-30 01:36:14,318 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:14,318 - aiogram.dispatcher - WARNING - Sleep for 5.003496 seconds and try again... (tryings = 31, bot id = 8413666974)
2025-08-30 01:36:19,325 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:19,326 - aiogram.dispatcher - WARNING - Sleep for 5.105209 seconds and try again... (tryings = 32, bot id = 8413666974)
2025-08-30 01:36:24,436 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:24,436 - aiogram.dispatcher - WARNING - Sleep for 5.061387 seconds and try again... (tryings = 33, bot id = 8413666974)
2025-08-30 01:36:29,501 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:29,502 - aiogram.dispatcher - WARNING - Sleep for 4.949834 seconds and try again... (tryings = 34, bot id = 8413666974)
2025-08-30 01:36:34,462 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:34,463 - aiogram.dispatcher - WARNING - Sleep for 5.013758 seconds and try again... (tryings = 35, bot id = 8413666974)
2025-08-30 01:36:39,480 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:39,480 - aiogram.dispatcher - WARNING - Sleep for 5.140250 seconds and try again... (tryings = 36, bot id = 8413666974)
2025-08-30 01:36:44,630 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:44,631 - aiogram.dispatcher - WARNING - Sleep for 4.974439 seconds and try again... (tryings = 37, bot id = 8413666974)
2025-08-30 01:36:49,610 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:49,611 - aiogram.dispatcher - WARNING - Sleep for 5.045162 seconds and try again... (tryings = 38, bot id = 8413666974)
2025-08-30 01:36:54,660 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:54,660 - aiogram.dispatcher - WARNING - Sleep for 4.933739 seconds and try again... (tryings = 39, bot id = 8413666974)
2025-08-30 01:36:59,597 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:36:59,598 - aiogram.dispatcher - WARNING - Sleep for 5.103911 seconds and try again... (tryings = 40, bot id = 8413666974)
2025-08-30 01:37:04,706 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:04,706 - aiogram.dispatcher - WARNING - Sleep for 4.893361 seconds and try again... (tryings = 41, bot id = 8413666974)
2025-08-30 01:37:09,604 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:09,605 - aiogram.dispatcher - WARNING - Sleep for 5.079342 seconds and try again... (tryings = 42, bot id = 8413666974)
2025-08-30 01:37:14,688 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:14,688 - aiogram.dispatcher - WARNING - Sleep for 5.042554 seconds and try again... (tryings = 43, bot id = 8413666974)
2025-08-30 01:37:19,734 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:19,735 - aiogram.dispatcher - WARNING - Sleep for 5.117783 seconds and try again... (tryings = 44, bot id = 8413666974)
2025-08-30 01:37:24,854 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:24,855 - aiogram.dispatcher - WARNING - Sleep for 5.061959 seconds and try again... (tryings = 45, bot id = 8413666974)
2025-08-30 01:37:29,919 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:29,919 - aiogram.dispatcher - WARNING - Sleep for 4.985065 seconds and try again... (tryings = 46, bot id = 8413666974)
2025-08-30 01:37:34,907 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Network is unreachable]
2025-08-30 01:37:34,908 - aiogram.dispatcher - WARNING - Sleep for 5.197064 seconds and try again... (tryings = 47, bot id = 8413666974)
2025-08-30 01:37:50,489 - aiogram.dispatcher - INFO - Connection established (tryings = 48, bot id = 8413666974)
2025-08-30 01:56:23,357 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-30 01:56:23,360 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 01:56:34,682 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 02:12:14,497 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 02:12:14,516 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 02:12:14,516 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 02:12:14,790 - __main__ - INFO - Работа бота завершена
2025-08-30 02:12:17,662 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 02:12:17,665 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:12:17,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 02:12:17,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 02:12:17,666 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 02:12:17,666 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 02:12:17,666 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:12:17,667 - __main__ - INFO - База данных инициализирована
2025-08-30 02:12:17,684 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 02:12:17,684 - __main__ - INFO - Запуск polling...
2025-08-30 02:12:17,684 - aiogram.dispatcher - INFO - Start polling
2025-08-30 02:12:17,977 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 02:12:36,622 - __main__ - INFO - FSM State Change: None
2025-08-30 02:12:36,630 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:12:36,635 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:12:36,635 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (37996964,)
2025-08-30 02:12:36,931 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:12:36,931 - aiogram.event - INFO - Update id=954948717 is handled. Duration 495 ms by bot id=8413666974
2025-08-30 02:12:49,861 - __main__ - INFO - FSM State Change: None
2025-08-30 02:12:49,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:12:49,863 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:12:49,871 - sqlalchemy.engine.Engine - INFO - [cached since 13.24s ago] (37996964,)
2025-08-30 02:12:49,882 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-30 02:12:49,882 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (1, 0)
2025-08-30 02:12:49,982 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:12:49,983 - aiogram.event - INFO - Update id=954948718 is handled. Duration 122 ms by bot id=8413666974
2025-08-30 02:12:55,925 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:12:56,038 - aiogram.event - INFO - Update id=954948719 is handled. Duration 117 ms by bot id=8413666974
2025-08-30 02:12:58,552 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:12:58,554 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-30 02:12:58,655 - root - INFO - Состояние установлено: waiting_media
2025-08-30 02:12:58,655 - aiogram.event - INFO - Update id=954948720 is handled. Duration 103 ms by bot id=8413666974
2025-08-30 02:14:20,420 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,421 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,422 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,425 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,426 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,430 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:20,710 - aiogram.event - INFO - Update id=954948721 is handled. Duration 327 ms by bot id=8413666974
2025-08-30 02:14:20,845 - aiogram.event - INFO - Update id=954948725 is handled. Duration 458 ms by bot id=8413666974
2025-08-30 02:14:20,864 - aiogram.event - INFO - Update id=954948726 is handled. Duration 477 ms by bot id=8413666974
2025-08-30 02:14:20,884 - aiogram.event - INFO - Update id=954948722 is handled. Duration 498 ms by bot id=8413666974
2025-08-30 02:14:20,897 - aiogram.event - INFO - Update id=954948724 is handled. Duration 510 ms by bot id=8413666974
2025-08-30 02:14:20,922 - aiogram.event - INFO - Update id=954948723 is handled. Duration 536 ms by bot id=8413666974
2025-08-30 02:14:38,887 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:14:39,082 - aiogram.event - INFO - Update id=954948727 is handled. Duration 195 ms by bot id=8413666974
2025-08-30 02:14:45,115 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-30 02:14:45,216 - aiogram.event - INFO - Update id=954948728 is handled. Duration 117 ms by bot id=8413666974
2025-08-30 02:14:47,499 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-30 02:14:47,603 - aiogram.event - INFO - Update id=954948729 is handled. Duration 105 ms by bot id=8413666974
2025-08-30 02:14:52,161 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-30 02:14:52,303 - aiogram.event - INFO - Update id=954948730 is handled. Duration 142 ms by bot id=8413666974
2025-08-30 02:14:54,377 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-30 02:14:54,379 - root - INFO - Начинаем загрузку медиа для букета 0201
2025-08-30 02:14:54,379 - root - INFO - Начинаем загрузку 1 медиафайлов для букета 0201
2025-08-30 02:14:54,379 - root - INFO - Обрабатываем медиа 1/1: BQACAgIAAxkBAAICHmiyNExTdlqb5VuNzJOCysmER_5vAAL_hwACsnqRSdPAG6WhmpoLNgQ
2025-08-30 02:14:54,379 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAICHmiyNExTdlqb5VuNzJOCysmER_5vAAL_hwACsnqRSdPAG6WhmpoLNgQ для букета 0201
2025-08-30 02:14:54,844 - root - INFO - Файл получен из Telegram: documents/file_22.jpeg
2025-08-30 02:14:54,844 - root - INFO - Генерируем имя объекта: bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg
2025-08-30 02:14:56,979 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-30 02:14:56,979 - root - INFO - Загрузка файла bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg, размер: 2182321 байт
2025-08-30 02:14:58,008 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-30 02:14:58,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:14:58,010 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:14:58,010 - sqlalchemy.engine.Engine - INFO - [cached since 141.4s ago] (37996964,)
2025-08-30 02:14:58,014 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-30 02:14:58,015 - sqlalchemy.engine.Engine - INFO - [generated in 0.00028s] (1, 10, 0)
2025-08-30 02:14:58,123 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:14:58,123 - aiogram.event - INFO - Update id=954948732 is handled. Duration 125 ms by bot id=8413666974
2025-08-30 02:14:59,526 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg
2025-08-30 02:14:59,527 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg
2025-08-30 02:14:59,528 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg
2025-08-30 02:14:59,528 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg']
2025-08-30 02:14:59,529 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:14:59,533 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-30 02:14:59,533 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('0201', 1, 'вававв', 'вававв №0201', '["https://foto-cat.storage.yandexcloud.net/bouquets/0201/dd8d37b32bf8492f9d8f9457e481e2ea.jpeg"]', None, 'ропимрпмпрмпр', 'null', 200000, 'RUB')
2025-08-30 02:14:59,537 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:14:59,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:14:59,541 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-30 02:14:59,541 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1,)
2025-08-30 02:14:59,641 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:14:59,642 - aiogram.event - INFO - Update id=954948731 is handled. Duration 5266 ms by bot id=8413666974
2025-08-30 02:15:02,383 - __main__ - INFO - FSM State Change: None
2025-08-30 02:15:02,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:15:02,384 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:15:02,388 - sqlalchemy.engine.Engine - INFO - [cached since 145.8s ago] (37996964,)
2025-08-30 02:15:02,392 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-30 02:15:02,398 - sqlalchemy.engine.Engine - INFO - [cached since 4.384s ago] (1, 10, 0)
2025-08-30 02:15:02,496 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:15:02,497 - aiogram.event - INFO - Update id=954948733 is handled. Duration 114 ms by bot id=8413666974
2025-08-30 02:15:05,084 - __main__ - INFO - FSM State Change: None
2025-08-30 02:15:05,086 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:15:05,087 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:15:05,088 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] ('0201',)
2025-08-30 02:15:06,307 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:15:06,310 - aiogram.event - INFO - Update id=954948734 is handled. Duration 1227 ms by bot id=8413666974
2025-08-30 02:15:08,305 - __main__ - INFO - FSM State Change: None
2025-08-30 02:15:08,307 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:15:08,307 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:15:08,307 - sqlalchemy.engine.Engine - INFO - [cached since 3.22s ago] ('0201',)
2025-08-30 02:15:08,465 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:15:08,466 - aiogram.event - INFO - Update id=954948735 is handled. Duration 163 ms by bot id=8413666974
2025-08-30 02:15:51,110 - __main__ - INFO - FSM State Change: None
2025-08-30 02:15:51,122 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:15:51,124 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:15:51,124 - sqlalchemy.engine.Engine - INFO - [cached since 194.5s ago] (37996964,)
2025-08-30 02:15:51,140 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-30 02:15:51,140 - sqlalchemy.engine.Engine - INFO - [cached since 181.3s ago] (1, 0)
2025-08-30 02:15:51,254 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:15:51,255 - aiogram.event - INFO - Update id=954948736 is handled. Duration 174 ms by bot id=8413666974
2025-08-30 02:15:55,738 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:15:55,846 - aiogram.event - INFO - Update id=954948737 is handled. Duration 108 ms by bot id=8413666974
2025-08-30 02:15:57,668 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:15:57,670 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-30 02:15:57,770 - root - INFO - Состояние установлено: waiting_media
2025-08-30 02:15:57,770 - aiogram.event - INFO - Update id=954948738 is handled. Duration 102 ms by bot id=8413666974
2025-08-30 02:16:16,601 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:16:16,603 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:16:16,604 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:16:16,624 - aiogram.event - INFO - Update id=954948741 is handled. Duration 24 ms by bot id=8413666974
2025-08-30 02:16:16,625 - aiogram.event - INFO - Update id=954948740 is handled. Duration 25 ms by bot id=8413666974
2025-08-30 02:16:16,625 - aiogram.event - INFO - Update id=954948739 is handled. Duration 27 ms by bot id=8413666974
2025-08-30 02:16:30,592 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:16:30,792 - aiogram.event - INFO - Update id=954948742 is handled. Duration 201 ms by bot id=8413666974
2025-08-30 02:16:36,318 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-30 02:16:36,447 - aiogram.event - INFO - Update id=954948743 is handled. Duration 130 ms by bot id=8413666974
2025-08-30 02:16:40,894 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-30 02:16:41,007 - aiogram.event - INFO - Update id=954948744 is handled. Duration 114 ms by bot id=8413666974
2025-08-30 02:16:46,040 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-30 02:16:46,153 - aiogram.event - INFO - Update id=954948745 is handled. Duration 113 ms by bot id=8413666974
2025-08-30 02:16:52,117 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-30 02:16:52,118 - root - INFO - Начинаем загрузку медиа для букета 0202
2025-08-30 02:16:52,118 - root - INFO - Начинаем загрузку 3 медиафайлов для букета 0202
2025-08-30 02:16:52,118 - root - INFO - Обрабатываем медиа 1/3: AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ
2025-08-30 02:16:52,118 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ для букета 0202
2025-08-30 02:16:52,599 - root - INFO - Файл получен из Telegram: photos/file_23.jpg
2025-08-30 02:16:52,599 - root - INFO - Генерируем имя объекта: bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg
2025-08-30 02:16:53,151 - root - INFO - Загрузка файла bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg, размер: 90801 байт
2025-08-30 02:16:53,577 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg
2025-08-30 02:16:53,578 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg
2025-08-30 02:16:53,578 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg
2025-08-30 02:16:53,578 - root - INFO - Обрабатываем медиа 2/3: AgACAgIAAxkBAAICPWiyNMBt7GsgYBzne4DfoCBXOUlmAAL5-jEbsnqRSW16m92M3roZAQADAgADeQADNgQ
2025-08-30 02:16:53,578 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAICPWiyNMBt7GsgYBzne4DfoCBXOUlmAAL5-jEbsnqRSW16m92M3roZAQADAgADeQADNgQ для букета 0202
2025-08-30 02:16:53,667 - root - INFO - Файл получен из Telegram: photos/file_24.jpg
2025-08-30 02:16:53,668 - root - INFO - Генерируем имя объекта: bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg
2025-08-30 02:16:54,217 - root - INFO - Загрузка файла bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg, размер: 89982 байт
2025-08-30 02:16:54,480 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg
2025-08-30 02:16:54,481 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg
2025-08-30 02:16:54,481 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg
2025-08-30 02:16:54,481 - root - INFO - Обрабатываем медиа 3/3: AgACAgIAAxkBAAICPGiyNMDwSbIbuxrQgQxBaoqZBdSTAAL4-jEbsnqRSYkGmKftfl83AQADAgADeQADNgQ
2025-08-30 02:16:54,481 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAICPGiyNMDwSbIbuxrQgQxBaoqZBdSTAAL4-jEbsnqRSYkGmKftfl83AQADAgADeQADNgQ для букета 0202
2025-08-30 02:16:54,570 - root - INFO - Файл получен из Telegram: photos/file_25.jpg
2025-08-30 02:16:54,570 - root - INFO - Генерируем имя объекта: bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg
2025-08-30 02:16:55,047 - root - INFO - Загрузка файла bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg, размер: 83400 байт
2025-08-30 02:16:55,259 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg
2025-08-30 02:16:55,260 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg
2025-08-30 02:16:55,260 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg
2025-08-30 02:16:55,260 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg']
2025-08-30 02:16:55,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:16:55,266 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-30 02:16:55,266 - sqlalchemy.engine.Engine - INFO - [cached since 115.7s ago] ('0202', 1, 'ормрпомрпсмр', 'ормрпомрпсмр №0202', '["https://foto-cat.storage.yandexcloud.net/bouquets/0202/4b369b504c75460a921a3f6d143d4347.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0202/bd94771b72fe40c7aab21e09bcd72239.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0202/166a5080e2f242c0a5bccb02a3c57093.jpg"]', None, 'hgvghvgvhgvhgv', 'null', 300000, 'RUB')
2025-08-30 02:16:55,270 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:16:55,274 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:16:55,274 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-30 02:16:55,274 - sqlalchemy.engine.Engine - INFO - [cached since 115.7s ago] (2,)
2025-08-30 02:16:55,374 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:16:55,375 - aiogram.event - INFO - Update id=954948746 is handled. Duration 3259 ms by bot id=8413666974
2025-08-30 02:17:02,101 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:02,103 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:02,103 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:17:02,103 - sqlalchemy.engine.Engine - INFO - [cached since 265.5s ago] (37996964,)
2025-08-30 02:17:02,105 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-30 02:17:02,105 - sqlalchemy.engine.Engine - INFO - [cached since 124.1s ago] (1, 10, 0)
2025-08-30 02:17:02,201 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:02,202 - aiogram.event - INFO - Update id=954948747 is handled. Duration 102 ms by bot id=8413666974
2025-08-30 02:17:05,582 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:05,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:05,584 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:17:05,584 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] ('0201',)
2025-08-30 02:17:05,688 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:05,689 - aiogram.event - INFO - Update id=954948748 is handled. Duration 108 ms by bot id=8413666974
2025-08-30 02:17:08,236 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:08,239 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:08,240 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:17:08,240 - sqlalchemy.engine.Engine - INFO - [cached since 123.2s ago] ('0201',)
2025-08-30 02:17:08,344 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:08,346 - aiogram.event - INFO - Update id=954948749 is handled. Duration 110 ms by bot id=8413666974
2025-08-30 02:17:09,955 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:10,057 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-08-30 02:17:10,149 - aiogram.event - INFO - Update id=954948750 is handled. Duration 200 ms by bot id=8413666974
2025-08-30 02:17:16,236 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:16,255 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:16,259 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:17:16,259 - sqlalchemy.engine.Engine - INFO - [cached since 131.2s ago] ('0201',)
2025-08-30 02:17:16,263 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:17:16,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:16,264 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-30 02:17:16,264 - sqlalchemy.engine.Engine - INFO - [cached since 136.7s ago] (1,)
2025-08-30 02:17:16,368 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:16,369 - aiogram.event - INFO - Update id=954948751 is handled. Duration 135 ms by bot id=8413666974
2025-08-30 02:17:22,483 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:22,484 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:22,484 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:17:22,485 - sqlalchemy.engine.Engine - INFO - [cached since 285.9s ago] (37996964,)
2025-08-30 02:17:22,486 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-08-30 02:17:22,486 - sqlalchemy.engine.Engine - INFO - [cached since 144.5s ago] (1, 10, 0)
2025-08-30 02:17:22,584 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:22,585 - aiogram.event - INFO - Update id=954948752 is handled. Duration 102 ms by bot id=8413666974
2025-08-30 02:17:24,684 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:24,687 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:24,687 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:17:24,687 - sqlalchemy.engine.Engine - INFO - [cached since 139.6s ago] ('0202',)
2025-08-30 02:17:25,466 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:25,467 - aiogram.event - INFO - Update id=954948753 is handled. Duration 784 ms by bot id=8413666974
2025-08-30 02:17:27,806 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:27,809 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:17:27,809 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-08-30 02:17:27,809 - sqlalchemy.engine.Engine - INFO - [cached since 142.7s ago] ('0202',)
2025-08-30 02:17:27,911 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:17:27,912 - aiogram.event - INFO - Update id=954948754 is handled. Duration 106 ms by bot id=8413666974
2025-08-30 02:17:29,187 - __main__ - INFO - FSM State Change: None
2025-08-30 02:17:29,288 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-08-30 02:17:29,373 - aiogram.event - INFO - Update id=954948755 is handled. Duration 187 ms by bot id=8413666974
2025-08-30 02:26:24,990 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 02:26:24,993 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 02:26:24,993 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 02:26:25,260 - __main__ - INFO - Работа бота завершена
2025-08-30 02:30:08,906 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 02:30:08,910 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:30:08,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 02:30:08,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 02:30:08,910 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 02:30:08,910 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 02:30:08,911 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:30:08,911 - __main__ - INFO - База данных инициализирована
2025-08-30 02:30:08,928 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 02:30:08,928 - __main__ - INFO - Запуск polling...
2025-08-30 02:30:08,928 - aiogram.dispatcher - INFO - Start polling
2025-08-30 02:30:09,189 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 02:49:52,690 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-08-30 02:49:52,693 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 02:50:04,329 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 02:53:48,309 - __main__ - INFO - FSM State Change: None
2025-08-30 02:53:48,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:53:48,328 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:53:48,328 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (37996964,)
2025-08-30 02:53:49,202 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:53:49,202 - aiogram.event - INFO - Update id=954948756 is handled. Duration 1011 ms by bot id=8413666974
2025-08-30 02:53:50,845 - __main__ - INFO - FSM State Change: None
2025-08-30 02:53:50,858 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:53:50,858 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 02:53:50,858 - sqlalchemy.engine.Engine - INFO - [cached since 2.53s ago] (37996964,)
2025-08-30 02:53:50,861 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-30 02:53:50,861 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1, 0)
2025-08-30 02:53:50,975 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:53:50,975 - aiogram.event - INFO - Update id=954948757 is handled. Duration 131 ms by bot id=8413666974
2025-08-30 02:53:53,207 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:53:53,324 - aiogram.event - INFO - Update id=954948758 is handled. Duration 118 ms by bot id=8413666974
2025-08-30 02:53:57,576 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 02:53:57,578 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-08-30 02:53:57,725 - root - INFO - Состояние установлено: waiting_media
2025-08-30 02:53:57,725 - aiogram.event - INFO - Update id=954948759 is handled. Duration 171 ms by bot id=8413666974
2025-08-30 02:53:59,464 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:53:59,574 - aiogram.event - INFO - Update id=954948760 is handled. Duration 110 ms by bot id=8413666974
2025-08-30 02:54:13,602 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:54:13,603 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:54:13,604 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:54:13,607 - aiogram.event - INFO - Update id=954948762 is handled. Duration 64 ms by bot id=8413666974
2025-08-30 02:54:13,607 - aiogram.event - INFO - Update id=954948763 is handled. Duration 63 ms by bot id=8413666974
2025-08-30 02:54:13,607 - aiogram.event - INFO - Update id=954948761 is handled. Duration 67 ms by bot id=8413666974
2025-08-30 02:54:20,035 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-08-30 02:54:20,316 - aiogram.event - INFO - Update id=954948764 is handled. Duration 286 ms by bot id=8413666974
2025-08-30 02:54:28,228 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-08-30 02:54:28,374 - aiogram.event - INFO - Update id=954948765 is handled. Duration 146 ms by bot id=8413666974
2025-08-30 02:54:30,427 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-08-30 02:54:30,534 - aiogram.event - INFO - Update id=954948766 is handled. Duration 108 ms by bot id=8413666974
2025-08-30 02:54:34,503 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-08-30 02:54:34,621 - aiogram.event - INFO - Update id=954948767 is handled. Duration 118 ms by bot id=8413666974
2025-08-30 02:54:37,006 - __main__ - INFO - FSM State Change: BouquetStates:preview
2025-08-30 02:54:37,008 - root - INFO - Начинаем загрузку медиа для букета 0203
2025-08-30 02:54:37,008 - root - INFO - Начинаем загрузку 3 медиафайлов для букета 0203
2025-08-30 02:54:37,008 - root - INFO - Обрабатываем медиа 1/3: AgACAgIAAxkBAAICPWiyNMBt7GsgYBzne4DfoCBXOUlmAAL5-jEbsnqRSW16m92M3roZAQADAgADeQADNgQ
2025-08-30 02:54:37,009 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAICPWiyNMBt7GsgYBzne4DfoCBXOUlmAAL5-jEbsnqRSW16m92M3roZAQADAgADeQADNgQ для букета 0203
2025-08-30 02:54:37,101 - root - INFO - Файл получен из Telegram: photos/file_24.jpg
2025-08-30 02:54:37,101 - root - INFO - Генерируем имя объекта: bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg
2025-08-30 02:54:38,490 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-08-30 02:54:38,490 - root - INFO - Загрузка файла bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg, размер: 89982 байт
2025-08-30 02:54:39,007 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg
2025-08-30 02:54:39,008 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg
2025-08-30 02:54:39,008 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg
2025-08-30 02:54:39,008 - root - INFO - Обрабатываем медиа 2/3: AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ
2025-08-30 02:54:39,008 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAIB4WiwpGf__s7eUv5xMONWOt1Ea9vzAAKW_jEb8p-AScOQYgGvR0X8AQADAgADeQADNgQ для букета 0203
2025-08-30 02:54:39,104 - root - INFO - Файл получен из Telegram: photos/file_23.jpg
2025-08-30 02:54:39,105 - root - INFO - Генерируем имя объекта: bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg
2025-08-30 02:54:39,354 - root - INFO - Загрузка файла bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg, размер: 90801 байт
2025-08-30 02:54:39,820 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg
2025-08-30 02:54:39,821 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg
2025-08-30 02:54:39,821 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg
2025-08-30 02:54:39,821 - root - INFO - Обрабатываем медиа 3/3: AgACAgIAAxkBAAICPGiyNMDwSbIbuxrQgQxBaoqZBdSTAAL4-jEbsnqRSYkGmKftfl83AQADAgADeQADNgQ
2025-08-30 02:54:39,821 - root - INFO - Начинаем загрузку фото AgACAgIAAxkBAAICPGiyNMDwSbIbuxrQgQxBaoqZBdSTAAL4-jEbsnqRSYkGmKftfl83AQADAgADeQADNgQ для букета 0203
2025-08-30 02:54:39,924 - root - INFO - Файл получен из Telegram: photos/file_25.jpg
2025-08-30 02:54:39,925 - root - INFO - Генерируем имя объекта: bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg
2025-08-30 02:54:40,183 - root - INFO - Загрузка файла bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg, размер: 83400 байт
2025-08-30 02:54:40,613 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg
2025-08-30 02:54:40,613 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg
2025-08-30 02:54:40,613 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg
2025-08-30 02:54:40,613 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg']
2025-08-30 02:54:40,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:54:40,618 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-08-30 02:54:40,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('0203', 1, 'nи ти ти', 'nи ти ти №0203', '["https://foto-cat.storage.yandexcloud.net/bouquets/0203/33877ce4878f4e2ca03fb968d0eab674.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0203/f202eb30497c42e1b4b172e62a60e9bc.jpg", "https://foto-cat.storage.yandexcloud.net/bouquets/0203/ec63fd8de90541adb5fbcfb4eabea54e.jpg"]', None, 'лтотолтлто', 'null', 9000900, 'RUB')
2025-08-30 02:54:40,623 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 02:54:40,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 02:54:40,627 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-08-30 02:54:40,627 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (3,)
2025-08-30 02:54:40,764 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 02:54:40,765 - aiogram.event - INFO - Update id=954948768 is handled. Duration 3760 ms by bot id=8413666974
2025-08-30 02:57:36,115 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 02:57:36,116 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 02:57:48,005 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 03:24:41,267 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 03:24:41,502 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 03:24:53,158 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 03:26:35,039 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 03:26:35,054 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 03:26:35,055 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 03:26:35,324 - __main__ - INFO - Работа бота завершена
2025-08-30 03:26:45,568 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 03:26:45,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 03:26:45,572 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 03:26:45,572 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 03:26:45,573 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 03:26:45,573 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 03:26:45,573 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 03:26:45,573 - __main__ - INFO - База данных инициализирована
2025-08-30 03:26:45,591 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 03:26:45,591 - __main__ - INFO - Запуск polling...
2025-08-30 03:26:45,591 - aiogram.dispatcher - INFO - Start polling
2025-08-30 03:26:46,301 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 03:27:05,697 - __main__ - INFO - FSM State Change: None
2025-08-30 03:27:05,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 03:27:05,708 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 03:27:05,708 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (37996964,)
2025-08-30 03:27:05,710 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-08-30 03:27:05,710 - sqlalchemy.engine.Engine - INFO - [generated in 0.00017s] (1, 0)
2025-08-30 03:27:06,425 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 03:27:06,426 - aiogram.event - INFO - Update id=954948769 is handled. Duration 764 ms by bot id=8413666974
2025-08-30 03:27:23,807 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:24,005 - aiogram.event - INFO - Update id=954948770 is handled. Duration 199 ms by bot id=8413666974
2025-08-30 03:27:24,098 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:24,280 - aiogram.event - INFO - Update id=954948771 is handled. Duration 182 ms by bot id=8413666974
2025-08-30 03:27:27,937 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:27,939 - aiogram.event - INFO - Update id=954948772 is handled. Duration 3 ms by bot id=8413666974
2025-08-30 03:27:45,639 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:45,758 - aiogram.event - INFO - Update id=954948773 is handled. Duration 120 ms by bot id=8413666974
2025-08-30 03:27:45,909 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:46,027 - aiogram.event - INFO - Update id=954948774 is handled. Duration 119 ms by bot id=8413666974
2025-08-30 03:27:47,403 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:47,404 - aiogram.event - INFO - Update id=954948775 is handled. Duration 2 ms by bot id=8413666974
2025-08-30 03:27:59,851 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 03:27:59,999 - aiogram.event - INFO - Update id=954948776 is handled. Duration 151 ms by bot id=8413666974
2025-08-30 03:44:55,134 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 03:44:55,137 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 03:45:06,900 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 04:02:27,209 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 04:02:27,289 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 04:19:51,232 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 04:19:51,314 - aiogram.dispatcher - WARNING - Sleep for 1.260859 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 04:35:55,210 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 04:35:55,296 - aiogram.dispatcher - WARNING - Sleep for 1.641949 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-30 04:52:14,187 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 04:52:14,271 - aiogram.dispatcher - WARNING - Sleep for 2.258527 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-30 05:10:15,161 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 05:10:15,245 - aiogram.dispatcher - WARNING - Sleep for 3.066640 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-30 05:26:06,134 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 05:26:06,134 - aiogram.dispatcher - WARNING - Sleep for 4.054256 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-30 05:38:05,491 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 05:38:05,580 - aiogram.dispatcher - WARNING - Sleep for 4.947860 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-08-30 05:53:33,003 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 05:53:33,097 - aiogram.dispatcher - WARNING - Sleep for 5.003278 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-08-30 06:11:13,052 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-30 06:11:13,055 - aiogram.dispatcher - WARNING - Sleep for 5.009901 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-08-30 06:26:34,939 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 06:26:35,027 - aiogram.dispatcher - WARNING - Sleep for 4.976660 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-08-30 06:42:21,817 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 06:42:21,906 - aiogram.dispatcher - WARNING - Sleep for 4.960838 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-08-30 06:59:33,777 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 06:59:33,859 - aiogram.dispatcher - WARNING - Sleep for 5.004232 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-08-30 07:16:11,806 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-30 07:16:11,807 - aiogram.dispatcher - WARNING - Sleep for 5.046417 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-08-30 07:26:13,969 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 07:26:13,970 - aiogram.dispatcher - WARNING - Sleep for 5.271324 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-08-30 07:42:14,295 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 07:42:14,376 - aiogram.dispatcher - WARNING - Sleep for 4.933798 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-08-30 07:59:21,806 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 07:59:21,884 - aiogram.dispatcher - WARNING - Sleep for 5.172480 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-08-30 08:03:00,709 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-08-30 08:03:00,792 - aiogram.dispatcher - WARNING - Sleep for 4.939233 seconds and try again... (tryings = 16, bot id = 8413666974)
2025-08-30 08:03:54,027 - aiogram.dispatcher - INFO - Connection established (tryings = 17, bot id = 8413666974)
2025-08-30 08:20:44,853 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 08:20:44,854 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 08:38:00,828 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 08:38:00,914 - aiogram.dispatcher - WARNING - Sleep for 1.363409 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 08:55:33,810 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 08:55:33,893 - aiogram.dispatcher - WARNING - Sleep for 1.982286 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-30 09:13:22,791 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 09:13:22,791 - aiogram.dispatcher - WARNING - Sleep for 2.574861 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-30 09:30:54,702 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 09:30:54,785 - aiogram.dispatcher - WARNING - Sleep for 3.428537 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-30 09:31:08,871 - aiogram.dispatcher - INFO - Connection established (tryings = 5, bot id = 8413666974)
2025-08-30 09:32:30,018 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 09:32:30,023 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 09:32:30,023 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 09:32:30,283 - __main__ - INFO - Работа бота завершена
2025-08-30 09:32:33,669 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 09:32:33,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 09:32:33,673 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 09:32:33,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 09:32:33,673 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 09:32:33,673 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 09:32:33,674 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 09:32:33,674 - __main__ - INFO - База данных инициализирована
2025-08-30 09:32:33,691 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 09:32:33,691 - __main__ - INFO - Запуск polling...
2025-08-30 09:32:33,691 - aiogram.dispatcher - INFO - Start polling
2025-08-30 09:32:34,477 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 09:33:01,946 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 09:33:02,670 - aiogram.event - INFO - Update id=954948777 is handled. Duration 853 ms by bot id=8413666974
2025-08-30 09:33:09,759 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 09:33:09,762 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 09:33:09,762 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 09:33:10,018 - __main__ - INFO - Работа бота завершена
2025-08-30 09:33:15,110 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 09:33:15,111 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 09:33:15,111 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 09:33:15,111 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 09:33:15,112 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 09:33:15,112 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 09:33:15,113 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 09:33:15,113 - __main__ - INFO - База данных инициализирована
2025-08-30 09:33:15,130 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 09:33:15,130 - __main__ - INFO - Запуск polling...
2025-08-30 09:33:15,130 - aiogram.dispatcher - INFO - Start polling
2025-08-30 09:33:15,809 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 09:33:31,492 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 09:33:32,363 - aiogram.event - INFO - Update id=954948778 is handled. Duration 914 ms by bot id=8413666974
2025-08-30 09:49:59,788 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 09:49:59,791 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 09:53:00,212 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 09:53:00,291 - aiogram.dispatcher - WARNING - Sleep for 1.228869 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 09:53:12,527 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-30 10:09:22,543 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 10:09:22,544 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 10:17:15,920 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 10:17:16,005 - aiogram.dispatcher - WARNING - Sleep for 1.354251 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 10:32:56,510 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 10:32:56,510 - aiogram.dispatcher - WARNING - Sleep for 1.769219 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-08-30 10:49:26,488 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 10:49:26,572 - aiogram.dispatcher - WARNING - Sleep for 2.506951 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-08-30 10:56:38,328 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 10:56:38,413 - aiogram.dispatcher - WARNING - Sleep for 3.332241 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-08-30 11:09:45,885 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:09:45,972 - aiogram.dispatcher - WARNING - Sleep for 4.159723 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-08-30 11:10:10,156 - aiogram.dispatcher - INFO - Connection established (tryings = 6, bot id = 8413666974)
2025-08-30 11:28:01,414 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:28:01,498 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 11:32:56,582 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:32:56,666 - aiogram.dispatcher - WARNING - Sleep for 1.242573 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 11:33:08,655 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-30 11:39:25,714 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:39:25,714 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 11:39:37,438 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 11:41:26,982 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 11:41:26,987 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 11:41:26,988 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 11:41:27,251 - __main__ - INFO - Работа бота завершена
2025-08-30 11:45:05,295 - __main__ - INFO - Попытка запуска бота 1/5
2025-08-30 11:45:05,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 11:45:05,299 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-08-30 11:45:05,299 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 11:45:05,299 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-08-30 11:45:05,299 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-08-30 11:45:05,300 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-30 11:45:05,300 - __main__ - INFO - База данных инициализирована
2025-08-30 11:45:05,317 - __main__ - INFO - Бот успешно создан и настроен
2025-08-30 11:45:05,317 - __main__ - INFO - Запуск polling...
2025-08-30 11:45:05,317 - aiogram.dispatcher - INFO - Start polling
2025-08-30 11:45:07,343 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 11:45:07,554 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-08-30 11:45:07,556 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-30 11:45:07,564 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-08-30 11:45:07,564 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (37996964,)
2025-08-30 11:45:08,684 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-30 11:45:08,684 - aiogram.event - INFO - Update id=954948779 is handled. Duration 1138 ms by bot id=8413666974
2025-08-30 11:47:59,015 - __main__ - INFO - FSM State Change: None
2025-08-30 11:47:59,149 - aiogram.event - INFO - Update id=954948780 is handled. Duration 137 ms by bot id=8413666974
2025-08-30 11:48:21,859 - __main__ - INFO - FSM State Change: BouquetStates:waiting_ai_keywords
2025-08-30 11:48:21,974 - root - ERROR - DeepSeek API key not configured
2025-08-30 11:48:22,217 - aiogram.event - INFO - Update id=954948781 is handled. Duration 359 ms by bot id=8413666974
2025-08-30 11:48:30,650 - __main__ - INFO - FSM State Change: BouquetStates:waiting_ai_keywords
2025-08-30 11:48:30,906 - root - ERROR - DeepSeek API key not configured
2025-08-30 11:48:31,358 - aiogram.event - INFO - Update id=954948782 is handled. Duration 710 ms by bot id=8413666974
2025-08-30 11:55:08,010 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:55:08,012 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 11:55:19,948 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-08-30 11:58:54,875 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 11:58:54,945 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-08-30 12:09:07,404 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-08-30 12:09:07,485 - aiogram.dispatcher - WARNING - Sleep for 1.218475 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-08-30 12:09:19,553 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-08-30 12:53:09,609 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-08-30 12:53:09,615 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-08-30 12:53:09,615 - aiogram.dispatcher - INFO - Polling stopped
2025-08-30 12:53:09,876 - __main__ - INFO - Работа бота завершена
2025-09-02 21:50:01,192 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-02 21:50:01,201 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-02 21:50:01,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-02 21:50:01,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-02 21:50:01,202 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-02 21:50:01,202 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-02 21:50:01,203 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-02 21:50:01,203 - __main__ - INFO - База данных инициализирована
2025-09-02 21:50:01,211 - __main__ - INFO - Redis подключен успешно
2025-09-02 21:50:01,228 - __main__ - INFO - Бот успешно создан и настроен
2025-09-02 21:50:01,228 - __main__ - INFO - Запуск polling...
2025-09-02 21:50:01,228 - aiogram.dispatcher - INFO - Start polling
2025-09-02 21:50:01,944 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-02 21:50:17,012 - __main__ - INFO - FSM State Change: BouquetStates:waiting_ai_selection
2025-09-02 21:50:17,021 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-02 21:50:17,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-02 21:50:17,033 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (37996964,)
2025-09-02 21:50:17,740 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-02 21:50:17,741 - aiogram.event - INFO - Update id=954948948 is handled. Duration 838 ms by bot id=8413666974
2025-09-02 22:06:58,187 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-02 22:06:58,190 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-02 22:07:10,002 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-02 22:07:13,997 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-02 22:07:14,000 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-02 22:07:14,000 - aiogram.dispatcher - INFO - Polling stopped
2025-09-02 22:07:14,259 - __main__ - INFO - Работа бота завершена
2025-09-03 08:50:50,550 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 08:50:50,553 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:50:50,553 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 08:50:50,553 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 08:50:50,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,554 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("categories")
2025-09-03 08:50:50,554 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,554 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("products")
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 08:50:50,555 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE categories (
	id INTEGER NOT NULL, 
	name VARCHAR NOT NULL, 
	created_at DATETIME, 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (name)
)


2025-09-03 08:50:50,556 - sqlalchemy.engine.Engine - INFO - [no key 0.00004s] ()
2025-09-03 08:50:50,558 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE products (
	id INTEGER NOT NULL, 
	category_id INTEGER NOT NULL, 
	name VARCHAR NOT NULL, 
	color VARCHAR, 
	product_type VARCHAR, 
	created_at DATETIME, 
	updated_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(category_id) REFERENCES categories (id)
)


2025-09-03 08:50:50,558 - sqlalchemy.engine.Engine - INFO - [no key 0.00006s] ()
2025-09-03 08:50:50,558 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 08:50:50,558 - __main__ - INFO - База данных инициализирована
2025-09-03 08:50:50,587 - __main__ - INFO - Redis подключен успешно
2025-09-03 08:50:50,606 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 08:50:50,606 - __main__ - INFO - Запуск polling...
2025-09-03 08:50:50,607 - aiogram.dispatcher - INFO - Start polling
2025-09-03 08:50:51,426 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 08:51:04,737 - __main__ - INFO - FSM State Change: None
2025-09-03 08:51:04,753 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:51:04,768 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:51:04,769 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (37996964,)
2025-09-03 08:51:05,478 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:51:05,479 - aiogram.event - INFO - Update id=954948949 is handled. Duration 848 ms by bot id=8413666974
2025-09-03 08:51:09,690 - __main__ - INFO - FSM State Change: None
2025-09-03 08:51:09,697 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:51:09,697 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:51:09,698 - sqlalchemy.engine.Engine - INFO - [cached since 4.93s ago] (37996964,)
2025-09-03 08:51:09,704 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-09-03 08:51:09,705 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] (1, 0)
2025-09-03 08:51:10,045 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:51:10,046 - aiogram.event - INFO - Update id=954948950 is handled. Duration 363 ms by bot id=8413666974
2025-09-03 08:51:23,585 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-03 08:51:23,888 - aiogram.event - INFO - Update id=954948951 is handled. Duration 306 ms by bot id=8413666974
2025-09-03 08:51:29,063 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-03 08:51:29,065 - root - INFO - Переход к следующему шагу. Текущее состояние: BouquetStates:waiting_title
2025-09-03 08:51:29,227 - root - INFO - Состояние установлено: waiting_media
2025-09-03 08:51:29,227 - aiogram.event - INFO - Update id=954948952 is handled. Duration 166 ms by bot id=8413666974
2025-09-03 08:53:20,517 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,518 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,521 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,521 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,537 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,537 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:20,540 - aiogram.event - INFO - Update id=954948956 is handled. Duration 68 ms by bot id=8413666974
2025-09-03 08:53:20,540 - aiogram.event - INFO - Update id=954948954 is handled. Duration 69 ms by bot id=8413666974
2025-09-03 08:53:20,540 - aiogram.event - INFO - Update id=954948953 is handled. Duration 70 ms by bot id=8413666974
2025-09-03 08:53:20,540 - aiogram.event - INFO - Update id=954948955 is handled. Duration 69 ms by bot id=8413666974
2025-09-03 08:53:20,542 - aiogram.event - INFO - Update id=954948957 is handled. Duration 70 ms by bot id=8413666974
2025-09-03 08:53:20,542 - aiogram.event - INFO - Update id=954948958 is handled. Duration 70 ms by bot id=8413666974
2025-09-03 08:53:30,081 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 08:53:30,452 - aiogram.event - INFO - Update id=954948959 is handled. Duration 373 ms by bot id=8413666974
2025-09-03 08:53:41,819 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-09-03 08:53:41,994 - aiogram.event - INFO - Update id=954948960 is handled. Duration 175 ms by bot id=8413666974
2025-09-03 08:53:44,859 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-09-03 08:53:44,860 - aiogram.event - INFO - Update id=954948961 is handled. Duration 1 ms by bot id=8413666974
2025-09-03 08:53:55,114 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-09-03 08:53:55,265 - aiogram.event - INFO - Update id=954948962 is handled. Duration 151 ms by bot id=8413666974
2025-09-03 08:54:03,237 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:54:03,440 - root - ERROR - Ошибка в process_price: type object 'BouquetStates' has no attribute 'preview'
2025-09-03 08:54:03,656 - aiogram.event - INFO - Update id=954948963 is handled. Duration 419 ms by bot id=8413666974
2025-09-03 08:54:49,290 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:54:49,296 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:54:49,297 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:54:49,297 - sqlalchemy.engine.Engine - INFO - [cached since 224.5s ago] (37996964,)
2025-09-03 08:54:49,304 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 08:54:49,304 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1, 10, 0)
2025-09-03 08:54:49,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:54:49,472 - aiogram.event - INFO - Update id=954948964 is handled. Duration 184 ms by bot id=8413666974
2025-09-03 08:54:56,419 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:54:56,421 - root - INFO - Начинаем загрузку медиа для букета 0204
2025-09-03 08:54:56,421 - root - INFO - Начинаем загрузку 6 медиафайлов для букета 0204
2025-09-03 08:54:56,421 - root - INFO - Обрабатываем медиа 1/6: BQACAgIAAxkBAAID2Wi319DrYR-p8twDZBCboZudjXHJAAJYdwAClHbASZF5sZHo4cklNgQ
2025-09-03 08:54:56,421 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID2Wi319DrYR-p8twDZBCboZudjXHJAAJYdwAClHbASZF5sZHo4cklNgQ для букета 0204
2025-09-03 08:54:56,973 - root - INFO - Файл получен из Telegram: documents/file_35.jpeg
2025-09-03 08:54:56,974 - root - INFO - Генерируем имя объекта: bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg
2025-09-03 08:55:02,081 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:02,082 - root - INFO - Загрузка файла bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg, размер: 2189763 байт
2025-09-03 08:55:02,107 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:55:02,446 - aiogram.event - INFO - Update id=954948966 is handled. Duration 339 ms by bot id=8413666974
2025-09-03 08:55:03,489 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg
2025-09-03 08:55:03,489 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg
2025-09-03 08:55:03,494 - root - INFO - Медиа 1 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg
2025-09-03 08:55:03,494 - root - INFO - Обрабатываем медиа 2/6: BQACAgIAAxkBAAID12i319BeRs8n6DHsC2FXn7yXTuu5AAJWdwAClHbASe00OGCOwjt6NgQ
2025-09-03 08:55:03,495 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID12i319BeRs8n6DHsC2FXn7yXTuu5AAJWdwAClHbASe00OGCOwjt6NgQ для букета 0204
2025-09-03 08:55:03,973 - root - INFO - Файл получен из Telegram: documents/file_36.jpeg
2025-09-03 08:55:03,973 - root - INFO - Генерируем имя объекта: bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg
2025-09-03 08:55:07,062 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:55:07,070 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:07,070 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:55:07,070 - sqlalchemy.engine.Engine - INFO - [cached since 242.3s ago] (37996964,)
2025-09-03 08:55:07,072 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 08:55:07,072 - sqlalchemy.engine.Engine - INFO - [cached since 17.77s ago] (1, 10, 0)
2025-09-03 08:55:07,735 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:07,736 - aiogram.event - INFO - Update id=954948967 is handled. Duration 674 ms by bot id=8413666974
2025-09-03 08:55:08,380 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:08,380 - root - INFO - Загрузка файла bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg, размер: 2484177 байт
2025-09-03 08:55:09,999 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg
2025-09-03 08:55:09,999 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg
2025-09-03 08:55:10,003 - root - INFO - Медиа 2 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg
2025-09-03 08:55:10,003 - root - INFO - Обрабатываем медиа 3/6: BQACAgIAAxkBAAID1mi319CQPN4_Cxh-o1qu1wABgE9EOgACVXcAApR2wEmV_dwjuOKQxTYE
2025-09-03 08:55:10,003 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID1mi319CQPN4_Cxh-o1qu1wABgE9EOgACVXcAApR2wEmV_dwjuOKQxTYE для букета 0204
2025-09-03 08:55:10,563 - root - INFO - Файл получен из Telegram: documents/file_37.jpeg
2025-09-03 08:55:10,564 - root - INFO - Генерируем имя объекта: bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg
2025-09-03 08:55:13,646 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:13,646 - root - INFO - Загрузка файла bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg, размер: 2029487 байт
2025-09-03 08:55:14,920 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg
2025-09-03 08:55:14,921 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg
2025-09-03 08:55:14,925 - root - INFO - Медиа 3 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg
2025-09-03 08:55:14,925 - root - INFO - Обрабатываем медиа 4/6: BQACAgIAAxkBAAID2Gi319DXezyyTKmZx6vJX60deGQaAAJXdwAClHbASf5Z6wVA_PiyNgQ
2025-09-03 08:55:14,925 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID2Gi319DXezyyTKmZx6vJX60deGQaAAJXdwAClHbASf5Z6wVA_PiyNgQ для букета 0204
2025-09-03 08:55:15,451 - root - INFO - Файл получен из Telegram: documents/file_38.jpeg
2025-09-03 08:55:15,452 - root - INFO - Генерируем имя объекта: bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg
2025-09-03 08:55:18,245 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:18,245 - root - INFO - Загрузка файла bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg, размер: 2182321 байт
2025-09-03 08:55:18,262 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 08:55:18,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:18,266 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:55:18,266 - sqlalchemy.engine.Engine - INFO - [cached since 253.5s ago] (37996964,)
2025-09-03 08:55:18,270 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-09-03 08:55:18,270 - sqlalchemy.engine.Engine - INFO - [cached since 248.6s ago] (1, 0)
2025-09-03 08:55:18,559 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:18,560 - aiogram.event - INFO - Update id=954948968 is handled. Duration 300 ms by bot id=8413666974
2025-09-03 08:55:19,681 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg
2025-09-03 08:55:19,682 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg
2025-09-03 08:55:19,686 - root - INFO - Медиа 4 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg
2025-09-03 08:55:19,686 - root - INFO - Обрабатываем медиа 5/6: BQACAgIAAxkBAAID2mi319DRiZ_MBPi4Oyez2trjn3MgAAJadwAClHbAScAQ4NMoLKCzNgQ
2025-09-03 08:55:19,687 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID2mi319DRiZ_MBPi4Oyez2trjn3MgAAJadwAClHbAScAQ4NMoLKCzNgQ для букета 0204
2025-09-03 08:55:20,215 - root - INFO - Файл получен из Telegram: documents/file_39.jpeg
2025-09-03 08:55:20,215 - root - INFO - Генерируем имя объекта: bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg
2025-09-03 08:55:22,602 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:22,604 - root - INFO - Загрузка файла bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg, размер: 1766160 байт
2025-09-03 08:55:23,829 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg
2025-09-03 08:55:23,829 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg
2025-09-03 08:55:23,833 - root - INFO - Медиа 5 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg
2025-09-03 08:55:23,833 - root - INFO - Обрабатываем медиа 6/6: BQACAgIAAxkBAAID22i319A9gwhlVBIJr57uT8_14iWEAAJcdwAClHbASR_Gn7fEvUP0NgQ
2025-09-03 08:55:23,834 - root - INFO - Начинаем загрузку фото BQACAgIAAxkBAAID22i319A9gwhlVBIJr57uT8_14iWEAAJcdwAClHbASR_Gn7fEvUP0NgQ для букета 0204
2025-09-03 08:55:24,464 - root - INFO - Файл получен из Telegram: documents/file_40.jpeg
2025-09-03 08:55:24,464 - root - INFO - Генерируем имя объекта: bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg
2025-09-03 08:55:29,594 - root - INFO - Yandex Object Storage client успешно инициализирован
2025-09-03 08:55:29,595 - root - INFO - Загрузка файла bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg, размер: 3965885 байт
2025-09-03 08:55:31,506 - root - INFO - Файл успешно загружен: https://foto-cat.storage.yandexcloud.net/bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg
2025-09-03 08:55:31,507 - root - INFO - Фото успешно загружено на сервер: https://foto-cat.storage.yandexcloud.net/bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg
2025-09-03 08:55:31,510 - root - INFO - Медиа 6 успешно загружено: https://foto-cat.storage.yandexcloud.net/bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg
2025-09-03 08:55:31,511 - root - INFO - Итоговый список медиа: ['https://foto-cat.storage.yandexcloud.net/bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/942dfba567614886b698e8ba4dbf84c6.jpeg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/be72ca4c5cb44c30b49d3122a17c2fb7.jpeg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/30f2023f26284d5c9fa057da2b594c25.jpeg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg', 'https://foto-cat.storage.yandexcloud.net/bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg']
2025-09-03 08:55:31,513 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:31,516 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 08:55:31,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('0204', 1, 'Букет из альстромерий', 'Букет из альстромерий №0204', '["https://foto-cat.storage.yandexcloud.net/bouquets/0204/6e320cbb78ba4b67892ebebca3cd51f1.jpeg", "https://foto-cat.storage.yandexcloud.net/bouquets/0 ... (278 characters truncated) ... bouquets/0204/3516b821e51f4f1dbe808905283cc973.jpeg", "https://foto-cat.storage.yandexcloud.net/bouquets/0204/a5edb621448b418d84f1122117c973e6.jpeg"]', None, 'Букет для мамаы', 'null', 200000, 'RUB')
2025-09-03 08:55:31,522 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 08:55:31,525 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:31,527 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-09-03 08:55:31,528 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (4,)
2025-09-03 08:55:31,707 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:31,708 - aiogram.event - INFO - Update id=954948965 is handled. Duration 35290 ms by bot id=8413666974
2025-09-03 08:55:41,479 - __main__ - INFO - FSM State Change: None
2025-09-03 08:55:41,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:41,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:55:41,495 - sqlalchemy.engine.Engine - INFO - [cached since 276.7s ago] (37996964,)
2025-09-03 08:55:41,501 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 08:55:41,501 - sqlalchemy.engine.Engine - INFO - [cached since 52.2s ago] (1, 10, 0)
2025-09-03 08:55:41,669 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:41,670 - aiogram.event - INFO - Update id=954948969 is handled. Duration 194 ms by bot id=8413666974
2025-09-03 08:55:43,922 - __main__ - INFO - FSM State Change: None
2025-09-03 08:55:43,925 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:43,928 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 08:55:43,928 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('0204',)
2025-09-03 08:55:45,368 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:45,369 - aiogram.event - INFO - Update id=954948970 is handled. Duration 1447 ms by bot id=8413666974
2025-09-03 08:55:48,690 - __main__ - INFO - FSM State Change: None
2025-09-03 08:55:48,693 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:48,694 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 08:55:48,694 - sqlalchemy.engine.Engine - INFO - [cached since 4.767s ago] ('0204',)
2025-09-03 08:55:48,851 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:48,852 - aiogram.event - INFO - Update id=954948971 is handled. Duration 163 ms by bot id=8413666974
2025-09-03 08:55:55,460 - __main__ - INFO - FSM State Change: None
2025-09-03 08:55:55,465 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:55,466 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 08:55:55,466 - sqlalchemy.engine.Engine - INFO - [cached since 11.54s ago] ('0204',)
2025-09-03 08:55:55,469 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 08:55:55,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:55:55,471 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-09-03 08:55:55,471 - sqlalchemy.engine.Engine - INFO - [cached since 23.94s ago] (4,)
2025-09-03 08:55:55,637 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:55:55,638 - aiogram.event - INFO - Update id=954948972 is handled. Duration 179 ms by bot id=8413666974
2025-09-03 08:56:45,537 - __main__ - INFO - FSM State Change: None
2025-09-03 08:56:45,559 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 08:56:45,561 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 08:56:45,561 - sqlalchemy.engine.Engine - INFO - [cached since 340.8s ago] (37996964,)
2025-09-03 08:56:45,565 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 08:56:45,565 - sqlalchemy.engine.Engine - INFO - [cached since 116.3s ago] (1, 10, 0)
2025-09-03 08:56:45,715 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 08:56:45,716 - aiogram.event - INFO - Update id=954948973 is handled. Duration 181 ms by bot id=8413666974
2025-09-03 09:04:52,643 - __main__ - INFO - FSM State Change: None
2025-09-03 09:04:52,921 - aiogram.event - INFO - Update id=954948974 is handled. Duration 292 ms by bot id=8413666974
2025-09-03 09:09:49,950 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 09:09:49,957 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 09:09:52,031 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 09:09:52,051 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,052 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,053 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,053 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,054 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,055 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,055 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,056 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,056 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,057 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,058 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,059 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,060 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,062 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,073 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:09:52,076 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 09:09:52,077 - sqlalchemy.engine.Engine - INFO - [generated in 0.00029s] ()
2025-09-03 09:09:52,077 - __main__ - INFO - FSM State Change: None
2025-09-03 09:09:52,090 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:09:52,090 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 09:09:52,090 - sqlalchemy.engine.Engine - INFO - [generated in 0.00013s] ()
2025-09-03 09:09:52,092 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:09:52,092 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 09:09:52,093 - sqlalchemy.engine.Engine - INFO - [cached since 926.7s ago] (37996964,)
2025-09-03 09:09:52,114 - aiogram.event - INFO - Update id=954948987 is not handled. Duration 72 ms by bot id=8413666974
2025-09-03 09:09:52,114 - aiogram.event - ERROR - Cause exception while process update id=954948987 by bot id=8413666974
ModuleNotFoundError: No module named 'openpyxl'
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 26, in handle_settings
    await send_excel_template(callback_query.message)
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/excel_handler.py", line 112, in send_excel_template
    df.to_excel(tmp_file.name, index=False)
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/core/generic.py", line 2436, in to_excel
    formatter.write(
    ~~~~~~~~~~~~~~~^
        excel_writer,
        ^^^^^^^^^^^^^
    ...<6 lines>...
        engine_kwargs=engine_kwargs,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/io/formats/excel.py", line 943, in write
    writer = ExcelWriter(
        writer,
    ...<2 lines>...
        engine_kwargs=engine_kwargs,
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/io/excel/_openpyxl.py", line 57, in __init__
    from openpyxl.workbook import Workbook
ModuleNotFoundError: No module named 'openpyxl'
2025-09-03 09:09:52,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:09:52,127 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 09:09:52,127 - sqlalchemy.engine.Engine - INFO - [cached since 0.05089s ago] ()
2025-09-03 09:09:52,127 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:09:52,127 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 09:09:52,128 - sqlalchemy.engine.Engine - INFO - [cached since 0.03723s ago] ()
2025-09-03 09:09:52,132 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
2025-09-03 09:09:52,134 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
2025-09-03 09:09:53,143 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-09-03 09:09:53,268 - aiogram.event - INFO - Update id=954948983 is handled. Duration 1226 ms by bot id=8413666974
2025-09-03 09:09:53,270 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:09:53,272 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:09:53,275 - aiogram.event - INFO - Update id=954948989 is handled. Duration 1231 ms by bot id=8413666974
2025-09-03 09:09:53,387 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,389 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,391 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:09:53,392 - aiogram.event - INFO - Update id=954948977 is not handled. Duration 1356 ms by bot id=8413666974
2025-09-03 09:09:53,392 - aiogram.event - ERROR - Cause exception while process update id=954948977 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/bouquet_management.py", line 268, in handle_edit_field
    await state.set_state(BouquetStates.editing_media)
                          ^^^^^^^^^^^^^
NameError: name 'BouquetStates' is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/bouquet_management.py", line 322, in handle_edit_field
    await callback.answer("Произошла ошибка при редактировании.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:09:53,409 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,411 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,411 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:09:53,470 - aiogram.event - INFO - Update id=954948975 is not handled. Duration 1436 ms by bot id=8413666974
2025-09-03 09:09:53,470 - aiogram.event - ERROR - Cause exception while process update id=954948975 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 34, in handle_settings
    await callback_query.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,474 - aiogram.event - INFO - Update id=954948988 is not handled. Duration 1431 ms by bot id=8413666974
2025-09-03 09:09:53,474 - aiogram.event - ERROR - Cause exception while process update id=954948988 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 34, in handle_settings
    await callback_query.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,688 - aiogram.event - INFO - Update id=954948978 is not handled. Duration 1652 ms by bot id=8413666974
2025-09-03 09:09:53,689 - aiogram.event - ERROR - Cause exception while process update id=954948978 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,701 - aiogram.event - INFO - Update id=954948981 is not handled. Duration 1658 ms by bot id=8413666974
2025-09-03 09:09:53,701 - aiogram.event - ERROR - Cause exception while process update id=954948981 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,721 - aiogram.event - INFO - Update id=954948976 is not handled. Duration 1686 ms by bot id=8413666974
2025-09-03 09:09:53,721 - aiogram.event - ERROR - Cause exception while process update id=954948976 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 34, in handle_settings
    await callback_query.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,724 - aiogram.event - INFO - Update id=954948980 is not handled. Duration 1682 ms by bot id=8413666974
2025-09-03 09:09:53,724 - aiogram.event - ERROR - Cause exception while process update id=954948980 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,728 - aiogram.event - INFO - Update id=954948985 is not handled. Duration 1685 ms by bot id=8413666974
2025-09-03 09:09:53,728 - aiogram.event - ERROR - Cause exception while process update id=954948985 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 34, in handle_settings
    await callback_query.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,731 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,732 - aiogram.event - INFO - Update id=954948986 is not handled. Duration 1689 ms by bot id=8413666974
2025-09-03 09:09:53,732 - aiogram.event - ERROR - Cause exception while process update id=954948986 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 34, in handle_settings
    await callback_query.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,735 - aiogram.event - INFO - Update id=954948979 is not handled. Duration 1694 ms by bot id=8413666974
2025-09-03 09:09:53,735 - aiogram.event - ERROR - Cause exception while process update id=954948979 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:53,759 - root - ERROR - Ошибка в handle_back_to_menu: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:54,172 - aiogram.event - INFO - Update id=954948984 is not handled. Duration 2129 ms by bot id=8413666974
2025-09-03 09:09:54,173 - aiogram.event - ERROR - Cause exception while process update id=954948984 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:09:54,184 - aiogram.event - INFO - Update id=954948982 is not handled. Duration 2141 ms by bot id=8413666974
2025-09-03 09:09:54,184 - aiogram.event - ERROR - Cause exception while process update id=954948982 by bot id=8413666974
TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 84, in handle_back_to_menu
    await callback.answer()
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/common.py", line 87, in handle_back_to_menu
    await callback.answer("Произошла ошибка при возврате в меню.")
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/methods/base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/client/session/base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-09-03 09:10:20,749 - __main__ - INFO - FSM State Change: BouquetStates:waiting_photo_limit
2025-09-03 09:10:20,755 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:10:20,756 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 09:10:20,757 - sqlalchemy.engine.Engine - INFO - [cached since 955.4s ago] (37996964,)
2025-09-03 09:10:20,909 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:10:20,910 - aiogram.event - INFO - Update id=954948990 is handled. Duration 164 ms by bot id=8413666974
2025-09-03 09:10:49,454 - __main__ - INFO - FSM State Change: None
2025-09-03 09:10:49,624 - aiogram.event - INFO - Update id=954948991 is handled. Duration 198 ms by bot id=8413666974
2025-09-03 09:10:51,184 - __main__ - INFO - FSM State Change: None
2025-09-03 09:10:51,192 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:10:51,193 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 09:10:51,194 - sqlalchemy.engine.Engine - INFO - [cached since 59.18s ago] ()
2025-09-03 09:10:51,382 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:10:51,530 - aiogram.event - INFO - Update id=954948992 is handled. Duration 347 ms by bot id=8413666974
2025-09-03 09:10:55,410 - __main__ - INFO - FSM State Change: None
2025-09-03 09:10:55,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 09:10:55,414 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 09:10:55,414 - sqlalchemy.engine.Engine - INFO - [cached since 63.38s ago] ()
2025-09-03 09:10:55,425 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
2025-09-03 09:10:55,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 09:10:55,793 - aiogram.event - INFO - Update id=954948993 is handled. Duration 383 ms by bot id=8413666974
2025-09-03 09:16:51,180 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 09:16:51,267 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 09:17:03,417 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 09:38:23,954 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 09:38:23,960 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 09:54:43,802 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 09:54:43,803 - aiogram.dispatcher - WARNING - Sleep for 1.275332 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 10:11:52,900 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 10:11:52,966 - aiogram.dispatcher - WARNING - Sleep for 1.591225 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 10:12:05,536 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-09-03 10:42:04,734 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 10:42:04,737 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 10:50:33,024 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 10:50:33,266 - aiogram.dispatcher - WARNING - Sleep for 1.338944 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 10:50:45,739 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-09-03 11:09:26,824 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 11:09:26,825 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 11:25:28,768 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 11:25:28,852 - aiogram.dispatcher - WARNING - Sleep for 1.391265 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 11:36:06,305 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 11:36:06,378 - aiogram.dispatcher - WARNING - Sleep for 1.988240 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 11:36:19,099 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-09-03 11:40:22,972 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 11:40:22,974 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 11:40:34,987 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 11:44:33,656 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 11:44:33,680 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 11:44:33,680 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 11:44:33,960 - __main__ - INFO - Работа бота завершена
2025-09-03 11:56:36,262 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 11:56:36,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 11:56:36,265 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 11:56:36,265 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 11:56:36,266 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 11:56:36,267 - __main__ - INFO - База данных инициализирована
2025-09-03 11:56:36,277 - __main__ - INFO - Redis подключен успешно
2025-09-03 11:56:36,294 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 11:56:36,294 - __main__ - INFO - Запуск polling...
2025-09-03 11:56:36,294 - aiogram.dispatcher - INFO - Start polling
2025-09-03 11:56:37,018 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 11:56:37,167 - __main__ - INFO - FSM State Change: None
2025-09-03 11:56:37,169 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 11:56:37,179 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 11:56:37,179 - sqlalchemy.engine.Engine - INFO - [generated in 0.00022s] (37996964,)
2025-09-03 11:56:38,082 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 11:56:38,083 - aiogram.event - INFO - Update id=954948994 is handled. Duration 919 ms by bot id=8413666974
2025-09-03 11:58:06,709 - __main__ - INFO - FSM State Change: None
2025-09-03 11:58:06,716 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 11:58:06,717 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 11:58:06,718 - sqlalchemy.engine.Engine - INFO - [cached since 89.53s ago] (37996964,)
2025-09-03 11:58:06,725 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 11:58:06,725 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 10, 0)
2025-09-03 11:58:06,988 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 11:58:06,988 - aiogram.event - INFO - Update id=954948995 is handled. Duration 282 ms by bot id=8413666974
2025-09-03 11:58:09,194 - __main__ - INFO - FSM State Change: None
2025-09-03 11:58:09,374 - aiogram.event - INFO - Update id=954948996 is handled. Duration 180 ms by bot id=8413666974
2025-09-03 11:58:12,376 - __main__ - INFO - FSM State Change: None
2025-09-03 11:58:12,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 11:58:12,386 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 11:58:12,386 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ()
2025-09-03 11:58:12,556 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 11:58:12,703 - aiogram.event - INFO - Update id=954948997 is handled. Duration 328 ms by bot id=8413666974
2025-09-03 11:58:15,292 - __main__ - INFO - FSM State Change: None
2025-09-03 11:58:15,295 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 11:58:15,297 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 11:58:15,297 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ()
2025-09-03 11:58:15,322 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
2025-09-03 11:58:15,851 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 11:58:16,304 - aiogram.event - INFO - Update id=954948998 is handled. Duration 1012 ms by bot id=8413666974
2025-09-03 11:58:36,354 - __main__ - INFO - FSM State Change: None
2025-09-03 11:58:36,623 - aiogram.event - INFO - Update id=954948999 is handled. Duration 316 ms by bot id=8413666974
2025-09-03 12:00:27,021 - __main__ - INFO - FSM State Change: None
2025-09-03 12:00:27,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:00:27,034 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 12:00:27,034 - sqlalchemy.engine.Engine - INFO - [cached since 134.7s ago] ()
2025-09-03 12:00:27,332 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:00:27,587 - aiogram.event - INFO - Update id=954949000 is handled. Duration 569 ms by bot id=8413666974
2025-09-03 12:00:31,132 - __main__ - INFO - FSM State Change: None
2025-09-03 12:00:31,135 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:00:31,136 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 12:00:31,136 - sqlalchemy.engine.Engine - INFO - [cached since 138.8s ago] ()
2025-09-03 12:00:31,366 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:00:31,519 - aiogram.event - INFO - Update id=954949001 is handled. Duration 388 ms by bot id=8413666974
2025-09-03 12:00:33,451 - __main__ - INFO - FSM State Change: None
2025-09-03 12:00:33,453 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:00:33,454 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 12:00:33,454 - sqlalchemy.engine.Engine - INFO - [cached since 138.2s ago] ()
2025-09-03 12:00:33,463 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
2025-09-03 12:00:34,116 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:00:34,323 - aiogram.event - INFO - Update id=954949002 is handled. Duration 873 ms by bot id=8413666974
2025-09-03 12:04:15,517 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:15,538 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:15,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 12:04:15,539 - sqlalchemy.engine.Engine - INFO - [cached since 458.4s ago] (37996964,)
2025-09-03 12:04:15,545 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 12:04:15,545 - sqlalchemy.engine.Engine - INFO - [cached since 368.8s ago] (1, 10, 0)
2025-09-03 12:04:15,779 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:04:15,779 - aiogram.event - INFO - Update id=954949003 is handled. Duration 391 ms by bot id=8413666974
2025-09-03 12:04:23,175 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:23,178 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:23,185 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:23,186 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('0203',)
2025-09-03 12:04:24,135 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:04:24,136 - aiogram.event - INFO - Update id=954949004 is handled. Duration 962 ms by bot id=8413666974
2025-09-03 12:04:26,306 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:26,309 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:26,310 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:26,310 - sqlalchemy.engine.Engine - INFO - [cached since 3.125s ago] ('0203',)
2025-09-03 12:04:26,314 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,314 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,314 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,315 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,315 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,315 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:26,315 - root - INFO - Удалено 0 файлов букета 0203
2025-09-03 12:04:26,315 - root - WARNING - Не удалось удалить файлы букета 0203 с сервера
2025-09-03 12:04:26,316 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:26,316 - sqlalchemy.engine.Engine - INFO - [cached since 3.131s ago] ('0203',)
2025-09-03 12:04:26,333 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-09-03 12:04:26,333 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (3,)
2025-09-03 12:04:26,335 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 12:04:26,583 - aiogram.event - INFO - Update id=954949005 is handled. Duration 278 ms by bot id=8413666974
2025-09-03 12:04:29,079 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:29,091 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:29,092 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 12:04:29,092 - sqlalchemy.engine.Engine - INFO - [cached since 471.9s ago] (37996964,)
2025-09-03 12:04:29,094 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 12:04:29,094 - sqlalchemy.engine.Engine - INFO - [cached since 382.4s ago] (1, 10, 0)
2025-09-03 12:04:29,358 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:04:29,359 - aiogram.event - INFO - Update id=954949006 is handled. Duration 285 ms by bot id=8413666974
2025-09-03 12:04:31,261 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:31,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:31,265 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:31,265 - sqlalchemy.engine.Engine - INFO - [cached since 8.08s ago] ('0202',)
2025-09-03 12:04:31,476 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:04:31,478 - aiogram.event - INFO - Update id=954949007 is handled. Duration 217 ms by bot id=8413666974
2025-09-03 12:04:33,173 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:33,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:33,176 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:33,176 - sqlalchemy.engine.Engine - INFO - [cached since 9.991s ago] ('0202',)
2025-09-03 12:04:33,177 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,177 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,177 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,177 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,178 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,178 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:04:33,178 - root - INFO - Удалено 0 файлов букета 0202
2025-09-03 12:04:33,178 - root - WARNING - Не удалось удалить файлы букета 0202 с сервера
2025-09-03 12:04:33,178 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:04:33,178 - sqlalchemy.engine.Engine - INFO - [cached since 9.993s ago] ('0202',)
2025-09-03 12:04:33,180 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-09-03 12:04:33,180 - sqlalchemy.engine.Engine - INFO - [cached since 6.848s ago] (2,)
2025-09-03 12:04:33,182 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 12:04:33,334 - aiogram.event - INFO - Update id=954949008 is handled. Duration 162 ms by bot id=8413666974
2025-09-03 12:04:36,304 - __main__ - INFO - FSM State Change: None
2025-09-03 12:04:36,313 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:04:36,314 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 12:04:36,314 - sqlalchemy.engine.Engine - INFO - [cached since 479.1s ago] (37996964,)
2025-09-03 12:04:36,318 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 12:04:36,318 - sqlalchemy.engine.Engine - INFO - [cached since 389.6s ago] (1, 10, 0)
2025-09-03 12:04:36,489 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:04:36,490 - aiogram.event - INFO - Update id=954949009 is handled. Duration 203 ms by bot id=8413666974
2025-09-03 12:12:38,502 - __main__ - INFO - FSM State Change: None
2025-09-03 12:12:38,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:12:38,513 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:12:38,513 - sqlalchemy.engine.Engine - INFO - [cached since 495.4s ago] ('0201',)
2025-09-03 12:12:38,768 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:12:38,769 - aiogram.event - INFO - Update id=954949010 is handled. Duration 271 ms by bot id=8413666974
2025-09-03 12:12:40,398 - __main__ - INFO - FSM State Change: None
2025-09-03 12:12:40,402 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:12:40,403 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:12:40,403 - sqlalchemy.engine.Engine - INFO - [cached since 497.3s ago] ('0201',)
2025-09-03 12:12:40,405 - root - ERROR - Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:12:40,405 - root - ERROR - Ошибка инициализации Yandex Object Storage: Отсутствуют переменные окружения: YC_ACCESS_KEY_ID, YC_SECRET_ACCESS_KEY
2025-09-03 12:12:40,405 - root - INFO - Удалено 0 файлов букета 0201
2025-09-03 12:12:40,406 - root - WARNING - Не удалось удалить файлы букета 0201 с сервера
2025-09-03 12:12:40,406 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 12:12:40,406 - sqlalchemy.engine.Engine - INFO - [cached since 497.3s ago] ('0201',)
2025-09-03 12:12:40,412 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-09-03 12:12:40,412 - sqlalchemy.engine.Engine - INFO - [cached since 494.1s ago] (1,)
2025-09-03 12:12:40,414 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 12:12:40,677 - aiogram.event - INFO - Update id=954949011 is handled. Duration 280 ms by bot id=8413666974
2025-09-03 12:12:42,975 - __main__ - INFO - FSM State Change: None
2025-09-03 12:12:42,978 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 12:12:42,978 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 12:12:42,979 - sqlalchemy.engine.Engine - INFO - [cached since 965.9s ago] (37996964,)
2025-09-03 12:12:42,981 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 12:12:42,981 - sqlalchemy.engine.Engine - INFO - [cached since 876.3s ago] (1, 10, 0)
2025-09-03 12:12:43,146 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 12:12:43,147 - aiogram.event - INFO - Update id=954949012 is handled. Duration 172 ms by bot id=8413666974
2025-09-03 12:32:35,618 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 12:32:35,624 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 12:32:47,525 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 12:44:55,108 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 12:44:55,154 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 12:45:07,385 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 13:06:06,580 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 13:06:06,582 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 13:21:22,435 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 13:21:22,443 - aiogram.dispatcher - WARNING - Sleep for 1.289396 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 13:37:28,395 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 13:37:28,397 - aiogram.dispatcher - WARNING - Sleep for 1.640733 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 13:44:48,157 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 13:44:48,250 - aiogram.dispatcher - WARNING - Sleep for 2.071958 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-03 13:45:01,221 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 8413666974)
2025-09-03 13:49:44,662 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 13:49:44,664 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 13:49:56,494 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 14:09:50,274 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 14:09:50,286 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 14:10:02,539 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 14:28:13,161 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 14:28:13,163 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 14:45:36,290 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 14:45:36,290 - aiogram.dispatcher - WARNING - Sleep for 1.473539 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 15:03:32,259 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 15:03:32,342 - aiogram.dispatcher - WARNING - Sleep for 1.970751 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 15:12:11,073 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 15:12:11,073 - aiogram.dispatcher - WARNING - Sleep for 2.633250 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-03 15:12:24,647 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 8413666974)
2025-09-03 15:29:13,492 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 15:29:13,619 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 15:29:25,600 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 15:47:50,487 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 15:47:50,497 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 15:48:02,586 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 16:11:26,416 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 16:11:26,417 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 16:14:03,578 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 16:14:03,625 - aiogram.dispatcher - WARNING - Sleep for 1.481503 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 16:14:16,876 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-09-03 16:41:00,084 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 16:41:00,100 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 16:41:12,208 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 16:50:18,720 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 16:50:18,726 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 16:50:30,833 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 16:57:29,003 - __main__ - INFO - FSM State Change: None
2025-09-03 16:57:29,053 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 16:57:29,057 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 16:57:29,058 - sqlalchemy.engine.Engine - INFO - [cached since 5301s ago] (37996964,)
2025-09-03 16:57:29,769 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 16:57:29,773 - aiogram.event - INFO - Update id=954949013 is handled. Duration 928 ms by bot id=8413666974
2025-09-03 16:58:54,287 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 16:58:54,366 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 16:59:06,457 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 17:11:23,145 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 32] Broken pipe
2025-09-03 17:11:23,168 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 17:11:35,424 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 17:49:57,476 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 17:49:57,570 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 17:50:22,673 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 18:27:11,241 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 18:27:11,246 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 18:42:19,099 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 18:42:19,185 - aiogram.dispatcher - WARNING - Sleep for 1.344267 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 18:59:50,172 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-03 18:59:50,173 - aiogram.dispatcher - WARNING - Sleep for 1.803025 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 19:12:37,228 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 19:12:37,233 - aiogram.dispatcher - WARNING - Sleep for 2.455742 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-03 19:12:56,136 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 8413666974)
2025-09-03 19:36:56,941 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 19:36:56,990 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 19:37:08,934 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 19:43:59,267 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 19:43:59,331 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 19:44:11,318 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-03 20:09:53,886 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 20:09:53,891 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 20:16:26,372 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-03 20:16:26,373 - aiogram.dispatcher - WARNING - Sleep for 1.214201 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 20:17:29,617 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-03 20:17:29,620 - aiogram.dispatcher - WARNING - Sleep for 1.562204 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-03 20:42:10,083 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 20:42:10,085 - aiogram.dispatcher - WARNING - Sleep for 2.122723 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-03 20:59:49,968 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 20:59:49,969 - aiogram.dispatcher - WARNING - Sleep for 2.731617 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-09-03 21:15:10,751 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 21:15:10,751 - aiogram.dispatcher - WARNING - Sleep for 3.470838 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-09-03 21:21:44,681 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-03 21:21:44,764 - aiogram.dispatcher - WARNING - Sleep for 4.504646 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-09-03 21:22:04,425 - aiogram.dispatcher - INFO - Connection established (tryings = 7, bot id = 8413666974)
2025-09-03 21:30:01,009 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 21:30:01,010 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-03 21:39:41,436 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-03 21:39:41,572 - aiogram.dispatcher - WARNING - Sleep for 1.300811 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-03 21:39:59,366 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-09-03 21:57:41,150 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 21:57:41,179 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 21:57:41,180 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 21:57:41,468 - __main__ - INFO - Работа бота завершена
2025-09-03 21:57:45,245 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 21:57:45,249 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:57:45,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 21:57:45,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 21:57:45,249 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 21:57:45,249 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 21:57:45,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 21:57:45,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 21:57:45,250 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 21:57:45,250 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 21:57:45,250 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 21:57:45,250 - __main__ - INFO - База данных инициализирована
2025-09-03 21:57:45,262 - __main__ - INFO - Redis подключен успешно
2025-09-03 21:57:45,279 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 21:57:45,279 - __main__ - INFO - Запуск polling...
2025-09-03 21:57:45,280 - aiogram.dispatcher - INFO - Start polling
2025-09-03 21:57:50,600 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 21:57:55,813 - __main__ - INFO - FSM State Change: None
2025-09-03 21:57:55,824 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:57:55,844 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 21:57:55,844 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] (37996964,)
2025-09-03 21:57:57,116 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:57:57,117 - aiogram.event - INFO - Update id=954949014 is handled. Duration 1485 ms by bot id=8413666974
2025-09-03 21:58:00,355 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:00,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:58:00,356 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 21:58:00,356 - sqlalchemy.engine.Engine - INFO - [cached since 4.513s ago] (37996964,)
2025-09-03 21:58:00,359 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 21:58:00,359 - sqlalchemy.engine.Engine - INFO - [generated in 0.00019s] (1, 10, 0)
2025-09-03 21:58:00,602 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:58:00,602 - aiogram.event - INFO - Update id=954949015 is handled. Duration 254 ms by bot id=8413666974
2025-09-03 21:58:02,665 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:02,667 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:58:02,669 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 21:58:02,669 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('0204',)
2025-09-03 21:58:02,880 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:58:02,881 - aiogram.event - INFO - Update id=954949016 is handled. Duration 218 ms by bot id=8413666974
2025-09-03 21:58:07,794 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:07,813 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:58:07,815 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-03 21:58:07,815 - sqlalchemy.engine.Engine - INFO - [cached since 5.146s ago] ('0204',)
2025-09-03 21:58:07,977 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:58:07,978 - aiogram.event - INFO - Update id=954949017 is handled. Duration 188 ms by bot id=8413666974
2025-09-03 21:58:12,533 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:12,694 - root - ERROR - Ошибка в handle_edit_field: name 'BouquetStates' is not defined
2025-09-03 21:58:12,840 - aiogram.event - INFO - Update id=954949018 is handled. Duration 307 ms by bot id=8413666974
2025-09-03 21:58:18,777 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:18,974 - aiogram.event - INFO - Update id=954949019 is handled. Duration 197 ms by bot id=8413666974
2025-09-03 21:58:23,420 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:23,426 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:58:23,431 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 21:58:23,431 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ()
2025-09-03 21:58:23,456 - root - ERROR - Ошибка при экспорте букетов: No module named 'openpyxl'
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/excel_handler.py", line 65, in export_bouquets_to_excel
    df.to_excel(tmp_file.name, index=False, engine="openpyxl")
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/core/generic.py", line 2436, in to_excel
    formatter.write(
    ~~~~~~~~~~~~~~~^
        excel_writer,
        ^^^^^^^^^^^^^
    ...<6 lines>...
        engine_kwargs=engine_kwargs,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/io/formats/excel.py", line 943, in write
    writer = ExcelWriter(
        writer,
    ...<2 lines>...
        engine_kwargs=engine_kwargs,
    )
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/pandas/io/excel/_openpyxl.py", line 57, in __init__
    from openpyxl.workbook import Workbook
ModuleNotFoundError: No module named 'openpyxl'
2025-09-03 21:58:23,653 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:58:23,823 - aiogram.event - INFO - Update id=954949020 is handled. Duration 405 ms by bot id=8413666974
2025-09-03 21:58:28,575 - __main__ - INFO - FSM State Change: None
2025-09-03 21:58:28,579 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 21:58:28,582 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 21:58:28,583 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ()
2025-09-03 21:58:28,757 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 21:58:28,914 - aiogram.event - INFO - Update id=954949021 is handled. Duration 339 ms by bot id=8413666974
2025-09-03 22:03:41,345 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 22:03:41,354 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:03:41,355 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 22:03:41,612 - __main__ - INFO - Работа бота завершена
2025-09-03 22:03:50,643 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 22:03:50,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 22:03:50,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:03:50,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 22:03:50,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:03:50,647 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 22:03:50,647 - __main__ - INFO - База данных инициализирована
2025-09-03 22:03:50,652 - __main__ - INFO - Redis подключен успешно
2025-09-03 22:03:50,669 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 22:03:50,669 - __main__ - INFO - Запуск polling...
2025-09-03 22:03:50,669 - aiogram.dispatcher - INFO - Start polling
2025-09-03 22:03:53,667 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:04:39,626 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 22:04:39,629 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:04:39,629 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 22:04:39,887 - __main__ - INFO - Работа бота завершена
2025-09-03 22:04:54,160 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 22:04:54,162 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:04:54,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 22:04:54,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:04:54,162 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 22:04:54,162 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:04:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 22:04:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:04:54,163 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 22:04:54,163 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:04:54,163 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 22:04:54,163 - __main__ - INFO - База данных инициализирована
2025-09-03 22:04:54,167 - __main__ - INFO - Redis подключен успешно
2025-09-03 22:04:54,185 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 22:04:54,185 - __main__ - INFO - Запуск polling...
2025-09-03 22:04:54,185 - aiogram.dispatcher - INFO - Start polling
2025-09-03 22:04:59,856 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:05:00,020 - __main__ - INFO - FSM State Change: None
2025-09-03 22:05:00,025 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:05:00,040 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 22:05:00,040 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (37996964,)
2025-09-03 22:05:06,173 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:05:06,174 - aiogram.event - INFO - Update id=954949022 is handled. Duration 6165 ms by bot id=8413666974
2025-09-03 22:05:11,726 - __main__ - INFO - FSM State Change: None
2025-09-03 22:05:11,730 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:05:11,731 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 22:05:11,731 - sqlalchemy.engine.Engine - INFO - [cached since 11.69s ago] (37996964,)
2025-09-03 22:05:11,737 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 22:05:11,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (1, 10, 0)
2025-09-03 22:05:11,941 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:05:11,942 - aiogram.event - INFO - Update id=954949023 is handled. Duration 218 ms by bot id=8413666974
2025-09-03 22:05:13,784 - __main__ - INFO - FSM State Change: None
2025-09-03 22:05:13,953 - aiogram.event - INFO - Update id=954949024 is handled. Duration 169 ms by bot id=8413666974
2025-09-03 22:05:15,623 - __main__ - INFO - FSM State Change: None
2025-09-03 22:05:15,626 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:05:15,630 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 22:05:15,631 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-09-03 22:05:15,801 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:05:15,958 - aiogram.event - INFO - Update id=954949025 is handled. Duration 335 ms by bot id=8413666974
2025-09-03 22:05:17,991 - __main__ - INFO - FSM State Change: None
2025-09-03 22:05:17,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:05:17,997 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 22:05:17,997 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ()
2025-09-03 22:05:18,108 - root - ERROR - Ошибка при экспорте букетов: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/excel_handler.py", line 81, in export_bouquets_to_excel
    document=types.InputFile(f, filename="bouquets_export.xlsx"),
             ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-09-03 22:05:18,340 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:05:18,539 - aiogram.event - INFO - Update id=954949026 is handled. Duration 548 ms by bot id=8413666974
2025-09-03 22:15:00,738 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 22:15:00,764 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:15:00,766 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 22:15:01,052 - __main__ - INFO - Работа бота завершена
2025-09-03 22:15:08,395 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 22:15:08,401 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:15:08,401 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 22:15:08,401 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 22:15:08,402 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:15:08,403 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 22:15:08,403 - __main__ - INFO - База данных инициализирована
2025-09-03 22:15:08,428 - __main__ - INFO - Redis подключен успешно
2025-09-03 22:15:08,452 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 22:15:08,452 - __main__ - INFO - Запуск polling...
2025-09-03 22:15:08,452 - aiogram.dispatcher - INFO - Start polling
2025-09-03 22:15:09,975 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:15:25,888 - __main__ - INFO - FSM State Change: None
2025-09-03 22:15:25,901 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:15:25,920 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 22:15:25,920 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] (37996964,)
2025-09-03 22:15:27,747 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:15:27,748 - aiogram.event - INFO - Update id=954949027 is handled. Duration 1969 ms by bot id=8413666974
2025-09-03 22:15:30,364 - __main__ - INFO - FSM State Change: None
2025-09-03 22:15:30,543 - aiogram.event - INFO - Update id=954949028 is handled. Duration 179 ms by bot id=8413666974
2025-09-03 22:15:33,086 - __main__ - INFO - FSM State Change: None
2025-09-03 22:15:33,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:15:33,100 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 22:15:33,100 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ()
2025-09-03 22:15:33,271 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:15:33,419 - aiogram.event - INFO - Update id=954949029 is handled. Duration 335 ms by bot id=8413666974
2025-09-03 22:15:35,209 - __main__ - INFO - FSM State Change: None
2025-09-03 22:15:35,212 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:15:35,215 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets
2025-09-03 22:15:35,215 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ()
2025-09-03 22:15:35,670 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:15:35,948 - aiogram.event - INFO - Update id=954949030 is handled. Duration 740 ms by bot id=8413666974
2025-09-03 22:23:59,438 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 22:23:59,468 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:23:59,471 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 22:23:59,775 - __main__ - INFO - Работа бота завершена
2025-09-03 22:24:07,783 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 22:24:07,789 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:24:07,789 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 22:24:07,789 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:24:07,790 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 22:24:07,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:24:07,790 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 22:24:07,790 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:24:07,791 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 22:24:07,791 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:24:07,791 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 22:24:07,791 - __main__ - INFO - База данных инициализирована
2025-09-03 22:24:07,804 - __main__ - INFO - Redis подключен успешно
2025-09-03 22:24:07,823 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 22:24:07,823 - __main__ - INFO - Запуск polling...
2025-09-03 22:24:07,823 - aiogram.dispatcher - INFO - Start polling
2025-09-03 22:24:09,906 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:24:21,108 - __main__ - INFO - FSM State Change: None
2025-09-03 22:24:21,123 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:24:21,139 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 22:24:21,140 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (37996964,)
2025-09-03 22:24:25,366 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:24:25,367 - aiogram.event - INFO - Update id=954949031 is handled. Duration 4405 ms by bot id=8413666974
2025-09-03 22:24:27,597 - __main__ - INFO - FSM State Change: None
2025-09-03 22:24:27,752 - aiogram.event - INFO - Update id=954949032 is handled. Duration 158 ms by bot id=8413666974
2025-09-03 22:24:35,406 - __main__ - INFO - FSM State Change: None
2025-09-03 22:24:35,522 - aiogram.event - INFO - Update id=954949033 is not handled. Duration 139 ms by bot id=8413666974
2025-09-03 22:24:35,522 - aiogram.event - ERROR - Cause exception while process update id=954949033 by bot id=8413666974
TypeError: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 26, in handle_settings
    await send_excel_template(callback_query.message)
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/product_handler.py", line 27, in send_excel_template
    document=tg_types.InputFile(f, filename="template.xlsx"),
             ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-09-03 22:25:34,683 - __main__ - INFO - FSM State Change: None
2025-09-03 22:25:34,764 - aiogram.event - INFO - Update id=954949034 is not handled. Duration 87 ms by bot id=8413666974
2025-09-03 22:25:34,764 - aiogram.event - ERROR - Cause exception while process update id=954949034 by bot id=8413666974
TypeError: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
Traceback (most recent call last):
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/photo_catalog.py", line 48, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog/.venv/lib/python3.13/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/settings.py", line 26, in handle_settings
    await send_excel_template(callback_query.message)
  File "/Users/darya/PycharmProjects/PythonProject/photo_catalog — 2 часть/handlers/product_handler.py", line 27, in send_excel_template
    document=tg_types.InputFile(f, filename="template.xlsx"),
             ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Can't instantiate abstract class InputFile without an implementation for abstract method 'read'
2025-09-03 22:55:32,377 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 22:55:32,412 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:55:32,415 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 22:55:32,712 - __main__ - INFO - Работа бота завершена
2025-09-03 22:55:36,664 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 22:55:36,668 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:55:36,668 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 22:55:36,668 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:55:36,669 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 22:55:36,669 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:55:36,669 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 22:55:36,669 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:55:36,670 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 22:55:36,670 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 22:55:36,670 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 22:55:36,670 - __main__ - INFO - База данных инициализирована
2025-09-03 22:55:36,690 - __main__ - INFO - Redis подключен успешно
2025-09-03 22:55:36,709 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 22:55:36,709 - __main__ - INFO - Запуск polling...
2025-09-03 22:55:36,709 - aiogram.dispatcher - INFO - Start polling
2025-09-03 22:55:39,396 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 22:56:21,365 - __main__ - INFO - FSM State Change: None
2025-09-03 22:56:21,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 22:56:21,407 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 22:56:21,407 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (37996964,)
2025-09-03 22:56:22,120 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 22:56:22,120 - aiogram.event - INFO - Update id=954949035 is handled. Duration 935 ms by bot id=8413666974
2025-09-03 22:56:24,571 - __main__ - INFO - FSM State Change: None
2025-09-03 22:56:24,731 - aiogram.event - INFO - Update id=954949036 is handled. Duration 163 ms by bot id=8413666974
2025-09-03 22:56:30,679 - __main__ - INFO - FSM State Change: None
2025-09-03 22:56:31,335 - aiogram.event - INFO - Update id=954949037 is handled. Duration 657 ms by bot id=8413666974
2025-09-03 22:57:37,230 - __main__ - INFO - FSM State Change: None
2025-09-03 22:57:37,384 - aiogram.event - INFO - Update id=954949038 is handled. Duration 194 ms by bot id=8413666974
2025-09-03 23:03:33,807 - __main__ - INFO - FSM State Change: None
2025-09-03 23:03:33,865 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:03:33,893 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id
2025-09-03 23:03:33,893 - sqlalchemy.engine.Engine - INFO - [generated in 0.00136s] ()
2025-09-03 23:03:34,154 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:03:34,346 - aiogram.event - INFO - Update id=954949039 is handled. Duration 557 ms by bot id=8413666974
2025-09-03 23:06:15,113 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 23:06:15,129 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 23:06:15,130 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 23:06:15,413 - __main__ - INFO - Работа бота завершена
2025-09-03 23:11:59,820 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 23:11:59,824 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:11:59,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 23:11:59,824 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 23:11:59,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:11:59,826 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:11:59,826 - __main__ - INFO - База данных инициализирована
2025-09-03 23:11:59,834 - __main__ - INFO - Redis подключен успешно
2025-09-03 23:11:59,852 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 23:11:59,852 - __main__ - INFO - Запуск polling...
2025-09-03 23:11:59,852 - aiogram.dispatcher - INFO - Start polling
2025-09-03 23:12:05,654 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 23:12:09,232 - __main__ - INFO - FSM State Change: None
2025-09-03 23:12:09,254 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:12:09,270 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 23:12:09,271 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (37996964,)
2025-09-03 23:12:14,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:12:14,472 - aiogram.event - INFO - Update id=954949040 is handled. Duration 5328 ms by bot id=8413666974
2025-09-03 23:12:18,716 - __main__ - INFO - FSM State Change: None
2025-09-03 23:12:18,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:12:18,719 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 23:12:18,719 - sqlalchemy.engine.Engine - INFO - [cached since 9.449s ago] (37996964,)
2025-09-03 23:12:18,731 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 23:12:18,731 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1, 10, 0)
2025-09-03 23:12:19,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:12:19,551 - aiogram.event - INFO - Update id=954949041 is handled. Duration 841 ms by bot id=8413666974
2025-09-03 23:12:21,406 - __main__ - INFO - FSM State Change: None
2025-09-03 23:12:21,576 - aiogram.event - INFO - Update id=954949042 is handled. Duration 170 ms by bot id=8413666974
2025-09-03 23:12:28,396 - __main__ - INFO - FSM State Change: None
2025-09-03 23:12:28,891 - aiogram.event - INFO - Update id=954949043 is handled. Duration 496 ms by bot id=8413666974
2025-09-03 23:17:48,060 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 23:17:48,090 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 23:17:48,092 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 23:17:48,380 - __main__ - INFO - Работа бота завершена
2025-09-03 23:17:52,200 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 23:17:52,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:17:52,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 23:17:52,205 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:17:52,205 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:17:52,206 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:17:52,206 - __main__ - INFO - База данных инициализирована
2025-09-03 23:17:52,213 - __main__ - INFO - Redis подключен успешно
2025-09-03 23:17:52,230 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 23:17:52,230 - __main__ - INFO - Запуск polling...
2025-09-03 23:17:52,231 - aiogram.dispatcher - INFO - Start polling
2025-09-03 23:17:56,425 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 23:18:02,862 - __main__ - INFO - FSM State Change: None
2025-09-03 23:18:02,875 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:18:02,894 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 23:18:02,894 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (37996964,)
2025-09-03 23:18:08,568 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:18:08,569 - aiogram.event - INFO - Update id=954949044 is handled. Duration 5830 ms by bot id=8413666974
2025-09-03 23:18:11,911 - __main__ - INFO - FSM State Change: None
2025-09-03 23:18:12,115 - aiogram.event - INFO - Update id=954949045 is handled. Duration 211 ms by bot id=8413666974
2025-09-03 23:18:15,868 - __main__ - INFO - FSM State Change: None
2025-09-03 23:18:16,184 - aiogram.event - INFO - Update id=954949046 is handled. Duration 317 ms by bot id=8413666974
2025-09-03 23:18:39,746 - __main__ - INFO - FSM State Change: BouquetStates:waiting_catalog_file
2025-09-03 23:18:40,395 - aiogram.event - INFO - Update id=954949047 is handled. Duration 650 ms by bot id=8413666974
2025-09-03 23:19:42,511 - __main__ - INFO - FSM State Change: BouquetStates:waiting_catalog_file
2025-09-03 23:19:42,701 - aiogram.event - INFO - Update id=954949048 is handled. Duration 195 ms by bot id=8413666974
2025-09-03 23:19:45,752 - __main__ - INFO - FSM State Change: BouquetStates:waiting_catalog_file
2025-09-03 23:19:46,062 - aiogram.event - INFO - Update id=954949049 is handled. Duration 311 ms by bot id=8413666974
2025-09-03 23:19:58,369 - __main__ - INFO - FSM State Change: BouquetStates:waiting_catalog_file
2025-09-03 23:19:58,710 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:19:58,715 - sqlalchemy.engine.Engine - INFO - DELETE FROM products
2025-09-03 23:19:58,715 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] ()
2025-09-03 23:19:58,724 - sqlalchemy.engine.Engine - INFO - DELETE FROM categories
2025-09-03 23:19:58,724 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] ()
2025-09-03 23:19:58,724 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:19:58,729 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:19:58,731 - sqlalchemy.engine.Engine - INFO - INSERT INTO categories (name, created_at, updated_at) VALUES (?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,731 - sqlalchemy.engine.Engine - INFO - [generated in 0.00014s] ('Розы',)
2025-09-03 23:19:58,734 - sqlalchemy.engine.Engine - INFO - INSERT INTO categories (name, created_at, updated_at) VALUES (?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,734 - sqlalchemy.engine.Engine - INFO - [cached since 0.002766s ago] ('Тюльпаны',)
2025-09-03 23:19:58,735 - sqlalchemy.engine.Engine - INFO - INSERT INTO categories (name, created_at, updated_at) VALUES (?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,735 - sqlalchemy.engine.Engine - INFO - [cached since 0.00356s ago] ('Зелень',)
2025-09-03 23:19:58,736 - sqlalchemy.engine.Engine - INFO - INSERT INTO products (category_id, name, color, product_type, created_at, updated_at) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,737 - sqlalchemy.engine.Engine - INFO - [generated in 0.00009s (insertmanyvalues) 1/4 (ordered; batch not supported)] (1, 'Роза эквадорская', 'красный', 'цветок')
2025-09-03 23:19:58,737 - sqlalchemy.engine.Engine - INFO - INSERT INTO products (category_id, name, color, product_type, created_at, updated_at) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,737 - sqlalchemy.engine.Engine - INFO - [insertmanyvalues 2/4 (ordered; batch not supported)] (1, 'Роза кустовая', 'розовый', 'цветок')
2025-09-03 23:19:58,737 - sqlalchemy.engine.Engine - INFO - INSERT INTO products (category_id, name, color, product_type, created_at, updated_at) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,737 - sqlalchemy.engine.Engine - INFO - [insertmanyvalues 3/4 (ordered; batch not supported)] (2, 'Тюльпан белый', 'белый', 'цветок')
2025-09-03 23:19:58,738 - sqlalchemy.engine.Engine - INFO - INSERT INTO products (category_id, name, color, product_type, created_at, updated_at) VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:19:58,738 - sqlalchemy.engine.Engine - INFO - [insertmanyvalues 4/4 (ordered; batch not supported)] (3, 'Эвкалипт', None, 'зелень')
2025-09-03 23:19:58,738 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:19:59,082 - aiogram.event - INFO - Update id=954949050 is handled. Duration 716 ms by bot id=8413666974
2025-09-03 23:20:02,797 - __main__ - INFO - FSM State Change: BouquetStates:waiting_catalog_file
2025-09-03 23:20:02,807 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:20:02,807 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 23:20:02,807 - sqlalchemy.engine.Engine - INFO - [cached since 119.9s ago] (37996964,)
2025-09-03 23:20:02,827 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-09-03 23:20:02,827 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 0)
2025-09-03 23:20:02,996 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:20:02,996 - aiogram.event - INFO - Update id=954949051 is handled. Duration 205 ms by bot id=8413666974
2025-09-03 23:20:14,099 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-03 23:20:14,420 - aiogram.event - INFO - Update id=954949052 is handled. Duration 323 ms by bot id=8413666974
2025-09-03 23:20:17,287 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-03 23:20:17,594 - aiogram.event - INFO - Update id=954949053 is handled. Duration 307 ms by bot id=8413666974
2025-09-03 23:20:49,958 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 23:20:49,960 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 23:20:49,964 - aiogram.event - INFO - Update id=954949054 is handled. Duration 33 ms by bot id=8413666974
2025-09-03 23:20:49,965 - aiogram.event - INFO - Update id=954949055 is handled. Duration 31 ms by bot id=8413666974
2025-09-03 23:20:54,633 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-03 23:20:54,998 - aiogram.event - INFO - Update id=954949056 is handled. Duration 366 ms by bot id=8413666974
2025-09-03 23:21:02,067 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-09-03 23:21:02,273 - aiogram.event - INFO - Update id=954949057 is handled. Duration 206 ms by bot id=8413666974
2025-09-03 23:21:04,675 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-09-03 23:21:04,686 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:04,691 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-03 23:21:04,691 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ()
2025-09-03 23:21:04,865 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:05,009 - aiogram.event - INFO - Update id=954949058 is handled. Duration 335 ms by bot id=8413666974
2025-09-03 23:21:10,755 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-03 23:21:10,914 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:10,916 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories 
WHERE categories.id = ?
2025-09-03 23:21:10,916 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (1,)
2025-09-03 23:21:10,920 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at 
FROM products 
WHERE products.category_id = ? ORDER BY products.name ASC
2025-09-03 23:21:10,920 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (1,)
2025-09-03 23:21:11,078 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:11,079 - aiogram.event - INFO - Update id=954949059 is handled. Duration 324 ms by bot id=8413666974
2025-09-03 23:21:16,879 - __main__ - INFO - FSM State Change: BouquetStates:choosing_product
2025-09-03 23:21:17,180 - aiogram.event - INFO - Update id=954949060 is handled. Duration 302 ms by bot id=8413666974
2025-09-03 23:21:24,760 - __main__ - INFO - FSM State Change: BouquetStates:entering_quantity
2025-09-03 23:21:24,773 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:24,780 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-03 23:21:24,780 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (2,)
2025-09-03 23:21:24,951 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:24,952 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-03 23:21:24,952 - sqlalchemy.engine.Engine - INFO - [cached since 20.26s ago] ()
2025-09-03 23:21:25,106 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:25,107 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:25,108 - aiogram.event - INFO - Update id=954949061 is handled. Duration 348 ms by bot id=8413666974
2025-09-03 23:21:36,105 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-03 23:21:36,252 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:36,253 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories 
WHERE categories.id = ?
2025-09-03 23:21:36,253 - sqlalchemy.engine.Engine - INFO - [cached since 25.34s ago] (2,)
2025-09-03 23:21:36,256 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at 
FROM products 
WHERE products.category_id = ? ORDER BY products.name ASC
2025-09-03 23:21:36,256 - sqlalchemy.engine.Engine - INFO - [cached since 25.34s ago] (2,)
2025-09-03 23:21:36,426 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:36,428 - aiogram.event - INFO - Update id=954949062 is handled. Duration 324 ms by bot id=8413666974
2025-09-03 23:21:37,967 - __main__ - INFO - FSM State Change: BouquetStates:choosing_product
2025-09-03 23:21:38,260 - aiogram.event - INFO - Update id=954949063 is handled. Duration 294 ms by bot id=8413666974
2025-09-03 23:21:42,994 - __main__ - INFO - FSM State Change: BouquetStates:entering_quantity
2025-09-03 23:21:43,005 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:43,006 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-03 23:21:43,006 - sqlalchemy.engine.Engine - INFO - [cached since 18.23s ago] (3,)
2025-09-03 23:21:43,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:21:43,219 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-03 23:21:43,219 - sqlalchemy.engine.Engine - INFO - [cached since 38.53s ago] ()
2025-09-03 23:21:43,393 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:43,396 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:21:43,397 - aiogram.event - INFO - Update id=954949064 is handled. Duration 411 ms by bot id=8413666974
2025-09-03 23:21:46,776 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-03 23:21:47,077 - aiogram.event - INFO - Update id=954949065 is handled. Duration 303 ms by bot id=8413666974
2025-09-03 23:21:55,954 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 23:21:56,120 - aiogram.event - INFO - Update id=954949066 is handled. Duration 172 ms by bot id=8413666974
2025-09-03 23:22:12,965 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-03 23:22:13,502 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:13,503 - root - ERROR - Photo upload failed
2025-09-03 23:22:13,881 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:13,881 - root - ERROR - Photo upload failed
2025-09-03 23:22:14,426 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:14,426 - root - ERROR - Photo upload failed
2025-09-03 23:22:14,761 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:14,762 - root - ERROR - Photo upload failed
2025-09-03 23:22:15,942 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:15,942 - root - ERROR - Photo upload failed
2025-09-03 23:22:15,942 - root - WARNING - All retries failed for photo idx=0, keep Telegram file_id
2025-09-03 23:22:16,203 - root - WARNING - YC storage credentials are not fully configured.
2025-09-03 23:22:16,204 - root - ERROR - Photo upload failed
2025-09-03 23:22:16,204 - root - WARNING - All retries failed for photo idx=1, keep Telegram file_id
2025-09-03 23:22:16,208 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:22:16,217 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-03 23:22:16,217 - sqlalchemy.engine.Engine - INFO - [generated in 0.00100s] ('0205', 1, 'Букет с ромашкой', 'Букет с ромашкой №0205', '["AgACAgIAAxkBAAIEZGi4oyEoc386NHD2S33uLyK9M3IjAAKDDTIblHbISeSFs8ck0l3VAQADAgADeQADNgQ", "AgACAgIAAxkBAAIEZWi4oyGmN4z5tyJ1uXmqG66K-579AAKFDTIblHbISSEhEv3goqPgAQADAgADeQADNgQ"]', None, 'ромашка', '[{"raw_name": "\\u0420\\u043e\\u0437\\u0430 \\u043a\\u0443\\u0441\\u0442\\u043e\\u0432\\u0430\\u044f", "qty": 5, "color": "\\u0440\\u043e\\u0437\\u04 ... (296 characters truncated) ... 439", "type": "\\u0446\\u0432\\u0435\\u0442\\u043e\\u043a", "category": "\\u0422\\u044e\\u043b\\u044c\\u043f\\u0430\\u043d\\u044b", "product_id": 3}]', 400000, 'RUB')
2025-09-03 23:22:16,223 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:22:16,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:22:16,234 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-09-03 23:22:16,234 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (5,)
2025-09-03 23:22:16,523 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:22:16,741 - aiogram.event - INFO - Update id=954949067 is handled. Duration 3777 ms by bot id=8413666974
2025-09-03 23:22:19,588 - __main__ - INFO - FSM State Change: None
2025-09-03 23:22:19,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:22:19,593 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-03 23:22:19,593 - sqlalchemy.engine.Engine - INFO - [cached since 256.7s ago] (37996964,)
2025-09-03 23:22:19,597 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-03 23:22:19,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1, 10, 0)
2025-09-03 23:22:19,745 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:22:19,746 - aiogram.event - INFO - Update id=954949068 is handled. Duration 163 ms by bot id=8413666974
2025-09-03 23:22:22,105 - __main__ - INFO - FSM State Change: None
2025-09-03 23:22:22,271 - aiogram.event - INFO - Update id=954949069 is handled. Duration 166 ms by bot id=8413666974
2025-09-03 23:22:30,493 - __main__ - INFO - FSM State Change: None
2025-09-03 23:22:30,515 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:22:30,516 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.created_at DESC
2025-09-03 23:22:30,516 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] ()
2025-09-03 23:22:30,717 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-03 23:22:30,866 - aiogram.event - INFO - Update id=954949070 is handled. Duration 376 ms by bot id=8413666974
2025-09-03 23:23:36,789 - __main__ - INFO - FSM State Change: None
2025-09-03 23:23:36,973 - aiogram.event - INFO - Update id=954949071 is handled. Duration 187 ms by bot id=8413666974
2025-09-03 23:29:45,242 - __main__ - INFO - FSM State Change: None
2025-09-03 23:29:45,647 - aiogram.event - INFO - Update id=954949072 is handled. Duration 417 ms by bot id=8413666974
2025-09-03 23:45:16,369 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-03 23:45:16,387 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-03 23:45:16,388 - aiogram.dispatcher - INFO - Polling stopped
2025-09-03 23:45:16,655 - __main__ - INFO - Работа бота завершена
2025-09-03 23:45:19,930 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-03 23:45:19,935 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-03 23:45:19,935 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-03 23:45:19,935 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:45:19,936 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-03 23:45:19,936 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:45:19,936 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-03 23:45:19,936 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:45:19,936 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-03 23:45:19,937 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-03 23:45:19,937 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-03 23:45:19,937 - __main__ - INFO - База данных инициализирована
2025-09-03 23:45:19,952 - __main__ - INFO - Redis подключен успешно
2025-09-03 23:45:19,970 - __main__ - INFO - Бот успешно создан и настроен
2025-09-03 23:45:19,970 - __main__ - INFO - Запуск polling...
2025-09-03 23:45:19,970 - aiogram.dispatcher - INFO - Start polling
2025-09-03 23:45:23,463 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 00:02:19,798 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 00:02:19,820 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 00:19:53,711 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 00:19:53,783 - aiogram.dispatcher - WARNING - Sleep for 1.393091 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-04 00:36:41,691 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 00:36:41,774 - aiogram.dispatcher - WARNING - Sleep for 1.781944 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-04 00:54:20,679 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 00:54:20,679 - aiogram.dispatcher - WARNING - Sleep for 2.276196 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-04 01:11:14,755 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 01:11:14,756 - aiogram.dispatcher - WARNING - Sleep for 2.878813 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-09-04 01:28:44,647 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 01:28:44,647 - aiogram.dispatcher - WARNING - Sleep for 3.696480 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-09-04 01:44:07,637 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 01:44:07,718 - aiogram.dispatcher - WARNING - Sleep for 4.907097 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-09-04 02:01:26,616 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 02:01:26,616 - aiogram.dispatcher - WARNING - Sleep for 5.141046 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-09-04 02:16:44,592 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 02:16:44,680 - aiogram.dispatcher - WARNING - Sleep for 5.044594 seconds and try again... (tryings = 8, bot id = 8413666974)
2025-09-04 02:51:34,455 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 02:51:34,539 - aiogram.dispatcher - WARNING - Sleep for 5.067420 seconds and try again... (tryings = 9, bot id = 8413666974)
2025-09-04 03:25:42,399 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 03:25:42,485 - aiogram.dispatcher - WARNING - Sleep for 4.973902 seconds and try again... (tryings = 10, bot id = 8413666974)
2025-09-04 03:42:26,375 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 03:42:26,375 - aiogram.dispatcher - WARNING - Sleep for 4.909773 seconds and try again... (tryings = 11, bot id = 8413666974)
2025-09-04 03:58:05,354 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 03:58:05,439 - aiogram.dispatcher - WARNING - Sleep for 5.037930 seconds and try again... (tryings = 12, bot id = 8413666974)
2025-09-04 04:29:55,262 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 04:29:55,267 - aiogram.dispatcher - WARNING - Sleep for 5.029336 seconds and try again... (tryings = 13, bot id = 8413666974)
2025-09-04 04:46:13,198 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 04:46:13,286 - aiogram.dispatcher - WARNING - Sleep for 5.019934 seconds and try again... (tryings = 14, bot id = 8413666974)
2025-09-04 05:01:58,172 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 05:01:58,172 - aiogram.dispatcher - WARNING - Sleep for 4.926193 seconds and try again... (tryings = 15, bot id = 8413666974)
2025-09-04 05:18:08,168 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 05:18:08,225 - aiogram.dispatcher - WARNING - Sleep for 5.068440 seconds and try again... (tryings = 16, bot id = 8413666974)
2025-09-04 05:51:44,068 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 05:51:44,155 - aiogram.dispatcher - WARNING - Sleep for 5.023908 seconds and try again... (tryings = 17, bot id = 8413666974)
2025-09-04 06:24:41,698 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 06:24:41,785 - aiogram.dispatcher - WARNING - Sleep for 4.847819 seconds and try again... (tryings = 18, bot id = 8413666974)
2025-09-04 06:40:14,770 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 06:40:14,771 - aiogram.dispatcher - WARNING - Sleep for 4.794780 seconds and try again... (tryings = 19, bot id = 8413666974)
2025-09-04 06:57:40,793 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 06:57:40,893 - aiogram.dispatcher - WARNING - Sleep for 4.999175 seconds and try again... (tryings = 20, bot id = 8413666974)
2025-09-04 07:00:00,798 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 07:00:00,798 - aiogram.dispatcher - WARNING - Sleep for 5.179845 seconds and try again... (tryings = 21, bot id = 8413666974)
2025-09-04 07:00:16,687 - aiogram.dispatcher - INFO - Connection established (tryings = 22, bot id = 8413666974)
2025-09-04 07:18:41,787 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 07:18:41,899 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 07:27:02,715 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 07:27:02,715 - aiogram.dispatcher - WARNING - Sleep for 1.401120 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-04 07:44:53,719 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 07:44:53,807 - aiogram.dispatcher - WARNING - Sleep for 1.703996 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-04 08:00:15,716 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 08:00:15,716 - aiogram.dispatcher - WARNING - Sleep for 2.134861 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-04 08:16:06,713 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 08:16:06,799 - aiogram.dispatcher - WARNING - Sleep for 2.820915 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-09-04 08:32:58,728 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 08:32:58,808 - aiogram.dispatcher - WARNING - Sleep for 3.664840 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-09-04 08:48:59,589 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 08:48:59,590 - aiogram.dispatcher - WARNING - Sleep for 4.735747 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-09-04 08:49:15,070 - aiogram.dispatcher - INFO - Connection established (tryings = 7, bot id = 8413666974)
2025-09-04 09:05:48,573 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 09:05:48,573 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 09:07:04,194 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 09:07:04,195 - aiogram.dispatcher - WARNING - Sleep for 1.439610 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-04 09:07:16,331 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 8413666974)
2025-09-04 09:08:21,492 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 09:08:21,513 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 09:08:21,514 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 09:08:21,790 - __main__ - INFO - Работа бота завершена
2025-09-04 09:08:25,127 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 09:08:25,131 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:08:25,131 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 09:08:25,131 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 09:08:25,132 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 09:08:25,133 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 09:08:25,133 - __main__ - INFO - База данных инициализирована
2025-09-04 09:08:25,141 - __main__ - INFO - Redis подключен успешно
2025-09-04 09:08:25,158 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 09:08:25,158 - __main__ - INFO - Запуск polling...
2025-09-04 09:08:25,158 - aiogram.dispatcher - INFO - Start polling
2025-09-04 09:08:25,898 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 09:08:30,650 - __main__ - INFO - FSM State Change: None
2025-09-04 09:08:30,654 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:08:30,675 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 09:08:30,676 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] (37996964,)
2025-09-04 09:08:31,354 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:08:31,355 - aiogram.event - INFO - Update id=954949073 is handled. Duration 832 ms by bot id=8413666974
2025-09-04 09:08:34,362 - __main__ - INFO - FSM State Change: None
2025-09-04 09:08:34,533 - aiogram.event - INFO - Update id=954949074 is handled. Duration 172 ms by bot id=8413666974
2025-09-04 09:08:46,970 - __main__ - INFO - FSM State Change: None
2025-09-04 09:08:46,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:08:46,994 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 09:08:46,995 - sqlalchemy.engine.Engine - INFO - [cached since 16.32s ago] (37996964,)
2025-09-04 09:08:47,006 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-09-04 09:08:47,006 - sqlalchemy.engine.Engine - INFO - [generated in 0.00024s] (1, 0)
2025-09-04 09:08:47,224 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:08:47,225 - aiogram.event - INFO - Update id=954949075 is handled. Duration 256 ms by bot id=8413666974
2025-09-04 09:08:56,371 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-04 09:08:56,536 - aiogram.event - INFO - Update id=954949076 is handled. Duration 167 ms by bot id=8413666974
2025-09-04 09:08:58,454 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-04 09:08:58,768 - aiogram.event - INFO - Update id=954949077 is handled. Duration 315 ms by bot id=8413666974
2025-09-04 09:09:00,710 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 09:09:01,022 - aiogram.event - INFO - Update id=954949078 is handled. Duration 313 ms by bot id=8413666974
2025-09-04 09:09:13,498 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 09:09:13,851 - aiogram.event - INFO - Update id=954949079 is handled. Duration 355 ms by bot id=8413666974
2025-09-04 09:09:16,901 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 09:09:17,324 - aiogram.event - INFO - Update id=954949080 is handled. Duration 423 ms by bot id=8413666974
2025-09-04 09:09:26,018 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-09-04 09:09:26,199 - aiogram.event - INFO - Update id=954949081 is handled. Duration 182 ms by bot id=8413666974
2025-09-04 09:09:28,938 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-09-04 09:09:28,944 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:09:28,949 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-04 09:09:28,949 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ()
2025-09-04 09:09:29,149 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:09:29,338 - aiogram.event - INFO - Update id=954949082 is handled. Duration 401 ms by bot id=8413666974
2025-09-04 09:09:31,771 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-04 09:09:31,997 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:09:31,999 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories 
WHERE categories.id = ?
2025-09-04 09:09:31,999 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1,)
2025-09-04 09:09:32,006 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at 
FROM products 
WHERE products.category_id = ? ORDER BY products.name ASC
2025-09-04 09:09:32,006 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1,)
2025-09-04 09:09:32,229 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:09:32,229 - aiogram.event - INFO - Update id=954949083 is handled. Duration 459 ms by bot id=8413666974
2025-09-04 09:09:37,850 - __main__ - INFO - FSM State Change: BouquetStates:choosing_product
2025-09-04 09:09:38,189 - aiogram.event - INFO - Update id=954949084 is handled. Duration 340 ms by bot id=8413666974
2025-09-04 09:09:51,464 - __main__ - INFO - FSM State Change: BouquetStates:entering_quantity
2025-09-04 09:09:51,469 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:09:51,472 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-04 09:09:51,472 - sqlalchemy.engine.Engine - INFO - [generated in 0.00112s] (2,)
2025-09-04 09:09:51,637 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 09:09:51,637 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-04 09:09:51,638 - sqlalchemy.engine.Engine - INFO - [cached since 22.69s ago] ()
2025-09-04 09:09:51,789 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:09:51,790 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 09:09:51,791 - aiogram.event - INFO - Update id=954949085 is handled. Duration 348 ms by bot id=8413666974
2025-09-04 09:30:14,613 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 09:30:14,616 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 09:47:39,649 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 09:47:39,729 - aiogram.dispatcher - WARNING - Sleep for 1.293768 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-04 10:04:47,746 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 10:04:47,747 - aiogram.dispatcher - WARNING - Sleep for 1.613004 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-04 10:21:54,663 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 10:21:54,748 - aiogram.dispatcher - WARNING - Sleep for 2.117558 seconds and try again... (tryings = 3, bot id = 8413666974)
2025-09-04 10:39:31,750 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 10:39:31,755 - aiogram.dispatcher - WARNING - Sleep for 2.638288 seconds and try again... (tryings = 4, bot id = 8413666974)
2025-09-04 10:56:34,669 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 10:56:34,755 - aiogram.dispatcher - WARNING - Sleep for 3.628061 seconds and try again... (tryings = 5, bot id = 8413666974)
2025-09-04 11:14:10,676 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 11:14:10,676 - aiogram.dispatcher - WARNING - Sleep for 4.712404 seconds and try again... (tryings = 6, bot id = 8413666974)
2025-09-04 11:32:09,676 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 11:32:09,777 - aiogram.dispatcher - WARNING - Sleep for 5.095544 seconds and try again... (tryings = 7, bot id = 8413666974)
2025-09-04 11:34:57,174 - aiogram.dispatcher - INFO - Connection established (tryings = 8, bot id = 8413666974)
2025-09-04 11:38:17,598 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 11:38:17,627 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 11:38:17,629 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 11:38:17,907 - __main__ - INFO - Работа бота завершена
2025-09-04 11:38:24,821 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 11:38:24,825 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:38:24,825 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 11:38:24,825 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 11:38:24,826 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 11:38:24,827 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 11:38:24,828 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 11:38:24,828 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 11:38:24,828 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 11:38:24,829 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 11:38:24,829 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 11:38:24,829 - __main__ - INFO - База данных инициализирована
2025-09-04 11:38:24,841 - __main__ - INFO - Redis подключен успешно
2025-09-04 11:38:24,860 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 11:38:24,860 - __main__ - INFO - Запуск polling...
2025-09-04 11:38:24,860 - aiogram.dispatcher - INFO - Start polling
2025-09-04 11:38:25,723 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 11:39:07,234 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-04 11:39:07,281 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:07,296 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:39:07,296 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (37996964,)
2025-09-04 11:39:08,184 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:08,185 - aiogram.event - INFO - Update id=954949086 is handled. Duration 990 ms by bot id=8413666974
2025-09-04 11:39:10,471 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:10,473 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:10,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:39:10,474 - sqlalchemy.engine.Engine - INFO - [cached since 3.178s ago] (37996964,)
2025-09-04 11:39:10,476 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:39:10,476 - sqlalchemy.engine.Engine - INFO - [generated in 0.00018s] (1, 10, 0)
2025-09-04 11:39:10,637 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:10,638 - aiogram.event - INFO - Update id=954949087 is handled. Duration 168 ms by bot id=8413666974
2025-09-04 11:39:15,684 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:15,690 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:15,692 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:39:15,692 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] ('0205',)
2025-09-04 11:39:15,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:15,875 - aiogram.event - INFO - Update id=954949088 is handled. Duration 192 ms by bot id=8413666974
2025-09-04 11:39:21,188 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:21,381 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:21,383 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:39:21,383 - sqlalchemy.engine.Engine - INFO - [cached since 14.09s ago] (8413666974,)
2025-09-04 11:39:21,385 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:39:21,386 - sqlalchemy.engine.Engine - INFO - [cached since 10.91s ago] (2, 10, 0)
2025-09-04 11:39:21,547 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:21,548 - aiogram.event - INFO - Update id=954949089 is handled. Duration 361 ms by bot id=8413666974
2025-09-04 11:39:23,036 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:23,040 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:23,041 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:39:23,041 - sqlalchemy.engine.Engine - INFO - [cached since 7.35s ago] ('0204',)
2025-09-04 11:39:23,273 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:23,274 - aiogram.event - INFO - Update id=954949090 is handled. Duration 239 ms by bot id=8413666974
2025-09-04 11:39:38,535 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:38,713 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:38,713 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:39:38,714 - sqlalchemy.engine.Engine - INFO - [cached since 31.42s ago] (8413666974,)
2025-09-04 11:39:38,715 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:39:38,716 - sqlalchemy.engine.Engine - INFO - [cached since 28.24s ago] (2, 10, 0)
2025-09-04 11:39:38,881 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:38,882 - aiogram.event - INFO - Update id=954949091 is handled. Duration 348 ms by bot id=8413666974
2025-09-04 11:39:39,625 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:39,779 - aiogram.event - INFO - Update id=954949092 is handled. Duration 154 ms by bot id=8413666974
2025-09-04 11:39:42,088 - __main__ - INFO - FSM State Change: None
2025-09-04 11:39:42,093 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:39:42,096 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.created_at DESC
2025-09-04 11:39:42,097 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ()
2025-09-04 11:39:42,448 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:39:42,605 - aiogram.event - INFO - Update id=954949093 is handled. Duration 517 ms by bot id=8413666974
2025-09-04 11:41:22,085 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:22,099 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:22,101 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:41:22,102 - sqlalchemy.engine.Engine - INFO - [cached since 134.8s ago] (37996964,)
2025-09-04 11:41:22,113 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:41:22,113 - sqlalchemy.engine.Engine - INFO - [cached since 131.6s ago] (1, 10, 0)
2025-09-04 11:41:22,331 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:41:22,333 - aiogram.event - INFO - Update id=954949094 is handled. Duration 424 ms by bot id=8413666974
2025-09-04 11:41:24,355 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:24,359 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:24,360 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:24,360 - sqlalchemy.engine.Engine - INFO - [cached since 128.7s ago] ('0205',)
2025-09-04 11:41:24,539 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:41:24,540 - aiogram.event - INFO - Update id=954949095 is handled. Duration 187 ms by bot id=8413666974
2025-09-04 11:41:26,726 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:26,735 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:26,736 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:26,736 - sqlalchemy.engine.Engine - INFO - [cached since 131s ago] ('0205',)
2025-09-04 11:41:26,738 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 11:41:26,739 - root - WARNING - Не удалось удалить файлы букета 0205 с сервера
2025-09-04 11:41:26,739 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:26,739 - sqlalchemy.engine.Engine - INFO - [cached since 131.1s ago] ('0205',)
2025-09-04 11:41:26,749 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-09-04 11:41:26,749 - sqlalchemy.engine.Engine - INFO - [generated in 0.00020s] (5,)
2025-09-04 11:41:26,750 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 11:41:26,907 - aiogram.event - INFO - Update id=954949096 is handled. Duration 194 ms by bot id=8413666974
2025-09-04 11:41:30,414 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:30,626 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:30,628 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:41:30,628 - sqlalchemy.engine.Engine - INFO - [cached since 143.3s ago] (8413666974,)
2025-09-04 11:41:30,631 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:41:30,631 - sqlalchemy.engine.Engine - INFO - [cached since 140.2s ago] (2, 10, 0)
2025-09-04 11:41:30,855 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:41:30,856 - aiogram.event - INFO - Update id=954949097 is handled. Duration 445 ms by bot id=8413666974
2025-09-04 11:41:32,473 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:32,480 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:32,481 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:32,481 - sqlalchemy.engine.Engine - INFO - [cached since 136.8s ago] ('0204',)
2025-09-04 11:41:32,642 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:41:32,643 - aiogram.event - INFO - Update id=954949098 is handled. Duration 171 ms by bot id=8413666974
2025-09-04 11:41:33,990 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:33,993 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:33,993 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:33,993 - sqlalchemy.engine.Engine - INFO - [cached since 138.3s ago] ('0204',)
2025-09-04 11:41:33,995 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 11:41:33,995 - root - WARNING - Не удалось удалить файлы букета 0204 с сервера
2025-09-04 11:41:33,996 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 11:41:33,996 - sqlalchemy.engine.Engine - INFO - [cached since 138.3s ago] ('0204',)
2025-09-04 11:41:33,999 - sqlalchemy.engine.Engine - INFO - DELETE FROM bouquets WHERE bouquets.id = ?
2025-09-04 11:41:33,999 - sqlalchemy.engine.Engine - INFO - [cached since 7.251s ago] (4,)
2025-09-04 11:41:34,001 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 11:41:34,154 - aiogram.event - INFO - Update id=954949099 is handled. Duration 165 ms by bot id=8413666974
2025-09-04 11:41:35,533 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:35,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 11:41:35,536 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 11:41:35,536 - sqlalchemy.engine.Engine - INFO - [cached since 148.2s ago] (37996964,)
2025-09-04 11:41:35,537 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 11:41:35,537 - sqlalchemy.engine.Engine - INFO - [cached since 145.1s ago] (1, 10, 0)
2025-09-04 11:41:35,690 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 11:41:35,690 - aiogram.event - INFO - Update id=954949100 is handled. Duration 158 ms by bot id=8413666974
2025-09-04 11:41:38,483 - __main__ - INFO - FSM State Change: None
2025-09-04 11:41:38,674 - aiogram.event - INFO - Update id=954949101 is handled. Duration 204 ms by bot id=8413666974
2025-09-04 12:13:59,865 - __main__ - INFO - FSM State Change: None
2025-09-04 12:13:59,900 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:13:59,905 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 12:13:59,906 - sqlalchemy.engine.Engine - INFO - [cached since 2093s ago] (37996964,)
2025-09-04 12:13:59,930 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets ORDER BY bouquets.id DESC
 LIMIT ? OFFSET ?
2025-09-04 12:13:59,930 - sqlalchemy.engine.Engine - INFO - [generated in 0.00016s] (1, 0)
2025-09-04 12:14:00,748 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:14:00,749 - aiogram.event - INFO - Update id=954949102 is handled. Duration 905 ms by bot id=8413666974
2025-09-04 12:14:39,470 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-04 12:14:39,664 - aiogram.event - INFO - Update id=954949103 is handled. Duration 197 ms by bot id=8413666974
2025-09-04 12:14:42,836 - __main__ - INFO - FSM State Change: BouquetStates:waiting_title
2025-09-04 12:14:43,221 - aiogram.event - INFO - Update id=954949104 is handled. Duration 385 ms by bot id=8413666974
2025-09-04 12:15:04,585 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,588 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,588 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,588 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,590 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,591 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:04,592 - aiogram.event - INFO - Update id=954949105 is handled. Duration 20 ms by bot id=8413666974
2025-09-04 12:15:04,594 - aiogram.event - INFO - Update id=954949107 is handled. Duration 18 ms by bot id=8413666974
2025-09-04 12:15:04,594 - aiogram.event - INFO - Update id=954949108 is handled. Duration 18 ms by bot id=8413666974
2025-09-04 12:15:04,594 - aiogram.event - INFO - Update id=954949106 is handled. Duration 20 ms by bot id=8413666974
2025-09-04 12:15:04,595 - aiogram.event - INFO - Update id=954949109 is handled. Duration 19 ms by bot id=8413666974
2025-09-04 12:15:04,595 - aiogram.event - INFO - Update id=954949110 is handled. Duration 19 ms by bot id=8413666974
2025-09-04 12:15:26,657 - __main__ - INFO - FSM State Change: BouquetStates:waiting_media
2025-09-04 12:15:27,170 - aiogram.event - INFO - Update id=954949111 is handled. Duration 515 ms by bot id=8413666974
2025-09-04 12:15:33,317 - __main__ - INFO - FSM State Change: BouquetStates:waiting_description
2025-09-04 12:15:33,479 - aiogram.event - INFO - Update id=954949112 is handled. Duration 168 ms by bot id=8413666974
2025-09-04 12:15:35,652 - __main__ - INFO - FSM State Change: BouquetStates:waiting_composition
2025-09-04 12:15:35,664 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:35,673 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-04 12:15:35,673 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ()
2025-09-04 12:15:35,834 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:35,983 - aiogram.event - INFO - Update id=954949113 is handled. Duration 332 ms by bot id=8413666974
2025-09-04 12:15:41,244 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-04 12:15:41,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:41,434 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories 
WHERE categories.id = ?
2025-09-04 12:15:41,435 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (3,)
2025-09-04 12:15:41,441 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at 
FROM products 
WHERE products.category_id = ? ORDER BY products.name ASC
2025-09-04 12:15:41,441 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (3,)
2025-09-04 12:15:41,602 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:41,604 - aiogram.event - INFO - Update id=954949114 is handled. Duration 361 ms by bot id=8413666974
2025-09-04 12:15:43,365 - __main__ - INFO - FSM State Change: BouquetStates:choosing_product
2025-09-04 12:15:43,372 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:43,377 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-04 12:15:43,377 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (4,)
2025-09-04 12:15:43,585 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:43,847 - aiogram.event - INFO - Update id=954949115 is handled. Duration 483 ms by bot id=8413666974
2025-09-04 12:15:49,798 - __main__ - INFO - FSM State Change: BouquetStates:entering_quantity
2025-09-04 12:15:49,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:49,807 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-04 12:15:49,807 - sqlalchemy.engine.Engine - INFO - [cached since 6.43s ago] (4,)
2025-09-04 12:15:49,974 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:49,975 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-04 12:15:49,975 - sqlalchemy.engine.Engine - INFO - [cached since 14.3s ago] ()
2025-09-04 12:15:50,151 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:50,152 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:50,153 - aiogram.event - INFO - Update id=954949116 is handled. Duration 355 ms by bot id=8413666974
2025-09-04 12:15:55,128 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-04 12:15:55,272 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:55,273 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories 
WHERE categories.id = ?
2025-09-04 12:15:55,274 - sqlalchemy.engine.Engine - INFO - [cached since 13.84s ago] (1,)
2025-09-04 12:15:55,277 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at 
FROM products 
WHERE products.category_id = ? ORDER BY products.name ASC
2025-09-04 12:15:55,278 - sqlalchemy.engine.Engine - INFO - [cached since 13.84s ago] (1,)
2025-09-04 12:15:55,430 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:55,432 - aiogram.event - INFO - Update id=954949117 is handled. Duration 305 ms by bot id=8413666974
2025-09-04 12:15:57,126 - __main__ - INFO - FSM State Change: BouquetStates:choosing_product
2025-09-04 12:15:57,132 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:15:57,133 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-04 12:15:57,133 - sqlalchemy.engine.Engine - INFO - [cached since 13.76s ago] (1,)
2025-09-04 12:15:57,292 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:15:57,429 - aiogram.event - INFO - Update id=954949118 is handled. Duration 306 ms by bot id=8413666974
2025-09-04 12:16:25,257 - __main__ - INFO - FSM State Change: BouquetStates:entering_quantity
2025-09-04 12:16:25,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:25,270 - sqlalchemy.engine.Engine - INFO - SELECT products.id, products.category_id, products.name, products.color, products.product_type, products.created_at, products.updated_at, categories.id AS id_1, categories.name AS name_1, categories.created_at AS created_at_1, categories.updated_at AS updated_at_1 
FROM products JOIN categories ON products.category_id = categories.id 
WHERE products.id = ?
2025-09-04 12:16:25,270 - sqlalchemy.engine.Engine - INFO - [cached since 41.89s ago] (1,)
2025-09-04 12:16:25,443 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:25,444 - sqlalchemy.engine.Engine - INFO - SELECT categories.id, categories.name, categories.created_at, categories.updated_at 
FROM categories ORDER BY categories.name ASC
2025-09-04 12:16:25,444 - sqlalchemy.engine.Engine - INFO - [cached since 49.77s ago] ()
2025-09-04 12:16:25,617 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:25,619 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:25,621 - aiogram.event - INFO - Update id=954949119 is handled. Duration 367 ms by bot id=8413666974
2025-09-04 12:16:30,247 - __main__ - INFO - FSM State Change: BouquetStates:choosing_category
2025-09-04 12:16:30,747 - aiogram.event - INFO - Update id=954949120 is handled. Duration 501 ms by bot id=8413666974
2025-09-04 12:16:37,825 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-04 12:16:37,990 - aiogram.event - INFO - Update id=954949121 is handled. Duration 166 ms by bot id=8413666974
2025-09-04 12:16:40,427 - __main__ - INFO - FSM State Change: BouquetStates:waiting_price
2025-09-04 12:16:40,432 - root - INFO - Загрузка 6 медиа для букета 0201
2025-09-04 12:16:40,875 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:40,876 - root - ERROR - Photo upload failed
2025-09-04 12:16:40,876 - root - WARNING - [1] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:41,230 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:41,231 - root - ERROR - Photo upload failed
2025-09-04 12:16:41,231 - root - WARNING - [2] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:41,630 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:41,631 - root - ERROR - Photo upload failed
2025-09-04 12:16:41,631 - root - WARNING - [3] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:42,004 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:42,004 - root - ERROR - Photo upload failed
2025-09-04 12:16:42,004 - root - WARNING - [4] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:42,432 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:42,432 - root - ERROR - Photo upload failed
2025-09-04 12:16:42,432 - root - WARNING - [5] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:42,793 - root - WARNING - YC storage credentials are not fully configured.
2025-09-04 12:16:42,793 - root - ERROR - Photo upload failed
2025-09-04 12:16:42,793 - root - WARNING - [6] не удалось загрузить на облако, сохраняю только file_id
2025-09-04 12:16:42,794 - root - INFO - Итог медиа к сохранению: [{'file_id': 'AgACAgIAAxkBAAIErmi5WJhJ7CpRngy7-BddnMD7G4_8AAJ9EDIblHbISUkzsECEM3llAQADAgADeQADNgQ'}, {'file_id': 'AgACAgIAAxkBAAIEsGi5WJhKJ-J8D_QeIpTztTWCSdHlAAJ_EDIblHbISS5QqeAsTg95AQADAgADeQADNgQ'}, {'file_id': 'AgACAgIAAxkBAAIEsWi5WJjpH89eSvH62qjHlNZKu0rYAAKAEDIblHbISX3_6-sbEDpiAQADAgADeQADNgQ'}, {'file_id': 'AgACAgIAAxkBAAIEr2i5WJiyJqoeQ11SulIHEl_y3m75AAJ-EDIblHbISa4vFg1e9RZTAQADAgADeQADNgQ'}, {'file_id': 'AgACAgIAAxkBAAIEsmi5WJhGY1mH2JQ3g8VinscMwL1LAAKBEDIblHbISR0qCSGSqmPfAQADAgADeQADNgQ'}, {'file_id': 'AgACAgIAAxkBAAIEs2i5WJi6GVZP6AABiPJqc_5LYmyxgAACghAyG5R2yEkecIa20dArvAEAAwIAA3kAAzYE'}]
2025-09-04 12:16:42,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:42,818 - sqlalchemy.engine.Engine - INFO - INSERT INTO bouquets (bouquet_id, user_id, short_title, title_display, photos, video_path, description, composition, price_minor, currency, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP) RETURNING id, created_at, updated_at
2025-09-04 12:16:42,819 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] ('0201', 1, 'Букет с вльсиромертями', 'Букет с вльсиромертями №0201', '[{"file_id": "AgACAgIAAxkBAAIErmi5WJhJ7CpRngy7-BddnMD7G4_8AAJ9EDIblHbISUkzsECEM3llAQADAgADeQADNgQ"}, {"file_id": "AgACAgIAAxkBAAIEsGi5WJhKJ-J8D_QeIpT ... (303 characters truncated) ... cMwL1LAAKBEDIblHbISR0qCSGSqmPfAQADAgADeQADNgQ"}, {"file_id": "AgACAgIAAxkBAAIEs2i5WJi6GVZP6AABiPJqc_5LYmyxgAACghAyG5R2yEkecIa20dArvAEAAwIAA3kAAzYE"}]', None, 'Ририпмпина', '[{"raw_name": "\\u042d\\u0432\\u043a\\u0430\\u043b\\u0438\\u043f\\u0442", "qty": 1, "color": null, "type": "\\u0437\\u0435\\u043b\\u0435\\u043d\\u044 ... (242 characters truncated) ... 430\\u0441\\u043d\\u044b\\u0439", "type": "\\u0446\\u0432\\u0435\\u0442\\u043e\\u043a", "category": "\\u0420\\u043e\\u0437\\u044b", "product_id": 1}]', 300000, 'RUB')
2025-09-04 12:16:42,825 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 12:16:42,836 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:42,843 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.id = ?
2025-09-04 12:16:42,843 - sqlalchemy.engine.Engine - INFO - [generated in 0.00025s] (1,)
2025-09-04 12:16:43,033 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:43,167 - aiogram.event - INFO - Update id=954949122 is handled. Duration 2741 ms by bot id=8413666974
2025-09-04 12:16:48,014 - __main__ - INFO - FSM State Change: None
2025-09-04 12:16:48,016 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:48,016 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.media_limit, users.created_at, users.updated_at 
FROM users 
WHERE users.telegram_id = ?
2025-09-04 12:16:48,017 - sqlalchemy.engine.Engine - INFO - [cached since 2261s ago] (37996964,)
2025-09-04 12:16:48,019 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.user_id = ? ORDER BY bouquets.created_at DESC
 LIMIT ? OFFSET ?
2025-09-04 12:16:48,019 - sqlalchemy.engine.Engine - INFO - [cached since 2258s ago] (1, 10, 0)
2025-09-04 12:16:48,231 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:48,232 - aiogram.event - INFO - Update id=954949123 is handled. Duration 218 ms by bot id=8413666974
2025-09-04 12:16:52,025 - __main__ - INFO - FSM State Change: None
2025-09-04 12:16:52,030 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:52,031 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 12:16:52,031 - sqlalchemy.engine.Engine - INFO - [cached since 2256s ago] ('0201',)
2025-09-04 12:16:52,036 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:52,038 - root - ERROR - Ошибка в show_bouquet_details: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/is_instance_of
2025-09-04 12:16:52,182 - aiogram.event - INFO - Update id=954949124 is handled. Duration 157 ms by bot id=8413666974
2025-09-04 12:16:58,740 - __main__ - INFO - FSM State Change: None
2025-09-04 12:16:58,751 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:16:58,753 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 12:16:58,753 - sqlalchemy.engine.Engine - INFO - [cached since 2263s ago] ('0201',)
2025-09-04 12:16:58,756 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:16:58,757 - root - ERROR - Ошибка в show_bouquet_details: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/is_instance_of
2025-09-04 12:16:58,904 - aiogram.event - INFO - Update id=954949125 is handled. Duration 165 ms by bot id=8413666974
2025-09-04 12:17:01,477 - __main__ - INFO - FSM State Change: None
2025-09-04 12:17:01,480 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:17:01,481 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 12:17:01,481 - sqlalchemy.engine.Engine - INFO - [cached since 2266s ago] ('0201',)
2025-09-04 12:17:01,482 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:17:01,483 - root - ERROR - Ошибка в show_bouquet_details: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/is_instance_of
2025-09-04 12:17:01,615 - aiogram.event - INFO - Update id=954949126 is handled. Duration 139 ms by bot id=8413666974
2025-09-04 12:17:03,813 - __main__ - INFO - FSM State Change: None
2025-09-04 12:17:03,821 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:17:03,823 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 12:17:03,824 - sqlalchemy.engine.Engine - INFO - [cached since 2268s ago] ('0201',)
2025-09-04 12:17:03,827 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:17:03,828 - root - ERROR - Ошибка в show_bouquet_details: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/is_instance_of
2025-09-04 12:17:04,063 - aiogram.event - INFO - Update id=954949127 is handled. Duration 253 ms by bot id=8413666974
2025-09-04 12:17:26,871 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 12:17:26,884 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 12:17:26,884 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 12:17:27,154 - __main__ - INFO - Работа бота завершена
2025-09-04 12:17:30,978 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 12:17:30,980 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 12:17:30,981 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 12:17:30,981 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 12:17:30,981 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 12:17:30,981 - __main__ - INFO - База данных инициализирована
2025-09-04 12:17:30,986 - __main__ - INFO - Redis подключен успешно
2025-09-04 12:17:31,003 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 12:17:31,003 - __main__ - INFO - Запуск polling...
2025-09-04 12:17:31,004 - aiogram.dispatcher - INFO - Start polling
2025-09-04 12:17:32,043 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 12:17:32,187 - __main__ - INFO - FSM State Change: None
2025-09-04 12:17:32,190 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 12:17:32,200 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 12:17:32,200 - sqlalchemy.engine.Engine - INFO - [generated in 0.00023s] ('0201',)
2025-09-04 12:17:32,202 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 12:17:32,202 - root - ERROR - Ошибка в show_bouquet_details: 2 validation errors for SendPhoto
photo.str
  Input should be a valid string [type=string_type, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
photo.is-instance[InputFile]
  Input should be an instance of InputFile [type=is_instance_of, input_value={'file_id': 'AgACAgIAAxkB...ECEM3llAQADAgADeQADNgQ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/is_instance_of
2025-09-04 12:17:32,952 - aiogram.event - INFO - Update id=954949128 is handled. Duration 768 ms by bot id=8413666974
2025-09-04 12:56:05,671 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 12:56:05,673 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 12:56:17,692 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-04 13:06:38,026 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 13:06:38,042 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 13:06:55,259 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8413666974)
2025-09-04 13:09:24,413 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 13:09:24,433 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 13:09:24,434 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 13:09:24,707 - __main__ - INFO - Работа бота завершена
2025-09-04 13:09:29,073 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 13:09:29,077 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 13:09:29,077 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 13:09:29,077 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 13:09:29,078 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 13:09:29,079 - __main__ - INFO - База данных инициализирована
2025-09-04 13:09:29,100 - __main__ - INFO - Redis подключен успешно
2025-09-04 13:09:29,120 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 13:09:29,120 - __main__ - INFO - Запуск polling...
2025-09-04 13:09:29,120 - aiogram.dispatcher - INFO - Start polling
2025-09-04 13:09:30,534 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 13:09:32,231 - __main__ - INFO - FSM State Change: None
2025-09-04 13:09:32,237 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 13:09:32,251 - sqlalchemy.engine.Engine - INFO - SELECT bouquets.id, bouquets.bouquet_id, bouquets.user_id, bouquets.short_title, bouquets.title_display, bouquets.photos, bouquets.video_path, bouquets.description, bouquets.composition, bouquets.price_minor, bouquets.currency, bouquets.created_at, bouquets.updated_at 
FROM bouquets 
WHERE bouquets.bouquet_id = ?
2025-09-04 13:09:32,251 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('0201',)
2025-09-04 13:09:33,176 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-09-04 13:09:33,177 - aiogram.event - INFO - Update id=954949129 is handled. Duration 952 ms by bot id=8413666974
2025-09-04 14:47:18,984 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 54] Connection reset by peer
2025-09-04 14:47:18,990 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8413666974)
2025-09-04 15:01:13,986 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Connection reset by peer]
2025-09-04 15:01:14,007 - aiogram.dispatcher - WARNING - Sleep for 1.428181 seconds and try again... (tryings = 1, bot id = 8413666974)
2025-09-04 15:02:15,510 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [None]
2025-09-04 15:02:15,512 - aiogram.dispatcher - WARNING - Sleep for 1.742420 seconds and try again... (tryings = 2, bot id = 8413666974)
2025-09-04 15:02:28,130 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 8413666974)
2025-09-04 15:03:44,236 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 15:03:44,259 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 15:03:44,260 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 15:03:44,534 - __main__ - INFO - Работа бота завершена
2025-09-04 15:03:48,173 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 15:03:48,177 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 15:03:48,177 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 15:03:48,177 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:03:48,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 15:03:48,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:03:48,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 15:03:48,178 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:03:48,178 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 15:03:48,179 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:03:48,179 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 15:03:48,179 - __main__ - INFO - База данных инициализирована
2025-09-04 15:03:48,188 - __main__ - INFO - Redis подключен успешно
2025-09-04 15:03:48,205 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 15:03:48,205 - __main__ - INFO - Запуск polling...
2025-09-04 15:03:48,205 - aiogram.dispatcher - INFO - Start polling
2025-09-04 15:03:49,083 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 15:05:50,890 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 15:05:50,895 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 15:05:50,895 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 15:05:51,149 - __main__ - INFO - Работа бота завершена
2025-09-04 15:15:30,809 - __main__ - INFO - Попытка запуска бота 1/5
2025-09-04 15:15:30,821 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-04 15:15:30,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-09-04 15:15:30,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:15:30,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("categories")
2025-09-04 15:15:30,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:15:30,823 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("products")
2025-09-04 15:15:30,823 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:15:30,823 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bouquets")
2025-09-04 15:15:30,823 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-04 15:15:30,823 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-04 15:15:30,823 - __main__ - INFO - База данных инициализирована
2025-09-04 15:15:30,844 - __main__ - INFO - Redis подключен успешно
2025-09-04 15:15:30,864 - __main__ - INFO - Бот успешно создан и настроен
2025-09-04 15:15:30,864 - __main__ - INFO - Запуск polling...
2025-09-04 15:15:30,864 - aiogram.dispatcher - INFO - Start polling
2025-09-04 15:15:33,868 - aiogram.dispatcher - INFO - Run polling for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 15:15:35,640 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-09-04 15:15:35,641 - aiogram.dispatcher - INFO - Polling stopped for bot @foto_save_catalog_bot id=8413666974 - 'Каталог товаров'
2025-09-04 15:15:35,641 - aiogram.dispatcher - INFO - Polling stopped
2025-09-04 15:15:35,893 - __main__ - INFO - Работа бота завершена
